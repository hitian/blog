<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>mysql on 哈哈哈</title><link>https://hitian.info/tags/mysql/</link><description>Recent content in mysql on 哈哈哈</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 12 Apr 2012 00:00:00 +0000</lastBuildDate><atom:link href="https://hitian.info/tags/mysql/index.xml" rel="self" type="application/rss+xml"/><item><title>sql笔记</title><link>https://hitian.info/post/sql-note/</link><pubDate>Thu, 12 Apr 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/sql-note/</guid><description>一般数据库会根据使用的情况来设计, 为了保证性能一般链接的表不应该超过2个,
但是在数据统计汇总运算的时候就麻烦了, 往往需要查好多张表才能得到需要的数据.
如果查询很复杂的时候一次join好多张表会导致查询速度巨慢.
当然用php等动态语言把数据取出来进行运算也不错,就是需要写代码.
能在数据库内完成的运算 当然想要直接在库内完成
使用临时表存储计算过程中的中间数据时隔不错的选择
使用临时表进行数据统计， 避免出现超过3个以上的join操作
&amp;ndash;以防万一先删除表
drop table if exists tmp_table;
&amp;ndash;创建临时表的时候加上temporary 关键字就行了
create temporary table tmp_table(uid bigint not null primary key, cityid int(10) unsigned, prov varchar(50), city varchar(50), group_id tinyint );
&amp;ndash;把多个表中需要的数据组合在一起插入临时表中, 暂时没有的数据插入空字符串
insert into tmp_table select a.uid as uid, a.cityid as cityid,'','',0 from my_city a inner join my_op b on a.uid=b.uid where a.reg_date='2012-04-10' and b.ctime&amp;gt;0;
&amp;ndash;联合多表更新
update tmp_table a, my_city b set a.</description></item><item><title>用latin1来存储汉字真抓狂</title><link>https://hitian.info/post/latin1/</link><pubDate>Thu, 12 Apr 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/latin1/</guid><description>mysql 是从4.0 升级上来的， 直接使用了latin1_swedish_ci 存储汉字，没想到带来了好多麻烦。
首先是查询的问题
mysql&amp;gt; select * from my_city where city=’温州’; +—-+——+ | id | city | +—-+——+ | 2 | 温州 | | 3 | 梧州 | +—-+——+ 2 rows in set (0.00 sec) 当然, 如果在city上建了唯一索引, 就会倒大霉&amp;hellip;
然后是排序的问题
mysql&amp;gt; select * from my_city order by city asc; +—-+——+ | id | city | +—-+——+ | 6 | 上海 | | 2 | 温州 | | 3 | 梧州 | | 5 | 西安 | | 7 | 重庆 | | 4 | 安徽 | | 8 | 北京 | +—-+——+ 7 rows in set (0.</description></item><item><title>mysql表锁定中不支持清空操作?</title><link>https://hitian.info/post/mysql-table-lock/</link><pubDate>Thu, 01 Dec 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/mysql-table-lock/</guid><description>偶然发现这个问题
mysql&amp;gt; lock table test_my write; Query OK, 0 rows affected (0.00 sec) mysql&amp;gt; select * from test_my; Empty set (0.00 sec) mysql&amp;gt; insert into test_my values(null, 1, 1); Query OK, 1 row affected (0.00 sec) mysql&amp;gt; select * from test_my; +—-+——+——–+ | id | pid | enable | +—-+——+——–+ | 1 | 1 | 1 | +—-+——+——–+ 1 row in set (0.00 sec) mysql&amp;gt; truncate table test_my; ERROR 1192 (HY000): Can&amp;#39;t execute the given command because you have active lock ed tables or an active transaction TRUNCATE TABLE was not allowed under LOCK TABLES.</description></item><item><title>简单的mysql表级锁</title><link>https://hitian.info/post/simple-mysql-table-level-locks/</link><pubDate>Tue, 12 Jul 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/simple-mysql-table-level-locks/</guid><description>由于业务需要, 一个表不允许两个及以上用户同时操作.由于是mysql4.1 事务等高级特性就不用想了, 存储引擎统一使用的MyISAM.其实转换成InnoDB 就可以使用行级锁了, 但是由于是线上正在使用的数据库, 数据量比较大,转换怕出现意外. 要实现的功能又是在后台使用. 所以就直接使用表级锁完全可以了.在mysql中对表加锁和解锁其实挺简单的
LOCK TABLE table_name; UNLOCK TABLE; demo
&amp;lt;?php $db = new Mysql(); $db-&amp;gt;open(); $db-&amp;gt;query(&amp;#34;lock table &amp;#34; . $table); $sql = &amp;#34;SELECT * FROM ${table} WHERE gid=&amp;#39;${gid}&amp;#39; AND sid IS NULL LIMIT 1&amp;#34;; $row = $db-&amp;gt;fetch($db-&amp;gt;query($sql)); $success = false; $re = array(); if($row){ $id = $row[&amp;#39;id&amp;#39;]; $update_data = array( &amp;#39;udate&amp;#39; =&amp;gt; date(&amp;#39;Y-m-d H:i:s&amp;#39;), &amp;#39;tuid&amp;#39; =&amp;gt; $uid, &amp;#39;operator&amp;#39; =&amp;gt; $_COOKIE[&amp;#39;admin_name&amp;#39;], &amp;#39;sid&amp;#39; =&amp;gt; $sid, ); $db-&amp;gt;update($this-&amp;gt;table, $update_data, &amp;#34;id=&amp;#39;$id&amp;#39;&amp;#34;); $result = $db-&amp;gt;getAffectedRows(); if($result &amp;gt; 0){ $success = true; $re = $row; }else{ $msg = &amp;#39;发生错误: 物品库存修改失败!</description></item></channel></rss>