<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>哈哈哈</title><link>https://hitian.info/</link><description>Recent content on 哈哈哈</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sat, 13 Aug 2022 13:44:43 +0800</lastBuildDate><atom:link href="https://hitian.info/index.xml" rel="self" type="application/rss+xml"/><item><title>arch linux install note</title><link>https://hitian.info/post/arch-linux-install/</link><pubDate>Sat, 13 Aug 2022 13:44:43 +0800</pubDate><guid>https://hitian.info/post/arch-linux-install/</guid><description>&lt;p>arch linux install note&lt;/p>
&lt;h1 id="pre-installation">Pre-installation&lt;/h1>
&lt;p>verify image signature&lt;/p>
&lt;p>&lt;code>gpg --keyserver-options auto-key-retrieve --verify archlinux-version-x86_64.iso.sig&lt;/code>&lt;/p>
&lt;h2 id="boot-option">Boot Option&lt;/h2>
&lt;p>before boot up, update BIOS Boot Options to EFI&lt;/p>
&lt;h2 id="install">Install&lt;/h2>
&lt;h3 id="partition-disk">partition disk&lt;/h3>
&lt;p>list disks &lt;code>fdisk -l&lt;/code>&lt;/p>
&lt;p>use fdisk to modify disk partition tables&lt;/p>
&lt;p>&lt;code>fdisk /dev/sda&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/202208/archlinux-fdisk.png" alt="archlinux-fdisk" />&lt;/p>
&lt;p>example:&lt;/p>
&lt;ul>
&lt;li>500 MiB for EFI system partition&lt;/li>
&lt;li>2048 MiB for Linux swap&lt;/li>
&lt;li>remainder for Linux root partition&lt;/li>
&lt;/ul>
&lt;p>step:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">g &lt;span class="c1"># create a new empty GPT partition table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">n &lt;span class="c1"># create 1st partition&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> &lt;span class="c1"># default[1] first partition&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># default[2048] first sector&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+500M &lt;span class="c1"># first partition size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">n &lt;span class="c1"># create 2nd partition&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> &lt;span class="c1"># default[2]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># default first sector&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+2048M &lt;span class="c1"># 2nd partition size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">n &lt;span class="c1"># create root partition&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># default[3]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># default first sector&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># default size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">t &lt;span class="c1"># change partition type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> &lt;span class="c1"># first partition&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> &lt;span class="c1"># partition type or alias, type 1: EFI System&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">t &lt;span class="c1"># change partition type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> &lt;span class="c1"># 2nd partition&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">19&lt;/span> &lt;span class="c1"># partition type or alias, type 19:Linux swap&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">w &lt;span class="c1"># save&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>check partition&lt;/p>
&lt;p>&lt;code>fdisk -l&lt;/code>&lt;/p>
&lt;h3 id="format-partition">format partition&lt;/h3>
&lt;ol>
&lt;li>first partition EFI system partition to FAT32&lt;/li>
&lt;/ol>
&lt;p>&lt;code>mkfs.fat -F 32 /dev/sda1&lt;/code>&lt;/p>
&lt;ol start="2">
&lt;li>2nd partition swap to swap&lt;/li>
&lt;/ol>
&lt;p>&lt;code>mkswap /dev/sda2&lt;/code>&lt;/p>
&lt;ol start="3">
&lt;li>3rd partition root to ext4&lt;/li>
&lt;/ol>
&lt;p>&lt;code>mkfs.ext4 /dev/sda3&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/202208/archlinux-partition_format.png" alt="archlinux-partition_format.png" />&lt;/p>
&lt;h3 id="mount-disk">Mount disk&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mount root partition to /mnt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount /dev/sda3 /mnt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mount EFI partition to /mnt/boot&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount --mkdir /dev/sda1 /mnt/boot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#create swap&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">swapon /dev/sda2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="install-1">Install&lt;/h3>
&lt;h4 id="change-download-mirrors-for-mainland-china-user">change download mirrors for Mainland China user&lt;/h4>
&lt;p>edit &lt;code>/etc/pacman.d/mirrorlist&lt;/code>&lt;/p>
&lt;p>add&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>to the top of Server list&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/202208/archlinux-package-mirror.png" alt="archlinux-package-mirror.png" />&lt;/p>
&lt;p>update cache&lt;/p>
&lt;p>&lt;code>pacman -Syy&lt;/code>&lt;/p>
&lt;h5 id="install-linux-base">install linux base&lt;/h5>
&lt;p>&lt;code>pacstrap /mnt base linux linux-firmware&lt;/code>&lt;/p>
&lt;h4 id="configure">Configure&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># generate fstab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">genfstab -U /mnt &amp;gt;&amp;gt; /mnt/etc/fstab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># chroot&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arch-chroot /mnt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set timezone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># install package&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pacman -S nano netctl dhcpcd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Localization&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;en_US.UTF-8 UTF-8&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> tee -a /etc/locale.gen
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">locale-gen
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;LANG=en_US.UTF-8&amp;#34;&lt;/span> &amp;gt; /etc/locale.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># hostname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;archlinux&amp;#34;&lt;/span> &amp;gt; /etc/hostname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set root&amp;#39;s password&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="boot-loader">Boot loader&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># install package grub and efibootmgr&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pacman -S grub efibootmgr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir /boot/grub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">grub-mkconfig &amp;gt; /boot/grub/grub.cfg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># install grub&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">grub-install --efi-directory&lt;span class="o">=&lt;/span>/boot --target&lt;span class="o">=&lt;/span>x86_64-efi /dev/sda
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># reboot to archlinux&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="setup-network">setup network&lt;/h2>
&lt;h3 id="static-ip-address-using-netctl">Static IP Address using &lt;code>netctl&lt;/code>&lt;/h3>
&lt;h4 id="check-network-devices">check network devices&lt;/h4>
&lt;p>&lt;code>ip link&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens33: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 00:0c:29:19:2b:bf brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> altname enp2s1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>network device name is &lt;code>ens33&lt;/code>&lt;/p>
&lt;h4 id="configure-1">configure&lt;/h4>
&lt;p>copy example file to etc&lt;/p>
&lt;p>&lt;code>cp /etc/netctl/examples/ethernet-static /etc/netctl/ens33&lt;/code>&lt;/p>
&lt;p>edit &lt;code>/etc/netctl/ens33&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">Description=&amp;#39;A basic static ethernet connection&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface=eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connection=ethernet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IP=static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Address=(&amp;#39;192.168.1.23/24&amp;#39; &amp;#39;192.168.1.87/24&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#Routes=(&amp;#39;192.168.0.0/24 via 192.168.1.2&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Gateway=&amp;#39;192.168.1.1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DNS=(&amp;#39;192.168.1.1&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## For IPv6 autoconfiguration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#IP6=stateless
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## For IPv6 static address configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#IP6=static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#Address6=(&amp;#39;1234:5678:9abc:def::1/64&amp;#39; &amp;#39;1234:3456::123/96&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#Routes6=(&amp;#39;abcd::1234&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#Gateway6=&amp;#39;1234:0:123::abcd&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>stop dhcp client&lt;/p>
&lt;p>&lt;code>systemctl disable --now dhcpcd&lt;/code>&lt;/p>
&lt;p>setup auto start&lt;/p>
&lt;p>&lt;code>netctl enable ens33&lt;/code>&lt;/p>
&lt;p>start&lt;/p>
&lt;p>&lt;code>netctl start ens33&lt;/code>&lt;/p>
&lt;h3 id="dynamic-ip-address">Dynamic IP Address&lt;/h3>
&lt;p>copy example configure file&lt;/p>
&lt;p>&lt;code>cp /etc/netctl/examples/ethernet-dhcp /etc/netctl/enp2s1&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">Description=&amp;#39;A basic dhcp ethernet connection&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface=enp2s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connection=ethernet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IP=dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#DHCPClient=dhcpcd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#DHCPReleaseOnStop=no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## for DHCPv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#IP6=dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#DHCP6Client=dhclient
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## for IPv6 autoconfiguration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#IP6=stateless
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>enable and start dhcp client&lt;/p>
&lt;p>&lt;code>systemctl enable --now dhcpcd&lt;/code>&lt;/p>
&lt;h2 id="post-install">Post-install&lt;/h2>
&lt;h3 id="add-user">add user&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">useradd --create-home tian
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="add-user-to-sudoers">add user to sudoers&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">usermod -aG wheel tian
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># usermod --append --groups wheel tian&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>update sudoers file&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pacman -S sudo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">visudo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>uncomment the following line&lt;/p>
&lt;p>&lt;code>%wheel ALL=(ALL) ALL&lt;/code>&lt;/p>
&lt;p>remove from sudoers&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">gpasswd -d tian wheel
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="other-package-for-manage">other package for manage&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pacman -S net-tools dnsutils
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Setup Ubuntu for Microsoft Remote Desktop</title><link>https://hitian.info/post/setup-ubuntu-for-microsoft-remote-desktop/</link><pubDate>Sun, 12 Sep 2021 14:15:39 +0800</pubDate><guid>https://hitian.info/post/setup-ubuntu-for-microsoft-remote-desktop/</guid><description>&lt;p>让 ubuntu 20.04 支持 &lt;code>Microsoft Remote Desktop&lt;/code> 远程桌面连接&lt;/p>
&lt;h3 id="安装依赖">安装依赖&lt;/h3>
&lt;p>这里安装了桌面 &lt;code>xfce4&lt;/code> , 个人感觉ubuntu自带的&lt;code>GNOME 3&lt;/code>并不是很方便远程桌面使用😶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install xrdp xorg xfce4 xfce4-goodies dbus-x11 x11-xserver-utils xfce4-terminal
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="设置服务和配置">设置服务和配置&lt;/h3>
&lt;p>将桌面更改为 &lt;code>xfce&lt;/code>, 编辑文件 &lt;code>/etc/xrdp/startwm.sh&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将这两行注释&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#test -x /etc/X11/Xsession &amp;amp;&amp;amp; exec /etc/X11/Xsession&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#exec /bin/sh /etc/X11/Xsession&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 新增&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exec&lt;/span> startxfce4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>设置xsession&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> xfce4-session &amp;gt; ~/.xsession
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="设置-xrdp-自启动并重启">设置 xrdp 自启动并重启&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> --now xrdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl restart xrdp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装注意">安装注意&lt;/h2>
&lt;p>xrdp 默认开放 &lt;code>3389/TCP&lt;/code> 到所有的网卡, 如果要跨公网使用, 最好使用ufw限制一下可以连接的ip段, 另外修改默认的端口也能减少被试探的概率&lt;/p></description></item><item><title>macOS tips for developer</title><link>https://hitian.info/post/macos-developer-tips/</link><pubDate>Fri, 10 Sep 2021 14:03:48 +0800</pubDate><guid>https://hitian.info/post/macos-developer-tips/</guid><description>&lt;h1 id="alias">Alias&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">alias&lt;/span> &lt;span class="nv">show_tcp_port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;lsof -nP -iTCP&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">alias&lt;/span> &lt;span class="nv">show_tcp_port_listen&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;lsof -nP -iTCP | grep LISTEN&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="disable-ds_store-on-network-storage">disable .DS_Store on network storage&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">defaults write com.apple.desktopservices DSDontWriteNetworkStores &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="disable-gatekepper-for-binary-exec">disable gatekepper for binary exec&lt;/h1>
&lt;p>e.g. perforce command &lt;code>p4&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tian@mac-mini ~ % xattr -p com.apple.quarantine &lt;span class="sb">`&lt;/span>which p4&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0082&lt;span class="p">;&lt;/span>5fb2322c&lt;span class="p">;&lt;/span>Safari&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tian@mac-mini ~ % xattr -d com.apple.quarantine &lt;span class="sb">`&lt;/span>which p4&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xattr: &lt;span class="o">[&lt;/span>Errno 13&lt;span class="o">]&lt;/span> Permission denied: &lt;span class="s1">&amp;#39;/usr/local/bin/p4&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tian@mac-mini ~ % sudo xattr -d com.apple.quarantine &lt;span class="sb">`&lt;/span>which p4&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tian@mac-mini ~ % xattr -p com.apple.quarantine &lt;span class="sb">`&lt;/span>which p4&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xattr: /usr/local/bin/p4: No such xattr: com.apple.quarantine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tian@mac-mini ~ %
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="create-macos-install-usb-disk">create macOS install usb disk&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo /Applications/Install&lt;span class="se">\ &lt;/span>macOS&lt;span class="se">\ &lt;/span>Big&lt;span class="se">\ &lt;/span>Sur.app/Contents/Resources/createinstallmedia --volume /Volumes/UDISK --applicationpath /Applications/Install&lt;span class="se">\ &lt;/span>macOS&lt;span class="se">\ &lt;/span>Big&lt;span class="se">\ &lt;/span>Sur.app
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>修复macOS上的Firefox在全屏时会隐藏所有屏幕菜单栏的问题</title><link>https://hitian.info/post/fix-firefox-macos-full-sceen/</link><pubDate>Sat, 01 Aug 2020 00:00:00 +0000</pubDate><guid>https://hitian.info/post/fix-firefox-macos-full-sceen/</guid><description>&lt;p>针对Firefox for macOS 79.0 (64-bit)&lt;/p>
&lt;p>如果macOS有多块屏幕， 在默认配置下 firefox 全屏时会隐藏所有屏幕的菜单栏，需要手动改配置修复。&lt;/p>
&lt;ol>
&lt;li>地址栏输入并打开 &lt;code>about:config&lt;/code>&lt;/li>
&lt;li>忽略风险提示并搜索 &lt;code>full-screen-api&lt;/code>&lt;/li>
&lt;li>双击 &lt;code>full-screen-api.macos-native-full-screen&lt;/code> 将配置更改为 &lt;code>true&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://hitian.info/assets/images/202008/2020-08-01-fix-firefox-macos-full-sceen.markdown.png" alt="firefox full screen api config" />&lt;/p></description></item><item><title>Raspberry Pi note</title><link>https://hitian.info/post/raspberry-pi-note/</link><pubDate>Sun, 25 Aug 2019 00:00:00 +0000</pubDate><guid>https://hitian.info/post/raspberry-pi-note/</guid><description>&lt;h1 id="raspberry-pi-笔记">Raspberry Pi 笔记&lt;/h1>
&lt;h2 id="b系列硬件参数">B系列硬件参数&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Version&lt;/th>
&lt;th>&lt;/th>
&lt;th>CPU&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>Arch&lt;/th>
&lt;th>RAM&lt;/th>
&lt;th>USB&lt;/th>
&lt;th>Boot from USB&lt;/th>
&lt;th>Ethernet&lt;/th>
&lt;th>Wireless&lt;/th>
&lt;th>Release&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>B&lt;/td>
&lt;td>BCM2835&lt;/td>
&lt;td>700MHz&lt;/td>
&lt;td>32-bit&lt;/td>
&lt;td>ARM1176JZFS&lt;/td>
&lt;td>256/512MB&lt;/td>
&lt;td>USB2 * 2&lt;/td>
&lt;td>No&lt;/td>
&lt;td>10/100 Mbit/s&lt;/td>
&lt;td>-&lt;/td>
&lt;td>2012 Apr~Jun&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>B+&lt;/td>
&lt;td>BCM2835&lt;/td>
&lt;td>700MHz&lt;/td>
&lt;td>32-bit&lt;/td>
&lt;td>ARM1176JZFS&lt;/td>
&lt;td>256/512MB&lt;/td>
&lt;td>USB2 * 4&lt;/td>
&lt;td>No&lt;/td>
&lt;td>10/100 Mbit/s&lt;/td>
&lt;td>-&lt;/td>
&lt;td>2014 Jul&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>B v1.1&lt;/td>
&lt;td>BCM2836&lt;/td>
&lt;td>900MHz&lt;/td>
&lt;td>32-bit quad-core&lt;/td>
&lt;td>ARM Cortex-A7&lt;/td>
&lt;td>1GB&lt;/td>
&lt;td>USB2 * 4&lt;/td>
&lt;td>No&lt;/td>
&lt;td>10/100 Mbit/s&lt;/td>
&lt;td>-&lt;/td>
&lt;td>2015 Feb&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>B v1.2&lt;/td>
&lt;td>BCM2837&lt;/td>
&lt;td>900MHz ~ 1.2GHz&lt;/td>
&lt;td>64-bit quad-core&lt;/td>
&lt;td>ARM Cortex-A53&lt;/td>
&lt;td>1GB&lt;/td>
&lt;td>USB2 * 4&lt;/td>
&lt;td>Yes&lt;/td>
&lt;td>10/100 Mbit/s&lt;/td>
&lt;td>-&lt;/td>
&lt;td>2016 Oct&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&lt;/td>
&lt;td>B&lt;/td>
&lt;td>BCM2837&lt;/td>
&lt;td>1.2GHz&lt;/td>
&lt;td>64-bit quad-core&lt;/td>
&lt;td>ARM Cortex-A53&lt;/td>
&lt;td>1GB&lt;/td>
&lt;td>USB2 * 4&lt;/td>
&lt;td>Yes&lt;/td>
&lt;td>10/100 Mbit/s&lt;/td>
&lt;td>2.4G WIFI + Bluetooth 4.1&lt;/td>
&lt;td>2016 Feb&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&lt;/td>
&lt;td>B+&lt;/td>
&lt;td>BCM2837B0&lt;/td>
&lt;td>1.4GHz&lt;/td>
&lt;td>64-bit quad-core&lt;/td>
&lt;td>ARM Cortex-A53&lt;/td>
&lt;td>1GB&lt;/td>
&lt;td>USB2 * 4&lt;/td>
&lt;td>Yes&lt;/td>
&lt;td>10/100/300 Mbit/s&lt;/td>
&lt;td>2.4/5G WIFI + Bluetooth 4.2 LS&lt;/td>
&lt;td>2018 Mar&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&lt;/td>
&lt;td>B&lt;/td>
&lt;td>BCM2711&lt;/td>
&lt;td>1.5GHz&lt;/td>
&lt;td>64-bit quad-core&lt;/td>
&lt;td>ARM Cortex-A72&lt;/td>
&lt;td>1/2/4/8GB&lt;/td>
&lt;td>USB2 * 2 + USB3 * 2&lt;/td>
&lt;td>Yes&lt;/td>
&lt;td>10/100/1000 Mbit/s&lt;/td>
&lt;td>2.4/5G WIFI + Bluetooth 5.0&lt;/td>
&lt;td>2019 Jun&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="常用的系统">常用的系统&lt;/h2>
&lt;h3 id="官方raspbian-系统">官方raspbian 系统&lt;/h3>
&lt;p>&lt;a class="link" href="https://www.raspberrypi.org/downloads/raspbian/" target="_blank" rel="noopener"
>https://www.raspberrypi.org/downloads/raspbian/&lt;/a>&lt;/p>
&lt;p>可用于所有型号的raspberrypi&lt;/p>
&lt;p>优点&lt;/p>
&lt;ul>
&lt;li>基于debian，使用 apt 包管理工具， 经常使用 Ubuntu 的话， 还是比较顺手的&lt;/li>
&lt;li>包含 raspi-config (Raspberry Pi Software Configuration Tool), 方便调整参数&lt;/li>
&lt;/ul>
&lt;p>缺点&lt;/p>
&lt;ul>
&lt;li>目前只有 32-bit 的系统(armhf)&lt;/li>
&lt;/ul>
&lt;p>&lt;code>1、2代推荐使用&lt;/code>&lt;/p>
&lt;h3 id="ubuntu-mate">Ubuntu MATE&lt;/h3>
&lt;p>&lt;a class="link" href="https://ubuntu-mate.org/raspberry-pi/" target="_blank" rel="noopener"
>https://ubuntu-mate.org/raspberry-pi/&lt;/a>&lt;/p>
&lt;p>Model B 2, 3 or 3+ 适用&lt;/p>
&lt;p>优点&lt;/p>
&lt;ul>
&lt;li>基于 Ubuntu，使用 apt 包管理工具&lt;/li>
&lt;li>使用 Ubuntu meta 的桌面，干净，个人偏好&lt;/li>
&lt;/ul>
&lt;p>缺点&lt;/p>
&lt;ul>
&lt;li>同样只有 32-bit 的系统(armhf)&lt;/li>
&lt;/ul>
&lt;p>&lt;code>推荐需要干净桌面+浏览器的用户使用&lt;/code>&lt;/p>
&lt;h3 id="osmc">OSMC&lt;/h3>
&lt;p>这是一个 &lt;code>Kodi&lt;/code> 的发行版本，用树莓派将家里的电视变成媒体中心，播放内网下载好的视频，或者安装插件直接播放网络视频&lt;/p>
&lt;p>&lt;a class="link" href="https://osmc.tv/download/" target="_blank" rel="noopener"
>https://osmc.tv/download/&lt;/a>&lt;/p>
&lt;p>可用于所有型号的raspberrypi， 友情提示， 最好在有有线网络接口(USB网卡也可以)的pi上使用， 使用2.4G Wi-Fi播放高清视频绝对会卡的&lt;/p>
&lt;h3 id="ubuntu-server">Ubuntu Server&lt;/h3>
&lt;p>作为服务器使用推荐&lt;/p>
&lt;p>Ubuntu 20.04 LTS (Focal Fossa)
&lt;a class="link" href="http://cdimage.ubuntu.com/releases/20.04/release/" target="_blank" rel="noopener"
>http://cdimage.ubuntu.com/releases/20.04/release/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://cdimage.ubuntu.com/releases/20.04/release/ubuntu-20.04-preinstalled-server-armhf&amp;#43;raspi.img.xz" target="_blank" rel="noopener"
>Raspberry Pi Generic (Hard-Float) preinstalled server image&lt;/a>&lt;/p>
&lt;p>For 32-bit&lt;/p>
&lt;p>&lt;a class="link" href="http://cdimage.ubuntu.com/releases/20.04/release/ubuntu-20.04-preinstalled-server-arm64&amp;#43;raspi.img.xz" target="_blank" rel="noopener"
>Raspberry Pi Generic (64-bit ARM) preinstalled server image&lt;/a>&lt;/p>
&lt;p>For 64-bit&lt;/p>
&lt;h2 id="系统镜像文件写入sdtf卡">系统镜像文件写入SD/TF卡&lt;/h2>
&lt;h3 id="简单模式">简单模式&lt;/h3>
&lt;p>推荐新手使用&lt;code>Etcher&lt;/code> &lt;a class="link" href="https://github.com/balena-io/etcher/releases" target="_blank" rel="noopener"
>https://github.com/balena-io/etcher/releases&lt;/a>&lt;/p>
&lt;p>Windows, linux, macOS 可用&lt;/p>
&lt;h3 id="命令行模式">命令行模式&lt;/h3>
&lt;p>&lt;code>sudo dd if=2019-07-10-raspbian-buster-full.img of=/dev/rdisk2 bs=1m&lt;/code>&lt;/p>
&lt;p>linux, macOS 可用，不同系统上目标磁盘的格式可能不太一样，macOS 注意 &lt;code>/dev/disk2&lt;/code> 和 &lt;code>/dev/rdisk2&lt;/code> 的区别，&lt;code>rdisk&lt;/code>写入速度会快10倍以上&lt;/p>
&lt;p>注意，dd会覆盖磁盘上的数据，谨慎操作。&lt;/p>
&lt;h3 id="使用usb硬盘启动">使用USB硬盘启动&lt;/h3>
&lt;p>参考官方说明 &lt;a class="link" href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bootmodes/msd.md" target="_blank" rel="noopener"
>https://www.raspberrypi.org/documentation/hardware/raspberrypi/bootmodes/msd.md&lt;/a>&lt;/p>
&lt;p>简单的说就是 3 B+ 及以上硬件版本可以直接从USB设备启动&lt;/p>
&lt;p>之前的硬件版本需要手动更改启动模式&lt;/p>
&lt;h2 id="常用命令">常用命令&lt;/h2>
&lt;ul>
&lt;li>系统配置 (官方raspbian 系统可用)&lt;/li>
&lt;/ul>
&lt;p>&lt;code>sudo raspi-config&lt;/code>&lt;/p>
&lt;ul>
&lt;li>查看树莓派的型号&lt;/li>
&lt;/ul>
&lt;p>&lt;code>cat /proc/device-tree/model&lt;/code>&lt;/p>
&lt;ul>
&lt;li>查看有线网络当前的链接速度 单位mb&lt;/li>
&lt;/ul>
&lt;p>&lt;code>cat /sys/class/net/eth0/speed&lt;/code>&lt;/p>
&lt;ul>
&lt;li>查看当前核心温度 (除1000为摄氏度)&lt;/li>
&lt;/ul>
&lt;p>&lt;code>cat /sys/class/thermal/thermal_zone0/temp&lt;/code>&lt;/p></description></item><item><title>在docker中编译openwrt</title><link>https://hitian.info/post/openwrt-build-docker/</link><pubDate>Sat, 10 Aug 2019 00:00:00 +0000</pubDate><guid>https://hitian.info/post/openwrt-build-docker/</guid><description>&lt;h1 id="在docker中编译openwrt">在docker中编译openwrt&lt;/h1>
&lt;h2 id="build-docker-image">build docker image&lt;/h2>
&lt;p>Docker file&lt;/p>
&lt;p>{% gist 88ff8a7cad5deffad51d8c29d5c47d75 Dockerfile %}&lt;/p>
&lt;p>&lt;code>docker build --no-cache -t ubuntu-openwrt-build .&lt;/code>&lt;/p>
&lt;h2 id="build">build&lt;/h2>
&lt;p>clone openwrt source code&lt;/p>
&lt;p>&lt;code>git clone https://git.openwrt.org/openwrt/openwrt.git&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 更新软件包&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -it --rm -v &lt;span class="nv">$PWD&lt;/span>:/build ubuntu-openwrt-build ./scripts/feeds update -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用 menuconfig 设置编译目标、内核信息、以及需要安装的包&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -it --rm -v &lt;span class="nv">$PWD&lt;/span>:/build ubuntu-openwrt-build make menuconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 编译&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -it --rm -v &lt;span class="nv">$PWD&lt;/span>:/build ubuntu-openwrt-build make -j4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://hitian.info/assets/images/201908/docker-openwrt-build-menuconfig.png" alt="menuconfig" />&lt;/p>
&lt;p>生成的文件会放置在&lt;code>bin&lt;/code>目录下, 例如 MT7621 放在 &lt;code>bin/targets/ramips/mt7621&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#配置文件，同运行 make menuconfig 后生成的.config 文件，可以用于备份和还原配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config.seed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openwrt-ramips-mt7621-device-pbr-m1-t.manifest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openwrt-ramips-mt7621-pbr-m1-t-initramfs-kernel.bin &lt;span class="c1">#首次刷机使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openwrt-ramips-mt7621-pbr-m1-t-squashfs-sysupgrade.bin &lt;span class="c1">#更新使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">packages &lt;span class="c1">#编译好的设置为编译但是不安装的包&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="添加新设备">添加新设备&lt;/h2>
&lt;p>示例 &lt;a class="link" href="https://github.com/hitian/openwrt/commit/22df459310836b92caa8fb1796885f670214d25a#diff-8dabb1882176c362bafecc664a7af2ee" target="_blank" rel="noopener"
>https://github.com/hitian/openwrt/commit/22df459310836b92caa8fb1796885f670214d25a#diff-8dabb1882176c362bafecc664a7af2ee&lt;/a>&lt;/p></description></item><item><title>ssh 代理和转发那些事</title><link>https://hitian.info/post/ssh-proxy-forward/</link><pubDate>Sat, 05 Jan 2019 00:00:00 +0000</pubDate><guid>https://hitian.info/post/ssh-proxy-forward/</guid><description>&lt;h1 id="配置ssh客户端的行为">配置ssh客户端的行为&lt;/h1>
&lt;p>配置文件路径 &lt;code>~/.ssh/config&lt;/code>&lt;/p>
&lt;p>针对目标主机的配置块示例&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Host deploy-gw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HostName &lt;span class="o">[&lt;/span>__target_hostname_or_ip__&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> User game
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IdentityFile ~/.ssh/deploy_private_key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ProxyCommand &lt;span class="o">[&lt;/span>__connect_command__&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置解释">配置解释&lt;/h2>
&lt;h3 id="除了host之外-其它的都是可选的">除了Host之外， 其它的都是可选的&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Host deploy-gw&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>定义使用时的名字，之后使用 &lt;code>ssh deploy-gw&lt;/code> 登录目标，这个只是别名，当然这里也可以直接写hostname 或者IP地址; 当使用 Hostname 时可以进行匹配， 例如 &lt;code>Host *.hitian.info&lt;/code> 可以匹配到 &lt;code>a.hitian.info&lt;/code>.&lt;/p>
&lt;ul>
&lt;li>&lt;code>HostName [__target_hostname_or_ip__]&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>目标的主机名或者IP地址&lt;/p>
&lt;ul>
&lt;li>&lt;code>User tian&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>用户名&lt;/p>
&lt;ul>
&lt;li>&lt;code>IdentityFile ~/.ssh/deploy_private_key&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>指定使用的private key路径。 替代ssh的 &lt;code>-i&lt;/code> 参数一样效果&lt;/p>
&lt;ul>
&lt;li>&lt;code>ProxyCommand ssh -q [__local_gw__] nc [__target_addr__] 22&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>连接目标主机时使用的命令&lt;/p>
&lt;h1 id="ssh-via-http-or-socks-proxy">ssh via [http or socks proxy]&lt;/h1>
&lt;p>使用场景: 由于不可抗拒的因素无法直接ssh 到远程主机，或者链接过程中会被异常阻断时&lt;/p>
&lt;p>这里我们需要一个 connect 命令，需要自行安装一下。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">Provides SOCKS and HTTPS proxy support to SSH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://bitbucket.org/gotoh/connect/wiki/Home
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>macOS 可以利用brew 直接安装, 其它平台可以按说明执行编译安装&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">brew install connect
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>要让ssh使用proxy连接到目标主机，在config 中添加ProxyCommand配置&lt;/p>
&lt;p>使用 http 代理&lt;/p>
&lt;p>&lt;code>ProxyCommand connect -H http_proxy_addr:port %h %p&lt;/code>&lt;/p>
&lt;p>使用 socks 代理&lt;/p>
&lt;p>&lt;code>ProxyCommand connect -S socks_proxy_addr:port %h %p&lt;/code>&lt;/p>
&lt;p>详细的connect使用说明可以参照官方wiki&lt;/p>
&lt;h1 id="ssh-via-ssh">ssh via ssh&lt;/h1>
&lt;p>使用场景：&lt;/p>
&lt;p>例如需要通过某台ssh的网关才能链接到内网的其它ssh服务器&lt;/p>
&lt;p>当然可以通过先ssh到网关，再ssh到目标主机的方式简单实现，但是这要求在网关机器上放一份目标主机的私钥。&lt;/p>
&lt;p>如果不想将私钥给网关机器。可以采用以下方式&lt;/p>
&lt;p>使用 nc 命令实现转发， nc在macOS和主流Linux上已经内置&lt;/p>
&lt;hr>
&lt;p>在config 中添加ProxyCommand配置&lt;/p>
&lt;p>&lt;code>ProxyCommand ssh -q gateway_host nc target_host 22&lt;/code>&lt;/p>
&lt;p>这里 gateway_host 为网关， nc 后为目标的主机和sshd的端口号， 首先要保证可以正常ssh 到gateway_host。&lt;/p>
&lt;p>这种方式可以直接实现更长的转发链&lt;/p>
&lt;p>例如要直接在local登录target 只需要在本地分别为a, b, target 配置ProxyCommand就可以了，妈妈再也不需要担心我要一层一层ssh到远程机器了:)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">local -&amp;gt; gateway -&amp;gt; a -&amp;gt; b -&amp;gt; target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="socks-proxy-over-ssh">socks proxy over ssh&lt;/h1>
&lt;p>使用场景：需要访问目标主机的localhost，或者目标主机内网的资源时， 如果客户端无法使用socks链接需要的资源，请参考下一种方式&lt;/p>
&lt;p>在本地监听1089端口。将请求通过ssh隧道转发到target_host&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ssh -D &lt;span class="m">1089&lt;/span> target_host
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="port-forward-via-ssh">port forward via ssh&lt;/h1>
&lt;p>使用场景： 直接在本地请求目标主机内网的服务时&lt;/p>
&lt;p>举个例子&lt;/p>
&lt;p>gateway 服务器的内网有一台mysql服务器运行在 &lt;code>10.0.0.3:3306&lt;/code>， 本地的mysql客户端无法直接链接。 我们可以采用ssh来映射端口到本地&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ssh -L localhost:3306:10.0.0.3:3306 target_host
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>L参数的格式 &lt;code>本地地址&lt;/code>:&lt;code>本地监听端口&lt;/code>:&lt;code>远程地址&lt;/code>:&lt;code>要映射的远程端口&lt;/code>&lt;/p>
&lt;p>上面的命令可以直接将远程mysql服务器的3306端口映射到本地的3306端口， 在本地可以直接使用&lt;code>mysql -h localhost&lt;/code>连接。&lt;/p>
&lt;p>当然也可以使用0.0.0.0，将本地的端口开放给本地的其它主机使用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ssh -L 0.0.0.0:3306:10.0.0.3:3306 target_host
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="不稳定的网络中使用ssh">不稳定的网络中使用ssh&lt;/h1>
&lt;p>由于ssh使用的TCP链接，在不稳定的网络中使用ssh会很容易断开，推荐使用 mosh &lt;a class="link" href="https://mosh.org/" target="_blank" rel="noopener"
>https://mosh.org/&lt;/a>&lt;/p>
&lt;p>mosh 会使用 Protocol Buffers + UDP 的方式传输ssh数据，包含数据的压缩和断线重连，原有的ssh配置和权限都不需要额外的变更&lt;/p>
&lt;p>注意：mosh客户端在启动的时候会ssh到远程的主机，启动一个mosh-server 并默认监听在一个60000-61000之间的UDP端口。而且每开启一个新的客户端， 都会在服务器上开一个新的udp端口，需要防火墙放心对应的UDP端口段.&lt;/p>
&lt;p>iOS上的客户端推荐 &lt;a class="link" href="https://github.com/blinksh/blink" target="_blank" rel="noopener"
>https://github.com/blinksh/blink&lt;/a>&lt;/p>
&lt;p>THE END&lt;/p></description></item><item><title>新年快乐</title><link>https://hitian.info/post/happy-new-year/</link><pubDate>Tue, 01 Jan 2019 00:00:00 +0000</pubDate><guid>https://hitian.info/post/happy-new-year/</guid><description>&lt;p>新年快乐！ 🎊🎉&lt;/p></description></item><item><title>vmware esxi install update patch</title><link>https://hitian.info/post/vmware-esxi-upgrade/</link><pubDate>Sun, 30 Dec 2018 00:00:00 +0000</pubDate><guid>https://hitian.info/post/vmware-esxi-upgrade/</guid><description>&lt;h1 id="check-the-latest-version">Check the latest version&lt;/h1>
&lt;p>Vmware Official &lt;a class="link" href="https://my.vmware.com/group/vmware/patch#search" target="_blank" rel="noopener"
>https://my.vmware.com/group/vmware/patch#search&lt;/a>&lt;/p>
&lt;p>or&lt;/p>
&lt;p>VMware ESXi Patch Tracker &lt;a class="link" href="https://esxi-patches.v-front.de/ESXi-7.0.0.html" target="_blank" rel="noopener"
>https://esxi-patches.v-front.de/ESXi-7.0.0.html&lt;/a>&lt;/p>
&lt;h1 id="install">Install&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># From https://esxi-patches.v-front.de/ESXi-7.0.0.html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Cut and paste these commands into an ESXi shell to update your host with this Imageprofile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># See the Help page for more instructions&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">esxcli network firewall ruleset &lt;span class="nb">set&lt;/span> -e &lt;span class="nb">true&lt;/span> -r httpClient
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">esxcli software profile update -p ESXi-7.0U3k-21313628-standard &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-d https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">esxcli network firewall ruleset &lt;span class="nb">set&lt;/span> -e &lt;span class="nb">false&lt;/span> -r httpClient
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Reboot to complete the upgrade&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="if-errno-28-no-space-left-on-device">IF Errno 28 No space left on device!!!&lt;/h1>
&lt;p>&lt;img src="https://hitian.info/assets/images/201812/20181230-vmware-esxi-upgrade-error-28.png" alt="Errno 28 No space left on device" />&lt;/p>
&lt;h2 id="download-the-offline-update-zip-file-here">download the offline update zip file here.&lt;/h2>
&lt;p>&lt;a class="link" href="https://my.vmware.com/group/vmware/patch#search" target="_blank" rel="noopener"
>https://my.vmware.com/group/vmware/patch#search&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/201812/20181230-vmware-esxi-upgrade-patch-download-page.png" alt="vmware esxi patch download page" />&lt;/p>
&lt;h2 id="upload-to-datastores-via-webui">upload to Datastores via webUI&lt;/h2>
&lt;p>&lt;img src="https://hitian.info/assets/images/201812/20181230-vmware-esxi-upgrade-patch-upload-datastores.png" alt="pload to Datastores via webUI" />&lt;/p>
&lt;h2 id="install-1">Install&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">esxcli software profile update -p ESXi-6.7.0-20181104001-standard &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-d update_zip_file_path
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>更新vmware esxi ssl证书</title><link>https://hitian.info/post/vmware-esxi-upgrade-ssl-certificate/</link><pubDate>Thu, 12 Jul 2018 00:00:00 +0000</pubDate><guid>https://hitian.info/post/vmware-esxi-upgrade-ssl-certificate/</guid><description>&lt;p>esxi 的证书管理页面貌似有bug一直无法更新证书，这里直接ssh登陆服务器替换&lt;/p>
&lt;p>开启SSH&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/201807/vmware-exsi-enable-sshd.png" alt="vmware-exsi-enable-sshd" />&lt;/p>
&lt;p>Let&amp;rsquo;s Encrypt 签发的证书目录如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hitian :: ~ » ls -al .acme.sh/hitian.me/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">36&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">2&lt;/span> tian tian &lt;span class="m">4096&lt;/span> Mar &lt;span class="m">20&lt;/span> 14:59 .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwx------ &lt;span class="m">8&lt;/span> tian tian &lt;span class="m">4096&lt;/span> May &lt;span class="m">27&lt;/span> 15:41 ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> tian tian &lt;span class="m">1648&lt;/span> May &lt;span class="m">19&lt;/span> 00:26 ca.cer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> tian tian &lt;span class="m">3803&lt;/span> May &lt;span class="m">19&lt;/span> 00:26 fullchain.cer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> tian tian &lt;span class="m">2155&lt;/span> May &lt;span class="m">19&lt;/span> 00:26 hitian.me.cer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> tian tian &lt;span class="m">529&lt;/span> May &lt;span class="m">19&lt;/span> 00:26 hitian.me.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> tian tian &lt;span class="m">980&lt;/span> May &lt;span class="m">19&lt;/span> 00:24 hitian.me.csr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> tian tian &lt;span class="m">220&lt;/span> May &lt;span class="m">19&lt;/span> 00:24 hitian.me.csr.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> tian tian &lt;span class="m">1675&lt;/span> Mar &lt;span class="m">20&lt;/span> 14:55 hitian.me.key
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>exsi 的配置目录如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@localhost:/etc/vmware/ssl&lt;span class="o">]&lt;/span> ls -al
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">36&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">1&lt;/span> root root &lt;span class="m">512&lt;/span> Jun &lt;span class="m">3&lt;/span> 18:34 .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-r--r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:24 .#castore.pem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-r-------T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:24 .#rui.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-r--r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:24 .#rui.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-r-------T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:24 .#rui.key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">1&lt;/span> root root &lt;span class="m">512&lt;/span> Jul &lt;span class="m">12&lt;/span> 00:28 ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">1050&lt;/span> Jun &lt;span class="m">3&lt;/span> 18:34 castore.pem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">3859&lt;/span> Jun &lt;span class="m">3&lt;/span> 18:34 iofiltervp.pem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-r--r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">229&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:24 openssl.cnf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-r-------- &lt;span class="m">1&lt;/span> root root &lt;span class="m">5231&lt;/span> Jun &lt;span class="m">3&lt;/span> 18:34 rui.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">3803&lt;/span> Jul &lt;span class="m">12&lt;/span> 00:26 rui.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> root root &lt;span class="m">1675&lt;/span> Jul &lt;span class="m">12&lt;/span> 00:27 rui.key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:50 vsan_kms_castore.pem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:50 vsan_kms_castore_old.pem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:50 vsan_kms_client.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:50 vsan_kms_client.key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:50 vsan_kms_client_old.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:50 vsan_kms_client_old.key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-T &lt;span class="m">1&lt;/span> root root &lt;span class="m">0&lt;/span> Apr &lt;span class="m">3&lt;/span> 21:50 vsanvp_castore.pem
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>使用 &lt;code>fullchain.cer&lt;/code> 覆盖 &lt;code>rui.crt&lt;/code>&lt;/li>
&lt;li>使用 &lt;code>hitian.me.key&lt;/code> 覆盖 &lt;code>rui.key&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>覆盖前先备份一下，防止发生意外&lt;/strong>&lt;/p>
&lt;p>接下来需要重启UI让配置生效&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/hostd restart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/vpxa restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>在Ubuntu Server上搭建Kubernetes cluster</title><link>https://hitian.info/post/kubernetes-cluster-setup-on-ubuntu-server/</link><pubDate>Thu, 12 Jul 2018 00:00:00 +0000</pubDate><guid>https://hitian.info/post/kubernetes-cluster-setup-on-ubuntu-server/</guid><description>&lt;h1 id="准备ubuntu-server">准备Ubuntu Server&lt;/h1>
&lt;p>安装最新版本的 ubuntu server, 可以使用网易开源镜像站加速下载&lt;/p>
&lt;p>&lt;a class="link" href="http://mirrors.163.com/ubuntu-releases/18.04/ubuntu-18.04-live-server-amd64.iso" target="_blank" rel="noopener"
>http://mirrors.163.com/ubuntu-releases/18.04/ubuntu-18.04-live-server-amd64.iso&lt;/a>&lt;/p>
&lt;h2 id="在3台主机上安装系统">在3台主机上安装系统&lt;/h2>
&lt;p>物理机或者虚拟机都可以，要求互相之前可以直连，内存建议在2G以上， 如果不跑什么大型系统的话硬盘15G就差不多了&lt;/p>
&lt;p>这里直接在VMware Esxi 上启动3个实例安装系统并指定IP地址&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/201807/Kubernetes-vmware-exsi.png" alt="Kubernetes-vmware-exsi" />&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>主机&lt;/th>
&lt;th>IP&lt;/th>
&lt;th>hostname&lt;/th>
&lt;th>说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>c-1&lt;/td>
&lt;td>192.168.5.191&lt;/td>
&lt;td>c1&lt;/td>
&lt;td>Master&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>c-2&lt;/td>
&lt;td>192.168.5.192&lt;/td>
&lt;td>c2&lt;/td>
&lt;td>Node&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>c-3&lt;/td>
&lt;td>192.168.5.193&lt;/td>
&lt;td>c3&lt;/td>
&lt;td>Node&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="准备环境">准备环境&lt;/h2>
&lt;p>&lt;strong>下面的步骤需要在3台主机上全部执行, 注意使用root用户&lt;/strong>&lt;/p>
&lt;h3 id="可选-更换apt的更新源为国内的地址加速安装过程">(可选) 更换apt的更新源为国内的地址，加速安装过程&lt;/h3>
&lt;p>&lt;code>sed -i -- 's/archive.ubuntu.com/mirrors.163.com/g' /etc/apt/sources.list&lt;/code>&lt;/p>
&lt;h3 id="更新-apt">更新 APT&lt;/h3>
&lt;p>&lt;code>apt update -y &amp;amp;&amp;amp; apt upgrade -y&lt;/code>&lt;/p>
&lt;h3 id="安装-docker-ce">安装 Docker CE&lt;/h3>
&lt;p>以下可以参照Docker 官网的文档
&lt;a class="link" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" target="_blank" rel="noopener"
>https://docs.docker.com/install/linux/docker-ce/ubuntu/&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install -y &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-transport-https &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ca-certificates &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> curl &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> software-properties-common
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Add Docker’s official GPG key:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -fsSL https://download.docker.com/linux/ubuntu/gpg &lt;span class="p">|&lt;/span> sudo apt-key add -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加Docker 的 apt repository.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add-apt-repository &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="s2">&amp;#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &lt;/span>&lt;span class="k">$(&lt;/span>lsb_release -cs&lt;span class="k">)&lt;/span>&lt;span class="s2"> \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> stable&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 更新APT 并安装Docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get update -y &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get install -y docker-ce
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="安装-kubernetes-相关的工具">安装 Kubernetes 相关的工具&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Add Google’s official GPG key:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg &lt;span class="p">|&lt;/span> apt-key add -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加 APT repository.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &lt;span class="s">&amp;lt;&amp;lt;EOF &amp;gt;/etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">deb http://apt.kubernetes.io/ kubernetes-xenial main
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 更新APT 并安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get update -y &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get install -y kubelet kubeadm kubectl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>到这里基础环境就准备好了， 下来开始初始化， 注意下面的部分在Master主机上操作&lt;/em>&lt;/p>
&lt;h2 id="初始化-kubernetes">初始化 Kubernetes&lt;/h2>
&lt;h3 id="启动-master">启动 Master&lt;/h3>
&lt;h3 id="可选-先pull一下初始化过程中需要的docker-image-加速安装过程">(可选) 先pull一下初始化过程中需要的docker image， 加速安装过程&lt;/h3>
&lt;p>&lt;code>kubeadm config images pull&lt;/code>&lt;/p>
&lt;h3 id="初始化">初始化&lt;/h3>
&lt;p>&lt;code>kubeadm init --pod-network-cidr=10.244.0.0/16&lt;/code>&lt;/p>
&lt;p>&lt;code>pod-network-cidr&lt;/code>参数是之后创建内部网络需要的ip段，选一个没有被占用的内网段就可以了&lt;/p>
&lt;p>如果报错
&lt;code>if [ERROR Swap]: running with swap on is not supported. Please disable swap&lt;/code>&lt;/p>
&lt;p>swap 没有关闭， 使用&lt;code>swapoff -a&lt;/code>命令关闭swap再重新运行init&lt;/p>
&lt;p>输出大概如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@c1:/home/tian# kubeadm init --pod-network-cidr&lt;span class="o">=&lt;/span>10.244.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0711 03:45:48.345918 &lt;span class="m">2359&lt;/span> feature_gate.go:230&lt;span class="o">]&lt;/span> feature gates: &lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>map&lt;span class="o">[]}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> using Kubernetes version: v1.11.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> running pre-flight checks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0711 03:45:48.367074 &lt;span class="m">2359&lt;/span> kernel_validator.go:81&lt;span class="o">]&lt;/span> Validating kernel version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0711 03:45:48.367165 &lt;span class="m">2359&lt;/span> kernel_validator.go:96&lt;span class="o">]&lt;/span> Validating kernel config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>WARNING SystemVerification&lt;span class="o">]&lt;/span>: docker version is greater than the most recently validated version. Docker version: 18.03.1-ce. Max validated version: 17.03
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight/images&lt;span class="o">]&lt;/span> Pulling images required &lt;span class="k">for&lt;/span> setting up a Kubernetes cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight/images&lt;span class="o">]&lt;/span> This might take a minute or two, depending on the speed of your internet connection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight/images&lt;span class="o">]&lt;/span> You can also perform this action in beforehand using &lt;span class="s1">&amp;#39;kubeadm config images pull&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet&lt;span class="o">]&lt;/span> Writing kubelet environment file with flags to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/kubeadm-flags.env&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet&lt;span class="o">]&lt;/span> Writing kubelet configuration to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/config.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Activating the kubelet service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated ca certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated apiserver certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> apiserver serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>c1 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>10.96.0.1 192.168.5.191&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated apiserver-kubelet-client certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated sa key and public key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated front-proxy-ca certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated front-proxy-client certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated etcd/ca certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated etcd/server certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> etcd/server serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>c1 localhost&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated etcd/peer certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> etcd/peer serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>c1 localhost&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.5.191 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated etcd/healthcheck-client certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> Generated apiserver-etcd-client certificate and key.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certificates&lt;span class="o">]&lt;/span> valid certificates and keys now exist in &lt;span class="s2">&amp;#34;/etc/kubernetes/pki&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Wrote KubeConfig file to disk: &lt;span class="s2">&amp;#34;/etc/kubernetes/admin.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Wrote KubeConfig file to disk: &lt;span class="s2">&amp;#34;/etc/kubernetes/kubelet.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Wrote KubeConfig file to disk: &lt;span class="s2">&amp;#34;/etc/kubernetes/controller-manager.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Wrote KubeConfig file to disk: &lt;span class="s2">&amp;#34;/etc/kubernetes/scheduler.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>controlplane&lt;span class="o">]&lt;/span> wrote Static Pod manifest &lt;span class="k">for&lt;/span> component kube-apiserver to &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests/kube-apiserver.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>controlplane&lt;span class="o">]&lt;/span> wrote Static Pod manifest &lt;span class="k">for&lt;/span> component kube-controller-manager to &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests/kube-controller-manager.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>controlplane&lt;span class="o">]&lt;/span> wrote Static Pod manifest &lt;span class="k">for&lt;/span> component kube-scheduler to &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests/kube-scheduler.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>etcd&lt;span class="o">]&lt;/span> Wrote Static Pod manifest &lt;span class="k">for&lt;/span> a &lt;span class="nb">local&lt;/span> etcd instance to &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests/etcd.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> waiting &lt;span class="k">for&lt;/span> the kubelet to boot up the control plane as Static Pods from directory &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> this might take a minute or longer &lt;span class="k">if&lt;/span> the control plane images have to be pulled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>apiclient&lt;span class="o">]&lt;/span> All control plane components are healthy after 42.004178 seconds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>uploadconfig&lt;span class="o">]&lt;/span> storing the configuration used in ConfigMap &lt;span class="s2">&amp;#34;kubeadm-config&amp;#34;&lt;/span> in the &lt;span class="s2">&amp;#34;kube-system&amp;#34;&lt;/span> Namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet&lt;span class="o">]&lt;/span> Creating a ConfigMap &lt;span class="s2">&amp;#34;kubelet-config-1.11&amp;#34;&lt;/span> in namespace kube-system with the configuration &lt;span class="k">for&lt;/span> the kubelets in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>markmaster&lt;span class="o">]&lt;/span> Marking the node c1 as master by adding the label &lt;span class="s2">&amp;#34;node-role.kubernetes.io/master=&amp;#39;&amp;#39;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>markmaster&lt;span class="o">]&lt;/span> Marking the node c1 as master by adding the taints &lt;span class="o">[&lt;/span>node-role.kubernetes.io/master:NoSchedule&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>patchnode&lt;span class="o">]&lt;/span> Uploading the CRI Socket information &lt;span class="s2">&amp;#34;/var/run/dockershim.sock&amp;#34;&lt;/span> to the Node API object &lt;span class="s2">&amp;#34;c1&amp;#34;&lt;/span> as an annotation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstraptoken&lt;span class="o">]&lt;/span> using token: pbl4c9.b0ws1tfhjt6ra66a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstraptoken&lt;span class="o">]&lt;/span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order &lt;span class="k">for&lt;/span> nodes to get long term certificate credentials
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstraptoken&lt;span class="o">]&lt;/span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstraptoken&lt;span class="o">]&lt;/span> configured RBAC rules to allow certificate rotation &lt;span class="k">for&lt;/span> all node client certificates in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstraptoken&lt;span class="o">]&lt;/span> creating the &lt;span class="s2">&amp;#34;cluster-info&amp;#34;&lt;/span> ConfigMap in the &lt;span class="s2">&amp;#34;kube-public&amp;#34;&lt;/span> namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: CoreDNS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your Kubernetes master has initialized successfully!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To start using your cluster, you need to run the following as a regular user:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You should now deploy a pod network to the cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Run &lt;span class="s2">&amp;#34;kubectl apply -f [podnetwork].yaml&amp;#34;&lt;/span> with one of the options listed at:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://kubernetes.io/docs/concepts/cluster-administration/addons/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You can now join any number of machines by running the following on each node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">as root:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubeadm join 192.168.5.191:6443 --token xxxxxxxxxxx --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="配置信息拷贝到普通用户">配置信息拷贝到普通用户&lt;/h3>
&lt;p>上面有两部分是之后需要用到的。&lt;/p>
&lt;p>首先退出root用户，切换到普通用户执行这一段，目的是将生成的相关配置信息拷贝到普通用户目录下，之后直接使用普通用户操作集群&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>检查一下节点信息&lt;/p>
&lt;p>&lt;code>kubectl get nodes --all-namespaces&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tian@c1:~$ kubectl get nodes --all-namespaces
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c1 NotReady master 1m v1.11.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>因为网络还没有配置好， 状态还暂时是&lt;code>NotReady&lt;/code>， 下来安装网络插件&lt;/p>
&lt;h3 id="安装网络插件">安装网络插件&lt;/h3>
&lt;p>选择一种网络插件， 参考官方文档&lt;a class="link" href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network" target="_blank" rel="noopener"
>https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network&lt;/a>&lt;/p>
&lt;p>我们这里使用&lt;code>Flannel&lt;/code>&lt;/p>
&lt;p>执行 (For Kubernetes v1.7+)&lt;/p>
&lt;p>&lt;code>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml&lt;/code>&lt;/p>
&lt;p>注意新版本的ubuntu 需要更改 &lt;code>/etc/sysctl.conf&lt;/code> 添加 &lt;code>net.bridge.bridge-nf-call-iptables=1&lt;/code> 开启桥接网络的流量转发&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;net.bridge.bridge-nf-call-iptables=1&amp;#39;&lt;/span> &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysctl -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装完成后使用&lt;code>kubectl get pods --all-namespaces&lt;/code>看下情况，
因为要下载相关的docker镜像，可能需要一点时间，等到&lt;code>kube-flannel-XXXXXXX&lt;/code> 这个变成&lt;code>Running&lt;/code> 之后就完成了&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tian@c1:~$ kubectl get pods --all-namespaces
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system coredns-78fcdf6894-8tkzx 1/1 Running &lt;span class="m">0&lt;/span> 2m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system coredns-78fcdf6894-cbdb8 1/1 Running &lt;span class="m">0&lt;/span> 2m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system etcd-c1 1/1 Running &lt;span class="m">0&lt;/span> 1m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-apiserver-c1 1/1 Running &lt;span class="m">0&lt;/span> 1m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-controller-manager-c1 1/1 Running &lt;span class="m">0&lt;/span> 2m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-flannel-ds-pqpgk 1/1 Running &lt;span class="m">0&lt;/span> 36s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-proxy-kpjrk 1/1 Running &lt;span class="m">0&lt;/span> 2m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-scheduler-c1 1/1 Running &lt;span class="m">0&lt;/span> 1m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>到这里Master就配置好了，现在可以开始加入其它节点了&lt;/strong>&lt;/p>
&lt;h2 id="初始化其它-node">初始化其它 Node&lt;/h2>
&lt;p>进入其它的所有主机切换到root用户， 执行之前Mater初始化最后输出的&lt;code>join&lt;/code>命令段， 例如&lt;/p>
&lt;p>&lt;code>kubeadm join 192.168.5.191:6443 --token xxxxxxxxxxx --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&lt;/code>&lt;/p>
&lt;p>如果没有报错的话就完成了&lt;/p>
&lt;p>&lt;strong>接下来回到Master主机&lt;/strong>&lt;/p>
&lt;p>使用&lt;code>kubectl get nodes&lt;/code>查看节点的状态&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tian@c1:~$ kubectl get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c1 Ready master 10m v1.11.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c2 NotReady &amp;lt;none&amp;gt; 1m v1.11.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c3 NotReady &amp;lt;none&amp;gt; 14s v1.11.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>到这里就完成了，稍等初始化完成可以正常使用了。&lt;/p>
&lt;h1 id="安装图形化管理界面">安装图形化管理界面&lt;/h1>
&lt;h2 id="安装">安装&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.1/aio/deploy/recommended.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#开启proxy 方便内网访问&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl proxy --address&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;0.0.0.0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#(可选)如果在机房内网需要经过gateway才能访问的话， 可以临时开启ssh转发，然后直接访问 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TMac :: ~ » ssh -L localhost:8001:192.168.5.191:8001 gateway-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>管理地址&lt;/p>
&lt;p>&lt;a class="link" href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/" target="_blank" rel="noopener"
>http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/201807/Kubernetes-dashboard-login.png" alt="Kubernetes-gui-login.png" />&lt;/p>
&lt;p>接下来要创建可以登陆管理界面的用户&lt;/p>
&lt;p>创建用户配置 &lt;code>create_account.yaml&lt;/code>, 用户名为admin&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">admin-user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubernetes-dashboard&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>应用配置&lt;code>kubectl create -f create_account.yaml&lt;/code>&lt;/p>
&lt;p>创建权限配置 &lt;code>admin_account_role_binding.yaml&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterRoleBinding&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">admin-user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">roleRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">apiGroup&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterRole&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cluster-admin&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">subjects&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">admin-user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubernetes-dashboard&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>应用配置&lt;code>kubectl create -f admin_account_role_binding.yaml&lt;/code>&lt;/p>
&lt;p>好了， 接下来查看创建的用户token&lt;/p>
&lt;p>&lt;code>kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}')&lt;/code>&lt;/p>
&lt;p>使用输出的很长很长的token登陆&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/201807/Kubernetes-dashboard.png" alt="Kubernetes-dashboard" />&lt;/p>
&lt;h2 id="销毁">销毁&lt;/h2>
&lt;p>&lt;em>&lt;strong>注意，这里是销毁&lt;/strong>&lt;/em>&lt;/p>
&lt;h3 id="移除node">移除Node&lt;/h3>
&lt;p>在Mater 上执行&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl drain &amp;lt;node name&amp;gt; --delete-local-data --force --ignore-daemonsets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl delete node &amp;lt;node name&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后在对应的Node 上执行&lt;code>kubeadm reset&lt;/code>&lt;/p>
&lt;h3 id="删除master">删除Master&lt;/h3>
&lt;p>直接执行 &lt;code>kubeadm reset&lt;/code> 就可以了&lt;/p>
&lt;p>全文完&lt;/p></description></item><item><title>使用netplan管理ubuntu 的网络配置</title><link>https://hitian.info/post/ubuntu-server-set-network-netplan/</link><pubDate>Tue, 10 Jul 2018 00:00:00 +0000</pubDate><guid>https://hitian.info/post/ubuntu-server-set-network-netplan/</guid><description>&lt;p>最新的ubuntu已经使用&lt;code>netplan&lt;/code>来管理网络配置了&lt;/p>
&lt;p>列出当前的配置文件&lt;code>ls -al /etc/netplan/&lt;/code>， 注意配置文件为yaml格式， 如果当前没有配置， 可以创建一个例如&lt;code>/etc/netplan/01-netcfg.yaml&lt;/code>&lt;/p>
&lt;h2 id="例子">例子&lt;/h2>
&lt;h3 id="配置为使用dhcp">配置为使用DHCP&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">network&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">renderer&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">networkd&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ethernets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ens33&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dhcp4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dhcp6&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="配置为静态ip">配置为静态ip&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">network&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">renderer&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">networkd&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ethernets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ens33&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dhcp4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dhcp6&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addresses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="m">192.168.1.2&lt;/span>&lt;span class="l">/24]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gateway4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">192.168.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">nameservers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addresses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="m">8.8.8.8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">8.8.4.4&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置文件修改好之后使用&lt;code>sudo netplan apply&lt;/code>应用配置， 可以加debug参数来查看具体的过程&lt;code>sudo netplan --debug apply&lt;/code>&lt;/p></description></item><item><title>常用的 x-callback 链接</title><link>https://hitian.info/post/x-callback-links/</link><pubDate>Mon, 09 Jul 2018 00:00:00 +0000</pubDate><guid>https://hitian.info/post/x-callback-links/</guid><description>&lt;h3 id="omnifocus-change-language">OmniFocus change language&lt;/h3>
&lt;ul>
&lt;li>Reset &lt;a class="link" href="omnifocus:///change-preference?AppleLanguages=" >omnifocus:///change-preference?AppleLanguages=&lt;/a>&lt;/li>
&lt;li>中文 &lt;a class="link" href="omnifocus:///change-preference?AppleLanguages=zh" >omnifocus:///change-preference?AppleLanguages=zh&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="bear">Bear&lt;/h3>
&lt;ul>
&lt;li>Create note &lt;a class="link" href="bear://x-callback-url/create?title=Title&amp;amp;text=Text&amp;amp;tags=tag1,tag2" >bear://x-callback-url/create?title=Title&amp;amp;text=Text&amp;amp;tags=tag1,tag2&lt;/a>&lt;/li>
&lt;li>Open tag &lt;a class="link" href="bear://x-callback-url/open-tag?name=tag-name" >bear://x-callback-url/open-tag?name=tag-name&lt;/a>&lt;/li>
&lt;li>Search note &lt;a class="link" href="bear://x-callback-url/search?term=keyword" >bear://x-callback-url/search?term=keyword&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="due">Due&lt;/h3>
&lt;ul>
&lt;li>Add &lt;a class="link" href="due://x-callback-url/add?title=title" >due://x-callback-url/add?title=title&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Deploying an etcd cluster as a standalone cluster on docker</title><link>https://hitian.info/post/docker-run-etcd/</link><pubDate>Sun, 08 Jul 2018 00:00:00 +0000</pubDate><guid>https://hitian.info/post/docker-run-etcd/</guid><description>&lt;p>docker host ip addr &lt;code>192.168.5.170&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 2379:2379 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 2380:2380 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --volume&lt;span class="o">=&lt;/span>/dir/for/etcd/data:/etcd-data &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --name etcd --rm -d quay.io/coreos/etcd:latest &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> /usr/local/bin/etcd &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --data-dir&lt;span class="o">=&lt;/span>/etcd-data --name node1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --initial-advertise-peer-urls http://192.168.5.170:2380 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --listen-peer-urls http://0.0.0.0:2380 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --advertise-client-urls http://192.168.5.170:2379 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --listen-client-urls http://0.0.0.0:2379 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --initial-cluster &lt;span class="nv">node1&lt;/span>&lt;span class="o">=&lt;/span>http://192.168.5.170:2380
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>with tls certificate.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run --name etcd -d -p 2379:2379 -p 2380:2380 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/tian/workspace/certs:/etcd-ssl-certs-dir &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/tian/workspace/etcd:/etcd-data &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> quay.io/coreos/etcd:latest /usr/local/bin/etcd &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --name my-name &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --data-dir /etcd-data &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --listen-client-urls &lt;span class="s2">&amp;#34;https://0.0.0.0:2379&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --advertise-client-urls &lt;span class="s2">&amp;#34;https://hostname:2379&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --listen-peer-urls &lt;span class="s2">&amp;#34;https://0.0.0.0:2380&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --initial-advertise-peer-urls &lt;span class="s2">&amp;#34;https://hostname:2380&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --initial-cluster &lt;span class="s2">&amp;#34;my-name=https://hostname:2380&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --initial-cluster-token &lt;span class="s2">&amp;#34;tkn&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --initial-cluster-state &lt;span class="s2">&amp;#34;new&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --client-cert-auth &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --trusted-ca-file &lt;span class="s2">&amp;#34;/etcd-ssl-certs-dir/ca.pem&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --cert-file &lt;span class="s2">&amp;#34;/etcd-ssl-certs-dir/server.pem&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --key-file &lt;span class="s2">&amp;#34;/etcd-ssl-certs-dir/server-key.pem&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --peer-client-cert-auth &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --peer-trusted-ca-file &lt;span class="s2">&amp;#34;/etcd-ssl-certs-dir/ca.pem&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --peer-cert-file &lt;span class="s2">&amp;#34;/etcd-ssl-certs-dir/server.pem&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --peer-key-file &lt;span class="s2">&amp;#34;/etcd-ssl-certs-dir/server-key.pem&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>check&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it etcd etcdctl member list
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>test with golang&lt;/p>
&lt;p>{% gist 211bd79f3ce5a6e1fde607086a75c46b %}&lt;/p>
&lt;p>create golang client with certificate.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//load client certificate.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">cert&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">tls&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">LoadX509KeyPair&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;./client.pem&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;./client-key.pem&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//load ca certificate.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">rootCAPem&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">ioutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ReadFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;ca.pem&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">caPool&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">x509&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewCertPool&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">caPool&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">AppendCertsFromPEM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rootCAPem&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;append ca cert failed.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">cfg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Config&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Endpoints&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;https://hostname:2379&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Transport&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Transport&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">TLSClientConfig&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">tls&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Config&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Certificates&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">tls&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Certificate&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">cert&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">RootCAs&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">caPool&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">HeaderTimeoutPerRequest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Second&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>vmware esxi unregister invalid vm</title><link>https://hitian.info/post/esxi-unregister-invalid-vm/</link><pubDate>Sun, 05 Nov 2017 00:00:00 +0000</pubDate><guid>https://hitian.info/post/esxi-unregister-invalid-vm/</guid><description>&lt;p>*** 以下内容针对 VMware ESXi 6.5.0 build-6765664 ***&lt;/p>
&lt;p>意外删除了esxi 的一个vmfs所在的磁盘，导致vm列表下一直会显示一个invalid状态的VM， 无法进行任何操作，看着非常碍眼。显然通过web界面可能无法处理这个问题了&lt;/p>
&lt;p>开启SSH服务，登录esxi。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@localhost:/vmfs&lt;span class="o">]&lt;/span> vim-cmd vmsvc/getallvms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Skipping invalid VM &lt;span class="s1">&amp;#39;6&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vmid Name File Guest OS Version Annotation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> ubuntu-desktop &lt;span class="o">[&lt;/span>HDD&lt;span class="o">]&lt;/span> ubuntu-desktop/ubuntu-desktop.vmx ubuntu64Guest vmx-13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">11&lt;/span> ubuntu-server-1710 &lt;span class="o">[&lt;/span>HDD&lt;span class="o">]&lt;/span> ubuntu-server-1710/ubuntu-server-1710.vmx ubuntu64Guest vmx-13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> ubuntu-server &lt;span class="o">[&lt;/span>HDD&lt;span class="o">]&lt;/span> ubuntu-server/ubuntu-server.vmx ubuntu64Guest vmx-13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">3&lt;/span> windows-7 &lt;span class="o">[&lt;/span>HDD&lt;span class="o">]&lt;/span> windows-7/windows-7.vmx windows7_64Guest vmx-13
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用 &lt;code>vim-cmd vmsvc/getallvms&lt;/code> 命令可以看到提示出现问题的是 VM 6， 接下来直接删除就好了。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@localhost:/vmfs&lt;span class="o">]&lt;/span> vim-cmd vmsvc/unregister &lt;span class="m">6&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>刷新web界面， 就可以看到出错的vm已经被删除了。&lt;/p></description></item><item><title>使用ACME Shell script和dnspod的api自动生成Let's Encrypt证书</title><link>https://hitian.info/post/acme-sh-create-letsencrypt-certificates-with-dns-api/</link><pubDate>Thu, 16 Feb 2017 00:00:00 +0000</pubDate><guid>https://hitian.info/post/acme-sh-create-letsencrypt-certificates-with-dns-api/</guid><description>&lt;h3 id="安装-acmesh">安装 acme.sh&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl https://get.acme.sh &lt;span class="p">|&lt;/span> sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考 &lt;a class="link" href="https://github.com/Neilpang/acme.sh" target="_blank" rel="noopener"
>https://github.com/Neilpang/acme.sh&lt;/a>&lt;/p>
&lt;p>安装完成之后可执行文件位于 &lt;code>~/.acme.sh/acme.sh&lt;/code>&lt;/p>
&lt;h3 id="生成-dnspod-的api-token">生成 dnspod 的API Token&lt;/h3>
&lt;p>地址 &lt;a class="link" href="https://www.dnspod.cn/console/user/security" target="_blank" rel="noopener"
>https://www.dnspod.cn/console/user/security&lt;/a>&lt;/p>
&lt;p>用户中心 &amp;gt; 安全设置 &amp;gt; API Token &amp;gt; 创建 API Token&lt;/p>
&lt;p>注意，Token 只显示一次， 保存下来， 如果忘记了， 就只能删除然后重新生成了。&lt;/p>
&lt;p>还需需要记录下 API Token 的 ID&lt;/p>
&lt;h3 id="开始签发证书">开始签发证书&lt;/h3>
&lt;p>参考 &lt;a class="link" href="https://github.com/Neilpang/acme.sh/tree/master/dnsapi" target="_blank" rel="noopener"
>https://github.com/Neilpang/acme.sh/tree/master/dnsapi&lt;/a>&lt;/p>
&lt;p>首先设置环境变量&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">DP_Id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;API Token 的 ID&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">DP_Key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;API Token&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后可以开始签发了&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acme.sh --issue --dns dns_dp -d example.com -d www.example.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>每个 &lt;code>-d&lt;/code> 参数可以指定一个域名， 可以把需要用到的子域名也全部列出来&lt;/p>
&lt;p>自动运行的流程大概是这样的&lt;/p>
&lt;ul>
&lt;li>使用dnspod的api 自动生成所有的验证域名txt记录 _acme-challenge.example.com， 每个子域名也会有_acme-challenge.www.example.com&lt;/li>
&lt;li>等待dns记录生效，自动脚本会sleep 120 秒&lt;/li>
&lt;li>检查验证的dns记录， 没有问题的话签发证书保存到本地， 再次调用api 移除验证的域名&lt;/li>
&lt;li>创建crontab 自动更新相关证书。&lt;/li>
&lt;/ul>
&lt;p>生成好的证书位于 &lt;code>~/.acme.sh/www.example.com&lt;/code> 目录下, 至此证书就签发好了。&lt;/p>
&lt;p>另外自动创建的 crontab&lt;/p>
&lt;p>&lt;code>24 0 * * * &amp;quot;/home/tian/.acme.sh&amp;quot;/acme.sh --cron --home &amp;quot;/home/tian/.acme.sh&amp;quot; &amp;gt; /dev/null&lt;/code>&lt;/p>
&lt;p>应该会每天运行一次， 在证书过期前自动更新。&lt;/p></description></item><item><title>Ubuntu Server Install BBR</title><link>https://hitian.info/post/ubuntu-server-install-bbr/</link><pubDate>Tue, 07 Feb 2017 00:00:00 +0000</pubDate><guid>https://hitian.info/post/ubuntu-server-install-bbr/</guid><description>&lt;p>首先需要更新到4.9以上的内核版本， ubuntu和debian可以参考 &lt;a class="link" href="https://hitian.info/notes/2017/02/07/ubuntu-server-install-mainline-kernel/" target="_blank" rel="noopener"
>这里&lt;/a>&lt;/p>
&lt;p>重启确认内核版本升级完成继续&lt;/p>
&lt;p>以root用户执行以下命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;net.core.default_qdisc=fq&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;net.ipv4.tcp_congestion_control=bbr&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysctl -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>检查是否修改成功&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sysctl net.ipv4.tcp_available_congestion_control
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#结果如下， 包含bbr&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#net.ipv4.tcp_available_congestion_control = bbr cubic reno&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lsmod &lt;span class="p">|&lt;/span> grep bbr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#结果如下， 包含 tcp_bbr&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#tcp_bbr 20480 40&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Ubuntu Server Install Mainline Kernel</title><link>https://hitian.info/post/ubuntu-server-install-mainline-kernel/</link><pubDate>Tue, 07 Feb 2017 00:00:00 +0000</pubDate><guid>https://hitian.info/post/ubuntu-server-install-mainline-kernel/</guid><description>&lt;h3 id="下载最新的内核">下载最新的内核&lt;/h3>
&lt;p>&lt;!-- raw HTML omitted -->&lt;a class="link" href="http://kernel.ubuntu.com/~kernel-ppa/mainline/?C=N;O=D" target="_blank" rel="noopener"
>http://kernel.ubuntu.com/~kernel-ppa/mainline/?C=N;O=D&lt;/a>&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>进入最新的版本目录&lt;/p>
&lt;p>需要下载4个文件&lt;/p>
&lt;ul>
&lt;li>linux-headers-XXXXX_XXXXX_all.deb&lt;/li>
&lt;li>linux-headers-XXXXX-generic_XXXXX_PLATFORM.deb&lt;/li>
&lt;li>linux-image-unsigned-XXXXX-generic_XXXXX_PLATFORM.deb&lt;/li>
&lt;li>linux-modules-XXXXX-generic_XXXXX_PLATFORM.deb&lt;/li>
&lt;/ul>
&lt;p>例如目前最新的是v4.17.5 (2018-07-09), 下载这4个文件&lt;/p>
&lt;ul>
&lt;li>linux-headers-4.17.5-041705_4.17.5-041705.201807081431_all.deb&lt;/li>
&lt;li>linux-headers-4.17.5-041705-generic_4.17.5-041705.201807081431_amd64.deb&lt;/li>
&lt;li>linux-image-unsigned-4.17.5-041705-generic_4.17.5-041705.201807081431_amd64.deb&lt;/li>
&lt;li>linux-modules-4.17.5-041705-generic_4.17.5-041705.201807081431_amd64.deb&lt;/li>
&lt;/ul>
&lt;h3 id="安装">安装&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg -i *.deb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果安装报错提示&lt;code>libssl1.1&lt;/code>没有安装&lt;/p>
&lt;pre tabindex="0">&lt;code>Unpacking openssl (1.1.0g-2ubuntu5) over (1.0.2g-1ubuntu4.13) ...
dpkg: dependency problems prevent configuration of openssl:
openssl depends on libssl1.1 (&amp;gt;= 1.1.0); however:
Package libssl1.1 is not installed.
dpkg: error processing package openssl (--install):
dependency problems - leaving unconfigured
&lt;/code>&lt;/pre>&lt;p>可以从&lt;a class="link" href="http://security.ubuntu.com/ubuntu/pool/main/o/openssl/" target="_blank" rel="noopener"
>http://security.ubuntu.com/ubuntu/pool/main/o/openssl/&lt;/a> 下载安装&lt;/p>
&lt;p>注意: 如果使用的是linode， 还需要在后台调整 Configuration Profile &amp;gt; Boot Settings &amp;gt; Kernel 为 &lt;code>GRUB 2&lt;/code> 才能启动到更新后的内核。&lt;/p>
&lt;h3 id="安装完成后重启一下">安装完成后重启一下&lt;/h3>
&lt;p>确认一下内核是否升级成功&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">uname -a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Google Compute Engine 简单测试</title><link>https://hitian.info/post/google-compute-engine-simple-test/</link><pubDate>Tue, 17 Jan 2017 00:00:00 +0000</pubDate><guid>https://hitian.info/post/google-compute-engine-simple-test/</guid><description>&lt;p>这几天在试用Google Cloud Platform，觉得Compute Engine的运行速度貌似挺慢的，就测试了一下&lt;/p>
&lt;p>选了距离比较近的区域 asia-east1-a, 貌似是在台湾的。&lt;/p>
&lt;p>创建了3个不同配置的实例&lt;/p>
&lt;ol>
&lt;li>f1-micro（1 个 vCPU，0.6 GB 内存） &lt;code>$5.00/月&lt;/code>&lt;/li>
&lt;li>g1-small（1 个 vCPU，1.7 GB 内存） &lt;code>$15.73/月&lt;/code>&lt;/li>
&lt;li>n1-standard-1（1 个 vCPU，3.75 GB 内存）&lt;code>$28.50/月&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>系统都选择了 &lt;code>Ubuntu 16.04.1 LTS&lt;/code>&lt;/p>
&lt;h4 id="cpu测试">CPU测试&lt;/h4>
&lt;p>测试方式 Node.js v7.4.0 源代码编译 (时间统计方式 &lt;code>time make&lt;/code>)&lt;/p>
&lt;ol>
&lt;li>f1: 155m35.651s （两个多小时。。）&lt;/li>
&lt;li>g1: 55m9.996s&lt;/li>
&lt;li>n1: 28m27.362s&lt;/li>
&lt;/ol>
&lt;p>相比之下&lt;/p>
&lt;ul>
&lt;li>digitalocean &lt;code>$5.00/月&lt;/code> 的最低配用时 43m11.467s&lt;/li>
&lt;li>本地的笔记本i7-5557m的CPU使用2个核心 27m47.806s&lt;/li>
&lt;/ul>
&lt;p>另外f1和g1是共享cpu的
&lt;img src="https://hitian.info/assets/images/201701/GCE-Screen-Shot-2017-01-14-at-09.57.07.png" alt="GCE-cpu-Screen-Shot" />&lt;/p>
&lt;p>可以看到在cpu负载上升后可以超过限制运行短暂的时间。&lt;/p>
&lt;h4 id="然后测试一下磁盘的io">然后测试一下磁盘的IO&lt;/h4>
&lt;p>测试方式 直接使用 &lt;code>dd if=/dev/zero of=/var/swap.img bs=1024k count=1000&lt;/code> 创建一个1G的大文件&lt;/p>
&lt;ol>
&lt;li>f1: 1048576000 bytes (1.0 GB, 1000 MiB) copied, 25.6226 s, 40.9 MB/s&lt;/li>
&lt;li>g1: 1048576000 bytes (1.0 GB, 1000 MiB) copied, 21.2997 s, 49.2 MB/s&lt;/li>
&lt;li>n1: 1048576000 bytes (1.0 GB, 1000 MiB) copied, 4.83823 s, 217 MB/s&lt;/li>
&lt;/ol>
&lt;p>可以因为选择的是&lt;code>新的 10 GB 标准永久性磁盘&lt;/code>， 速度感觉一般般了&lt;/p>
&lt;p>相比之下digitalocean因为用的SSD, 速度快了不止一点
oc: 1048576000 bytes (1.0 GB, 1000 MiB) copied, 1.71034 s, 613 MB/s&lt;/p>
&lt;p>从简单的测试数据来看， 很明显如果是平时用来折腾的vps的话GCE性价比太低了。而且不知道为什么，GCE创建一个实例差不多要耗时2分钟左右😂&lt;/p>
&lt;h5 id="ps">ps&lt;/h5>
&lt;p>f1 默认的0.6G内存编译Node.js竟然会不够用。加了虚拟内存之后才顺利的编译完成&lt;/p>
&lt;p>Ubuntu 添加swap:&lt;/p>
&lt;p>&lt;code>dd if=/dev/zero of=/var/swap.img bs=1024k count=1000&lt;/code>&lt;/p>
&lt;p>&lt;code>mkswap /var/swap.img&lt;/code>&lt;/p>
&lt;p>&lt;code>swapon /var/swap.img&lt;/code>&lt;/p></description></item><item><title>OSX上不正确的字体设置导致部分软件崩溃的问题</title><link>https://hitian.info/post/sourcetree-crash-by-font-osx/</link><pubDate>Sun, 13 Mar 2016 00:00:00 +0000</pubDate><guid>https://hitian.info/post/sourcetree-crash-by-font-osx/</guid><description>&lt;p>SourceTree 和 FontBook 打开就崩溃有一段时间了. 部分crash log 如下;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Process: SourceTree &lt;span class="o">[&lt;/span>555&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Path: /Applications/SourceTree.app/Contents/MacOS/SourceTree
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Identifier: com.torusknot.SourceTreeNotMAS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Version: 2.2.2 &lt;span class="o">(&lt;/span>51&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Code Type: X86-64 &lt;span class="o">(&lt;/span>Native&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Parent Process: ??? &lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Responsible: SourceTree &lt;span class="o">[&lt;/span>555&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">User ID: &lt;span class="m">501&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Date/Time: 2016-03-13 15:34:07.628 +0800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS Version: Mac OS X 10.11.3 &lt;span class="o">(&lt;/span>15D21&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Report Version: &lt;span class="m">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Time Awake Since Boot: &lt;span class="m">550&lt;/span> seconds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System Integrity Protection: enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Crashed Thread: &lt;span class="m">15&lt;/span> Dispatch queue: com.apple.root.default-qos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Exception Type: EXC_BAD_ACCESS &lt;span class="o">(&lt;/span>SIGSEGV&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Exception Codes: KERN_INVALID_ADDRESS at 0x000007fc4a1f7ab0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Exception Note: EXC_CORPSE_NOTIFY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VM Regions Near 0x7fc4a1f7ab0:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Process Corpse Info 0000000128acb000-0000000128ccb000 &lt;span class="o">[&lt;/span> 2048K&lt;span class="o">]&lt;/span> rw-/rwx &lt;span class="nv">SM&lt;/span>&lt;span class="o">=&lt;/span>COW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> JS JIT generated code 00003a1034000000-00003a1034001000 &lt;span class="o">[&lt;/span> 4K&lt;span class="o">]&lt;/span> ---/rwx &lt;span class="nv">SM&lt;/span>&lt;span class="o">=&lt;/span>NUL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Application Specific Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">objc_msgSend&lt;span class="o">()&lt;/span> selector name: retain
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Thread 0:: Dispatch queue: com.apple.main-thread
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> com.apple.Foundation 0x000000010c558949 -&lt;span class="o">[&lt;/span>_NSCachedIndexSet autorelease&lt;span class="o">]&lt;/span> + &lt;span class="m">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> com.apple.AppKit 0x000000010d09762c -&lt;span class="o">[&lt;/span>NSTableView&lt;span class="o">(&lt;/span>NSTableViewViewBased&lt;span class="o">)&lt;/span> hiddenRowIndexes&lt;span class="o">]&lt;/span> + &lt;span class="m">56&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> com.apple.AppKit 0x000000010d0974ea -&lt;span class="o">[&lt;/span>_NSTableRowHeightStorage _normalComputeRectOfRow:assumingExists:&lt;span class="o">]&lt;/span> + &lt;span class="m">151&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">3&lt;/span> com.apple.AppKit 0x000000010cfcbf46 -&lt;span class="o">[&lt;/span>_NSTableRowHeightStorage computeRectOfRow:assumingExists:&lt;span class="o">]&lt;/span> + &lt;span class="m">167&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> com.apple.AppKit 0x000000010cfcbe5c -&lt;span class="o">[&lt;/span>NSTableView _rectOfRowAssumingRowExists:&lt;span class="o">]&lt;/span> + &lt;span class="m">178&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">5&lt;/span> com.apple.AppKit 0x000000010cfcbb80 -&lt;span class="o">[&lt;/span>NSTableView rectOfRow:&lt;span class="o">]&lt;/span> + &lt;span class="m">88&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">6&lt;/span> com.apple.AppKit 0x000000010cfd5e40 -&lt;span class="o">[&lt;/span>NSTableView frameOfCellAtColumn:row:&lt;span class="o">]&lt;/span> + &lt;span class="m">308&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">7&lt;/span> com.torusknot.SourceTreeNotMAS 0x000000010a45922e 0x10a330000 + &lt;span class="m">1217070&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">8&lt;/span> com.apple.AppKit 0x000000010d09a1f3 -&lt;span class="o">[&lt;/span>NSTableView drawRow:clipRect:&lt;span class="o">]&lt;/span> + &lt;span class="m">1144&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">9&lt;/span> com.apple.AppKit 0x000000010d099aeb -&lt;span class="o">[&lt;/span>NSTableView drawRowIndexes:clipRect:&lt;span class="o">]&lt;/span> + &lt;span class="m">919&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">10&lt;/span> com.apple.AppKit 0x000000010d098403 -&lt;span class="o">[&lt;/span>NSTableView drawRect:&lt;span class="o">]&lt;/span> + &lt;span class="m">1480&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">11&lt;/span> com.apple.AppKit 0x000000010cf311fe -&lt;span class="o">[&lt;/span>NSView&lt;span class="o">(&lt;/span>NSInternal&lt;span class="o">)&lt;/span> _recursive:displayRectIgnoringOpacity:inGraphicsContext:CGContext:topView:shouldChangeFontReferenceColor:&lt;span class="o">]&lt;/span> + &lt;span class="m">1331&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">12&lt;/span> com.apple.AppKit 0x000000010cf30b98 __46-&lt;span class="o">[&lt;/span>NSView&lt;span class="o">(&lt;/span>NSLayerKitGlue&lt;span class="o">)&lt;/span> drawLayer:inContext:&lt;span class="o">]&lt;/span>_block_invoke + &lt;span class="m">242&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">13&lt;/span> com.apple.AppKit 0x000000010cf30843 -&lt;span class="o">[&lt;/span>NSView&lt;span class="o">(&lt;/span>NSLayerKitGlue&lt;span class="o">)&lt;/span> _drawViewBackingLayer:inContext:drawingHandler:&lt;span class="o">]&lt;/span> + &lt;span class="m">2403&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">14&lt;/span> com.apple.AppKit 0x000000010cf2fed5 -&lt;span class="o">[&lt;/span>NSView&lt;span class="o">(&lt;/span>NSLayerKitGlue&lt;span class="o">)&lt;/span> drawLayer:inContext:&lt;span class="o">]&lt;/span> + &lt;span class="m">108&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">15&lt;/span> com.apple.AppKit 0x000000010d0d0d8c -&lt;span class="o">[&lt;/span>_NSBackingLayerContents drawLayer:inContext:&lt;span class="o">]&lt;/span> + &lt;span class="m">157&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">16&lt;/span> com.apple.QuartzCore 0x000000010f6d3927 -&lt;span class="o">[&lt;/span>CALayer drawInContext:&lt;span class="o">]&lt;/span> + &lt;span class="m">257&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">17&lt;/span> com.apple.AppKit 0x000000010d0d0862 -&lt;span class="o">[&lt;/span>_NSTiledLayer drawTile:inContext:&lt;span class="o">]&lt;/span> + &lt;span class="m">625&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">18&lt;/span> com.apple.AppKit 0x000000010d0d0593 -&lt;span class="o">[&lt;/span>_NSTiledLayerContents drawLayer:inContext:&lt;span class="o">]&lt;/span> + &lt;span class="m">185&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">19&lt;/span> com.apple.QuartzCore 0x000000010f6d3927 -&lt;span class="o">[&lt;/span>CALayer drawInContext:&lt;span class="o">]&lt;/span> + &lt;span class="m">257&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">20&lt;/span> com.apple.AppKit 0x000000010d0d04d1 -&lt;span class="o">[&lt;/span>NSTileLayer drawInContext:&lt;span class="o">]&lt;/span> + &lt;span class="m">169&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">21&lt;/span> com.apple.QuartzCore 0x000000010f6d1e79 CABackingStoreUpdate_ + &lt;span class="m">3494&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">22&lt;/span> com.apple.QuartzCore 0x000000010f6d10cd ___ZN2CA5Layer8display_Ev_block_invoke + &lt;span class="m">59&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">23&lt;/span> com.apple.QuartzCore 0x000000010f6c4d31 CA::Layer::display_&lt;span class="o">()&lt;/span> + &lt;span class="m">1565&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">24&lt;/span> com.apple.AppKit 0x000000010d0d03e8 -&lt;span class="o">[&lt;/span>NSTileLayer display&lt;span class="o">]&lt;/span> + &lt;span class="m">119&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">25&lt;/span> com.apple.AppKit 0x000000010d850b34 -&lt;span class="o">[&lt;/span>_NSTiledLayerContents update:shouldCallPrepareContent:&lt;span class="o">]&lt;/span> + &lt;span class="m">7131&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">26&lt;/span> com.apple.AppKit 0x000000010cf7aca4 -&lt;span class="o">[&lt;/span>_NSTiledLayer display&lt;span class="o">]&lt;/span> + &lt;span class="m">368&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">27&lt;/span> com.apple.QuartzCore 0x000000010f6c310d CA::Layer::display_if_needed&lt;span class="o">(&lt;/span>CA::Transaction*&lt;span class="o">)&lt;/span> + &lt;span class="m">603&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">28&lt;/span> com.apple.QuartzCore 0x000000010f6c278d CA::Layer::layout_and_display_if_needed&lt;span class="o">(&lt;/span>CA::Transaction*&lt;span class="o">)&lt;/span> + &lt;span class="m">35&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">29&lt;/span> com.apple.QuartzCore 0x000000010f6c1cf1 CA::Context::commit_transaction&lt;span class="o">(&lt;/span>CA::Transaction*&lt;span class="o">)&lt;/span> + &lt;span class="m">277&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">30&lt;/span> com.apple.QuartzCore 0x000000010f6c1a24 CA::Transaction::commit&lt;span class="o">()&lt;/span> + &lt;span class="m">508&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">31&lt;/span> com.apple.QuartzCore 0x000000010f6d0917 CA::Transaction::observer_callback&lt;span class="o">(&lt;/span>__CFRunLoopObserver*, unsigned long, void*&lt;span class="o">)&lt;/span> + &lt;span class="m">71&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">32&lt;/span> com.apple.CoreFoundation 0x000000010b469e37 __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + &lt;span class="m">23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">33&lt;/span> com.apple.CoreFoundation 0x000000010b469da7 __CFRunLoopDoObservers + &lt;span class="m">391&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">34&lt;/span> com.apple.CoreFoundation 0x000000010b45b358 CFRunLoopRunSpecific + &lt;span class="m">328&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">35&lt;/span> com.apple.HIToolbox 0x00000001101cf935 RunCurrentEventLoopInMode + &lt;span class="m">235&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">36&lt;/span> com.apple.HIToolbox 0x00000001101cf76f ReceiveNextEventCommon + &lt;span class="m">432&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">37&lt;/span> com.apple.HIToolbox 0x00000001101cf5af _BlockUntilNextEventMatchingListInModeWithFilter + &lt;span class="m">71&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">38&lt;/span> com.apple.AppKit 0x000000010cecd0ee _DPSNextEvent + &lt;span class="m">1067&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">39&lt;/span> com.apple.AppKit 0x000000010d299943 -&lt;span class="o">[&lt;/span>NSApplication _nextEventMatchingEventMask:untilDate:inMode:dequeue:&lt;span class="o">]&lt;/span> + &lt;span class="m">454&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">40&lt;/span> com.apple.AppKit 0x000000010cec2fc8 -&lt;span class="o">[&lt;/span>NSApplication run&lt;span class="o">]&lt;/span> + &lt;span class="m">682&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">41&lt;/span> com.apple.AppKit 0x000000010ce45520 NSApplicationMain + &lt;span class="m">1176&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">42&lt;/span> libdyld.dylib 0x0000000111d135ad start + &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看出来应该是字体导致的问题, 尝试了网上的大部分解决方案, 包括 清理 &lt;code>Library/FontCollections&lt;/code>, 重建缓存什么的, 都没有效果.&lt;/p>
&lt;p>但是在GUEST账户下, 并没有崩溃的问题, 猜测和当前用户的某些配置有问题.&lt;/p>
&lt;p>终端执行 &lt;code>defaults read &amp;gt; ~/Downloads/defaults.txt&lt;/code> 导出当前用户的配置信息.&lt;/p>
&lt;p>全局搜索&lt;code>NSFont&lt;/code>, 在 &lt;code>Apple Global Domain&lt;/code> 节点下发现了 &lt;code>NSFont = MicrosoftYaHei;&lt;/code>&lt;/p>
&lt;p>看起来是之前测试MS Office 留下的. 卸载之后估计 MicrosoftYaHei 也没有了.&lt;/p>
&lt;p>打开 &lt;code>TinkerTool&lt;/code> &amp;raquo; &lt;code>Fonts&lt;/code> 使用 &lt;code>Set to default&lt;/code> 之后崩溃的问题全部解决了.&lt;/p></description></item><item><title>ubuntu 通过apt 安装 mongodb 3.0</title><link>https://hitian.info/post/ubuntu-install-mongodb-3.0-with-apt/</link><pubDate>Sat, 11 Jul 2015 00:00:00 +0000</pubDate><guid>https://hitian.info/post/ubuntu-install-mongodb-3.0-with-apt/</guid><description>&lt;p>ubuntu version:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DISTRIB_ID&lt;/span>&lt;span class="o">=&lt;/span>Ubuntu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DISTRIB_RELEASE&lt;/span>&lt;span class="o">=&lt;/span>15.04
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DISTRIB_CODENAME&lt;/span>&lt;span class="o">=&lt;/span>vivid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DISTRIB_DESCRIPTION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Ubuntu 15.04&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>新建文件 &lt;code>/etc/apt/sources.list.d/mongodb-org-3.0.list&lt;/code> 内容如下 (使用aliyun的mirror进行加速)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">deb http://mirrors.aliyun.com/mongodb/apt/ubuntu/ trusty/mongodb-org/3.0 multiverse
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>添加key &amp;amp; update apt:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装 mongodb 最新版本&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt-get install mongodb-org
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>目前安装的版本&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">~$ mongo --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MongoDB shell version: 3.0.4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>nodejs 相关的墙内加速</title><link>https://hitian.info/post/nodejs-npm-build-speed-up/</link><pubDate>Mon, 06 Apr 2015 00:00:00 +0000</pubDate><guid>https://hitian.info/post/nodejs-npm-build-speed-up/</guid><description>&lt;p>npm的加速比较简单, 直接使用淘宝的 &lt;a class="link" href="http://npm.taobao.org/" target="_blank" rel="noopener"
>http://npm.taobao.org/&lt;/a> 就可以了.&lt;/p>
&lt;p>建议直接安装 cnpm, 方便一点&lt;/p>
&lt;p>&lt;code>npm install -g cnpm --registry=https://registry.npm.taobao.org&lt;/code>&lt;/p>
&lt;p>使用的时候直接用&lt;code>cnpm&lt;/code>替代&lt;code>npm&lt;/code>就可以了. 例如:&lt;/p>
&lt;p>&lt;code>cnpm install mongodb&lt;/code>&lt;/p>
&lt;p>也可以在使用npm 的时候单独指定&lt;/p>
&lt;p>&lt;code>npm install xxx --registry=https://registry.npm.taobao.org&lt;/code>&lt;/p>
&lt;p>这样就快多了.&lt;/p>
&lt;p>另外有时候 node-gyp rebuild 过程中下载相应node版本也很慢.&lt;/p>
&lt;p>看提示去手动下载需要的node版本.&lt;/p>
&lt;p>例如 node-v0.12.2.tar.gz&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">tar zcvf node-v0.12.2.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv ./node-v0.12.2 ~/.node-gyp/0.12.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch ~/.node-gyp/0.12.2/installVersion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;9&amp;#34;&lt;/span> &amp;gt;~/.node-gyp/0.12.2/installVersion
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>TP-LINK TL-WR703N 刷 OpenWRT</title><link>https://hitian.info/post/tp-link-tl-wr703n-v1.7-openwrt/</link><pubDate>Sat, 21 Mar 2015 00:00:00 +0000</pubDate><guid>https://hitian.info/post/tp-link-tl-wr703n-v1.7-openwrt/</guid><description>&lt;p>版本号: ver 1.7&lt;/p>
&lt;p>原始固件版本: 3.17.1 Build 140120 Rel.56593n&lt;/p>
&lt;p>尝试了一下, 这个版本是不能通过web上传非官方的固件, 尝试上传openwrt会报错&lt;/p>
&lt;p>&lt;code>错误代码：18005 上传的文件版本与机型不符。&lt;/code>&lt;/p>
&lt;p>评论说是加了签名的的原因.&lt;/p>
&lt;p>google了下找到这篇文章:&lt;/p>
&lt;p>&lt;a class="link" href="http://www.shadowandy.net/2015/03/flashing-tp-link-tl-wr703n-v1-7-to-openwrt.htm" target="_blank" rel="noopener"
>http://www.shadowandy.net/2015/03/flashing-tp-link-tl-wr703n-v1-7-to-openwrt.htm&lt;/a>&lt;/p>
&lt;p>大家可以参照做一下.&lt;/p>
&lt;h2 id="严重警告-刷机需谨慎-我是准备好ttl线才动手的-如果没有最好不要冒险-很容易变砖的">严重警告, 刷机需谨慎, 我是准备好TTL线才动手的, 如果没有最好不要冒险, 很容易变砖的&amp;hellip;&lt;/h2>
&lt;p>先按步骤生成或下载这四个要放在tftp下的文件:&lt;/p>
&lt;ol>
&lt;li>aa&lt;/li>
&lt;li>i1&lt;/li>
&lt;li>i2&lt;/li>
&lt;li>busybox&lt;/li>
&lt;/ol>
&lt;p>我使用过的打包共享一下 &lt;a class="link" href="http://pan.baidu.com/s/1bno6923" target="_blank" rel="noopener"
>百度网盘下载&lt;/a>&lt;/p>
&lt;p>核心的3条命令:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -o - -b &lt;span class="s2">&amp;#34;tLargeScreenP=1; subType=pcSub; Authorization=Basic%20YWRtaW46YWRtaW40Mg%3D%3D; ChgPwdSubTag=true&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;http://192.168.1.1/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -o - -b &lt;span class="s2">&amp;#34;tLargeScreenP=1; subType=pcSub; Authorization=Basic%20YWRtaW46YWRtaW40Mg%3D%3D; ChgPwdSubTag=&amp;#34;&lt;/span> --referer &lt;span class="s2">&amp;#34;http://192.168.1.1/userRpm/ParentCtrlRpm.htm&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;http://192.168.1.1/userRpm/ParentCtrlRpm.htm?ctrl_enable=1&amp;amp;parent_mac_addr=00-00-00-00-00-02&amp;amp;Page=1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -o - -b &lt;span class="s2">&amp;#34;tLargeScreenP=1; subType=pcSub; Authorization=Basic%20YWRtaW46YWRtaW40Mg%3D%3D; ChgPwdSubTag=&amp;#34;&lt;/span> --referer &lt;span class="s2">&amp;#34;http://192.168.1.1/userRpm/ParentCtrlRpm.htm?Modify=0&amp;amp;Page=1&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;http://192.168.1.1/userRpm/ParentCtrlRpm.htm?child_mac=00-00-00-00-00-01&amp;amp;lan_lists=888&amp;amp;url_comment=test&amp;amp;url_0=;cd%20/tmp;&amp;amp;url_1=;tftp%20-gl%20aa%20192.168.1.9;&amp;amp;url_2=;sh%20aa;&amp;amp;url_3=&amp;amp;url_4=&amp;amp;url_5=&amp;amp;url_6=&amp;amp;url_7=&amp;amp;scheds_lists=255&amp;amp;enable=1&amp;amp;Changed=1&amp;amp;SelIndex=0&amp;amp;Page=1&amp;amp;rule_mode=0&amp;amp;Save=%B1%A3+%B4%E6&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>有几点要注意的:&lt;/p>
&lt;ol>
&lt;li>tftp需要运行在windows上, 而且要使用32位的版本, (Mac上的tftp尝试过无效的). 将ip调整为192.168.1.9&lt;/li>
&lt;li>另外执行命令之前需要先在管理界面执行&lt;code>恢复出厂&lt;/code>, 重启完不要设置密码, 直接开始.&lt;/li>
&lt;li>windows需要自己装curl.&lt;/li>
&lt;li>最后的一条命令比较慢, 一定要等到路由器的灯不在闪了, 或者直接在电脑上打开&lt;a class="link" href="http://192.168.1.1" target="_blank" rel="noopener"
>http://192.168.1.1&lt;/a>不断的刷新, 什么时候看到OpenWrt的界面了就好了.&lt;/li>
&lt;/ol>
&lt;p>然后插个U盘, 升级一下空间, 就可以尽情折腾了.&lt;/p>
&lt;p>完成后:&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/201503/tl-wr703n-openwrt.png" >&lt;img src="https://hitian.info/assets/images/201503/tl-wr703n-openwrt.png" alt="image" title="升级画面" />&lt;/a>&lt;/p>
&lt;p>最后感谢一下原文的作者, 因为有这些无私共享的人, 世界才会更美好.&lt;/p>
&lt;p>还要感谢一下google, 让我很快找到了这篇文章.&lt;/p></description></item><item><title>手动从OTA包升级nexus 5</title><link>https://hitian.info/post/manually-update-nexus-5-from-ota/</link><pubDate>Fri, 20 Mar 2015 00:00:00 +0000</pubDate><guid>https://hitian.info/post/manually-update-nexus-5-from-ota/</guid><description>&lt;p>Android 5.1 发布已经有一段时间了, nexus5的ROM出来也有一段时间了, 但是OTA一直不推送, 挺着急的. google了一下, 决定自己升级一下.&lt;/p>
&lt;p>####先去下载OTA的升级包&lt;/p>
&lt;p>nexus5 从5.0.1 到 5.1 的包: &lt;a class="link" href="http://pan.baidu.com/s/1jGIe4KY" target="_blank" rel="noopener"
>百度网盘&lt;/a>&lt;/p>
&lt;p>其他的这里下载: &lt;a class="link" href="http://www.androidguys.com/2015/03/17/all-the-android-5-1-ota-download-links/" target="_blank" rel="noopener"
>link&lt;/a>&lt;/p>
&lt;p>####其他的准备&lt;/p>
&lt;ul>
&lt;li>没有adb的先去装一下&lt;/li>
&lt;li>将手机的&lt;code>开发者模式&lt;/code>打开(连按&lt;code>关于手机&lt;/code>中的&lt;code>版本号&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>####开始了&lt;/p>
&lt;ol>
&lt;li>先关机&lt;/li>
&lt;li>按住 &lt;code>音量下&lt;/code> 和 &lt;code>电源键&lt;/code> 启动进入&lt;code>FASTBOOT MODE&lt;/code>&lt;/li>
&lt;li>按&lt;code>音量上下&lt;/code> 选择 &lt;code>Recovery mode&lt;/code>, 按&lt;code>电源键&lt;/code>进入&lt;/li>
&lt;li>自动重启后会显示一个感叹号的机器人, 下面显示&lt;code>无命令&lt;/code>, 按住&lt;code>音量上&lt;/code>和&lt;code>电源键&lt;/code>进入recovery 的菜单.&lt;/li>
&lt;li>选择&lt;code>apply update from ADB&lt;/code> 并确定&lt;/li>
&lt;li>连接手机到电脑, 命令行进入下载的包目录, 执行&lt;code>adb sideload update.zip&lt;/code>&lt;/li>
&lt;li>等待完成, 大概需要6分钟左右, 然后选择 &lt;code>reboot system now&lt;/code>&lt;/li>
&lt;li>完成了.&lt;/li>
&lt;/ol>
&lt;p>升级完成了:&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/201503/nexus5_ota_1.jpg" >&lt;img src="https://hitian.info/assets/images/201503/nexus5_ota_1.jpg" alt="image" title="升级画面" />&lt;/a>&lt;/p>
&lt;p>重新启动过程中会升级已有的App, 这个只能耐心等待了..&lt;/p>
&lt;p>参考: &lt;a class="link" href="http://www.androidbeat.com/2014/12/manually-sideload-android-lollipop-update-nexus-5/" target="_blank" rel="noopener"
>http://www.androidbeat.com/2014/12/manually-sideload-android-lollipop-update-nexus-5/&lt;/a>&lt;/p></description></item><item><title>我的第一个游戏开发历程</title><link>https://hitian.info/post/my-first-game/</link><pubDate>Thu, 22 Jan 2015 00:00:00 +0000</pubDate><guid>https://hitian.info/post/my-first-game/</guid><description>&lt;p>到今天为止, 折腾了10个月的游戏终于结束了, 虽然google play store的版本已经上架有一段时间了, iOS的还正在审核中, 不过后续的版本应该已经不会再开发了. 也算是这10个月的努力没有白费.&lt;/p>
&lt;p>###2013年3月###&lt;/p>
&lt;p>正在维护后端的游戏进入了最后阶段, 虽然每天都还有不少的收入, 但对于一个不算小的游戏公司来说跨国的运营已经太费力了. 于是决定一段时间后就不在进行更新了, 等玩家流失,然后关服. 项目组的人员开始慢慢的调到其他的项目组. 然后, leader问我愿不愿意跟他去开发个新游戏, 然后就去了.&lt;/p>
&lt;p>话说从大三起就一直在进行web开发, 毕业后的3年也是, 对手机端游戏开发毫无概念, 老大们决定要用js作为主要的开发语言, 然后就突然想换一下口味, 正好公司也允许我们边学边做, 然后就开始转到客户端开发了.&lt;/p>
&lt;p>###cocos2d-x + javascript###&lt;/p>
&lt;p>做web时也一直在接触js, 这方面不算陌生. cocos2d-x游戏引擎对我来说是个新的事物, 但是学习新的事物如果有一套自己的学习方式其实也是很快的, 游戏ui画面的组织其实和大学时课设做的java图形界面有点类似, 把所有的元素添加到一个树状的UI树上去, 然后在scene上显示出来, 不同的是游戏有一个主循环, 在里面进行必要的动画操作, 响应用户的操作或者是服务器的返回值对UI树进行更改.&lt;/p>
&lt;p>从0开始, 在伟大的google的帮助下, 仅仅第10天第一个demo就出来了, 虽然只有一个场景, 但是核心的消除逻辑已经可以初步使用了. 然后就立即有信心了. 项目也就正式开始了.&lt;/p>
&lt;p>###坑的开始…###&lt;/p>
&lt;p>Facebook, 因为是要在台湾发行的游戏, 决定深度整合Facebook. 由于某些原因, 即使有专线,和Facebook服务的通讯通畅度也根本就是个悲剧, 开发和测试过程中各种调用异常, 一句话, 不要在国内做这方面的开发.&lt;/p>
&lt;p>js作为开发语言是很方便, 但是如果和第三方sdk的交互比较多, 想象一下操作链: js =&amp;gt; js解释器 =&amp;gt; c++ =&amp;gt; jni =&amp;gt; java, 特别是js和c++ 是完全不同的语言类型, 我们需要做好多的接口和回调, 又是在android上运行, 互相调用时会发生各种各样的崩溃问题. 要特别感谢一下iOS没让我们在这方便花费太多的时间.&lt;/p>
&lt;p>###人永远都是很缺的###&lt;/p>
&lt;p>说起来程序应该是很多的, 但是感觉一直招不到人, 整个项目程序最多的时候也就3个正式员工加两个实习生. 大部分时间都只有两个程序, 而且服务端和客户端都要做. 还好只是不指望赚多少钱的休闲类游戏, 大部分时间也没有那么赶进度. 另外, 因为招不到正式员工, 就招很多实习生来补空缺其实挺不道德的, 根本算不上培养, 对别人的阅历其实也没什么作用. 另外, 人少就意味着各个方面都要自己动手做, 积累经验确实是快.&lt;/p>
&lt;p>###说到底还是要赚钱###&lt;/p>
&lt;p>虽然一开始立项就说没指望赚多少钱, 尝试一下新游戏类型, 积累用户. 其实公司还是很在乎钱的问题, 毕竟开发是要成本的. 开始还是很开心的, 关注的都是如何提高游戏核心玩法的品质, 然后慢慢的慢慢的关注的问题就变成了怎么赚钱, 周边的内容各种改动, 商店, 道具改了又改. 算了一下, 其实游戏的核心内容开发的时间加起来4个月都不到, 我们到底在做什么? 现实和理想的区别还是比较大的. 我也一直在纳闷为什么国人就做不出像纪念碑谷这样的游戏…&lt;/p>
&lt;p>###In the end,###&lt;/p>
&lt;p>游戏cbt之后, 其实能感觉到策划同学心不在焉已经有一段时间了. 这就意味着游戏的开发也要告一段落了. 只是没想到会这么快到来. android版本上线之后的数据并不是很理想(其实是赚的钱不是很理想), 不推广游戏是肯定是不行的, 但是推广的的成本能不能赚回来就是个问题了, 不赚钱是个硬伤啊.. 然后就没有然后了&amp;hellip;&lt;/p>
&lt;p>对于公司来说, 几个人做了一把尝试, 也培养了人才, 没什么损失, 对于我们来说也是, 从0开始学了不少东西, 也积累了不少经验. 没有像其他项目组有kpi追着经常没日没夜的加班. 日子过的还算逍遥. 只是就这样匆匆的结束了, 难免有些凄凉. 毕竟这是我开发的第一个游戏, 总想着有始有终. 我们是玩着游戏长大的一代人, 小时候也总想着有一天能自己亲自开发一个游戏, 也算实现了一个心愿吧.&lt;/p>
&lt;p>好吧, 就到这里了. 这就是我的第一个游戏的开发历程了.&lt;/p>
&lt;p>附上游戏的下载链接:&lt;/p>
&lt;p>Google Play Store(台湾地区): &lt;a class="link" href="https://play.google.com/store/apps/details?id=tw.mobage.g22000019" target="_blank" rel="noopener"
>link&lt;/a>&lt;/p>
&lt;p>话说google的分区太恶心了, 给个apk链接吧 &lt;a class="link" href="http://pan.baidu.com/s/1mgzbOqG" target="_blank" rel="noopener"
>link&lt;/a>&lt;/p>
&lt;p>App Store: &lt;a class="link" href="https://itunes.apple.com/tw/app/yi-qi-fa/id907047131?l=zh&amp;amp;ls=1&amp;amp;mt=8" target="_blank" rel="noopener"
>link&lt;/a>&lt;/p></description></item><item><title>cocos2d-x 出现 call to OpenGL ES API with no current context</title><link>https://hitian.info/post/cocos2d-x-android-call-to-opengl-es-api-with-no-current-context/</link><pubDate>Fri, 05 Sep 2014 00:00:00 +0000</pubDate><guid>https://hitian.info/post/cocos2d-x-android-call-to-opengl-es-api-with-no-current-context/</guid><description>&lt;p>环境 cocos2d-x 2.2.2 + js&lt;/p>
&lt;p>游戏的某些功能界面在Android出现了很奇怪的黑块, LOG记录到&lt;/p>
&lt;p>&lt;code>E/libEGL (30687): call to OpenGL ES API with no current context (logged once per thread)&lt;/code>&lt;/p>
&lt;p>google一下, 大概的原因可能是在非UI线程上操作场景上的图片资源导致的. 但是网上的情况绝大多数情况出现在 java 操作 c++ 层时出现的, 而我们是直接出现在js的回调方法中.&lt;/p>
&lt;p>回调是由某sdk执行的, 通过 &lt;code>java -&amp;gt; c++ -&amp;gt; js&lt;/code> 一层层回来的.&lt;/p>
&lt;p>也就是说最终js的回调有可能是执行在非ui线程里的, 所以在这里更新界面有可能会出现问题.&lt;/p>
&lt;p>囧&amp;hellip;&lt;/p>
&lt;p>推测&lt;/p>
&lt;p>js无法决定自己运行在什么线程里, 但是可以控制界面更新在UI线程里操作.&lt;/p>
&lt;p>我们的流程是这样的.&lt;/p>
&lt;p>&lt;code>sdk -&amp;gt; someService -&amp;gt; controller -&amp;gt; view&lt;/code>&lt;/p>
&lt;p>那其实我们可以打断someService 和 controller 之间的直接调用关系. 分成两步来执行.&lt;/p>
&lt;p>&lt;code>sdk -&amp;gt; someService -&amp;gt; [write status mark &amp;amp; store params]&lt;/code>&lt;/p>
&lt;p>写完状态就可以直接返回了. 剩下的事情由游戏的循环来做. 游戏的循环本来就是负责界面更新的, 所以肯定不会有问题.&lt;/p>
&lt;p>&lt;code>gameloop -&amp;gt; [check status mark &amp;amp; do it]&lt;/code>&lt;/p>
&lt;p>可以采用在游戏循环里去重复检测需要执行的方法. 当然如果只是一次调用最省资源的还是直接用cocos2d-x 提供的scheduler相关的方法.&lt;/p>
&lt;p>android在游戏开发方面的表现确实很奇葩, 加上某些不开源的SDK, 会出现什么问题就很难预测了, 为了以防万一, 甚至可以在someService -&amp;gt; controller 之前加一个的操作队列来彻底隔离有可能在错误的线程执行的问题.&lt;/p></description></item><item><title>cocos2d-x2.2.2 触摸事件的遮挡</title><link>https://hitian.info/post/cocos2d-x-touch-layer-block/</link><pubDate>Wed, 02 Apr 2014 00:00:00 +0000</pubDate><guid>https://hitian.info/post/cocos2d-x-touch-layer-block/</guid><description>&lt;p>环境 cocos2d-x 2.2.2 + js&lt;/p>
&lt;p>例如一个这样的界面&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/201404/2014-04-02-cocos2dx-layer-block.png" >&lt;img src="https://hitian.info/assets/images/201404/2014-04-02-cocos2dx-layer-block.png" alt="image" title="image" />&lt;/a>&lt;/p>
&lt;p>左上角的设置使用 cc.MenuItemSprite, 弹出的遮罩层和上面的按钮需要优先获取touch事件, 并阻止向后继续传播.&lt;/p>
&lt;p>这里需要两个点就可以做到.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">bgLayer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">cc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LayerColor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">extend&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctor&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_super&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">associateWithNative&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LayerColor&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">registerTargetedDelegate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">129&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//1.设置触摸的优先级
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setTouchEnabled&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">onTouchBegan&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">touches&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;TouchBegan: &amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//2. 在onTouchXXX 回调里返回true来吞噬掉touch事件
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">onTouchesBegan&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">touches&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">loc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">touches&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">getLocation&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;TouchesBegan: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">loc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; : &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">loc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">y&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="1设置触摸的优先级">1.设置触摸的优先级&lt;/h3>
&lt;p>在layer创建的时候使用 &lt;code>cc.registerTargetedDelegate(-129, true, this);&lt;/code> 来设置优先级(第1个参数)&lt;/p>
&lt;p>这里的数字越小, 优先级越高,&lt;/p>
&lt;p>另外要注意的是 MenuItem 的优先级是&lt;code>-128&lt;/code>, 所以要遮挡上上面的设置按钮, 遮盖层的优先级必须小于它.&lt;/p>
&lt;h3 id="2在ontouchxxx-回调里返回true来吞噬掉touch事件">2.在onTouchXXX 回调里返回true来吞噬掉touch事件.&lt;/h3>
&lt;p>这里注意不是 onTouchesXXX, 看了下c++的说明, 因为多点的触摸使用的StandardDelegate并没有吃掉该事件的相关参数, 所以在onTouchesXXX 里 &lt;code>return true&lt;/code> 是没有用的.&lt;/p>
&lt;p>PS 之前一直用的onTouchesXXX 来处理触摸的, 没发现居然不一样, 这个问题折腾了2个多小时, api里没有, 网上查到的各种说明都是c++的. 坑啊&amp;hellip;&lt;/p></description></item><item><title>cocos2d-x2.2.2在xcode5.1下编译问题临时解决</title><link>https://hitian.info/post/xcode5.1-cocos2d-x-error/</link><pubDate>Sat, 15 Mar 2014 00:00:00 +0000</pubDate><guid>https://hitian.info/post/xcode5.1-cocos2d-x-error/</guid><description>&lt;p>iOS7.1发布之后Xcode也更新到5.1了, 然后之前的程序就跑不起来了. 网上找的解决.&lt;/p>
&lt;p>如果出现&lt;/p>
&lt;p>&lt;code>Unknown register name 'q0' in asm&lt;/code>&lt;/p>
&lt;p>请参照 &lt;a class="link" href="http://stackoverflow.com/questions/21510187/unknown-register-name-q0-in-asm" target="_blank" rel="noopener"
>http://stackoverflow.com/questions/21510187/unknown-register-name-q0-in-asm&lt;/a>&lt;/p>
&lt;p>将 &lt;code>neon_matrix_impl.c&lt;/code> 中的 &lt;code>#if defined(ARM_NEON)&lt;/code> 修改为 &lt;code>#if defined(_ARM_ARCH_7)&lt;/code>&lt;/p>
&lt;p>另外出现的&lt;/p>
&lt;p>&lt;code>EAGLView.mm:408:18: Cast from pointer to smaller type 'int' loses information&lt;/code>&lt;/p>
&lt;p>可以参照 &lt;a class="link" href="http://www.cocoachina.com/bbs/read.php?tid=193991#902811" target="_blank" rel="noopener"
>http://www.cocoachina.com/bbs/read.php?tid=193991#902811&lt;/a> 5楼给出的方案修改 Targets—&amp;gt;Build Settings—&amp;gt;Architectures 的配置, 将64bit的给去掉.&lt;/p>
&lt;p>PS. 突然觉得作为刚开始入门的新手, 还是得谨慎升级. 特别是解释型脚本语言用习惯, 处理编译问题真头大.&lt;/p></description></item><item><title>cocos2d-x 入门笔记</title><link>https://hitian.info/post/cocos2d-x-note/</link><pubDate>Thu, 13 Mar 2014 00:00:00 +0000</pubDate><guid>https://hitian.info/post/cocos2d-x-note/</guid><description>&lt;p>首先cocos2d-x开发游戏确实还是比较简单的. 因为可以使用js作为开发语言, 本来就会js的人入门会更快, 不过市面上的书和网上的各种教程基本都是用c++的, 所以学习过程中还是走了不少弯路.&lt;/p>
&lt;p>目前使用js作为开发语言的话, 可以在iOS, Android, Windows 上运行, 开发环境可以是MacOS+Xcode 或者Windows+VS, 不过Windows上那是非常的慢. 所以下面的都是在Mac下的.&lt;/p>
&lt;p>开始了&amp;hellip;&lt;/p>
&lt;p>官网: &lt;a class="link" href="http://www.cocos2d-x.org/" target="_blank" rel="noopener"
>http://www.cocos2d-x.org/&lt;/a>
&lt;code>如果很慢请尝试使用代理&lt;/code>&lt;/p>
&lt;p>##api文档##&lt;/p>
&lt;p>&lt;a class="link" href="http://www.cocos2d-x.org/wiki/Reference" target="_blank" rel="noopener"
>官方api文档地址&amp;raquo;&lt;/a>&lt;/p>
&lt;p>对api的使用建议: 如果是使用js开发手机native的游戏的话, 可以使用Cocos2d-html5 的api文档配合Cocos2d-X的文档看, 因为Cocos2d-x的文档主要以c++的为主, 看js的话用起来非常的不方便, 所以我平时都是直接看html5的, 有问题的话再查一下c++的.&lt;/p>
&lt;p>##创建项目##&lt;/p>
&lt;p>这是第一个坑, 目前的稳定版本是2.2.2. 大部分书还是2.2的版本, 书里介绍的导入xcode模板的脚本现在已经没有了, 现在需要执行脚本直接生成工程.&lt;/p>
&lt;p>脚本地址 &lt;code>cocos2d-x-2.2.2/tools/project-creator/create_project.py&lt;/code>&lt;/p>
&lt;p>建议使用 &lt;code>python2.7&lt;/code> 来执行, 最新版的python貌似有问题&lt;/p>
&lt;p>直接执行会有参数的提示, 把参数都补上再执行一遍项目就应该创建好了.&lt;/p>
&lt;p>生成的项目会放在 &lt;code>cocos2d-x-2.2.2/projects/&lt;/code> 目录下. iOS的xcode工程在 proj.ios 下面. 要运行非常简单, 直接在Xcode里点运行就可以直接在模拟器上运行自带的HelloWorld程序了. android的运行可能要稍微麻烦一点, 可以自行Google.&lt;/p>
&lt;p>##学习##&lt;/p>
&lt;p>因为这方面的资料大部分都是c++的, 所以学习也基本是从看c++的书开始, 其实也不用会c++, 看书主要是为了大概知道cocos2d-x是如何工作的, 都有什么样的方法或者工具可以使用, 接下来就是看源代码包里提供的js的示例项目, 看一下js是怎么实现各种功能的.&lt;/p>
&lt;p>官方给了5个js的示例项目, 在目录: &lt;code>cocos2d-x-2.2.2/samples/Javascript/&lt;/code> 下, 注意js的源代码放在公用的 &lt;code>cocos2d-x-2.2.2/samples/Javascript/Shared/games&lt;/code> 目录下. 认真研究一下这些代码, 在配合api文档基本上就可以开始尝试着开发自己的游戏了. 入门还是比较简单的.&lt;/p></description></item><item><title>virtualbox 禁止时间同步</title><link>https://hitian.info/post/virtualbox-disable-time-sync/</link><pubDate>Fri, 20 Sep 2013 00:00:00 +0000</pubDate><guid>https://hitian.info/post/virtualbox-disable-time-sync/</guid><description>&lt;p>virtualbox 会自动同步虚拟机的时间, 看起来很方便, 却给开发造成了不小的麻烦.&lt;/p>
&lt;p>cmd进入virtualbox的目录 ,一般在&lt;/p>
&lt;p>&lt;code>C:\Program Files\Oracle\VirtualBox\&lt;/code>&lt;/p>
&lt;p>网上说命令的格式为&lt;/p>
&lt;p>&lt;code>vboxmanage setextradata &amp;lt;vmname&amp;gt; &amp;quot;VBoxInternal/Devices/VMMDev/0/Config/GetHostTimeDisabled&amp;quot; &amp;quot;1&amp;quot;&lt;/code>&lt;/p>
&lt;p>看了下说明. 如果懒得去找 &lt;!-- raw HTML omitted -->, 可以使用global 直接修改全局的配置&lt;/p>
&lt;p>执行&lt;/p>
&lt;p>&lt;code>./vboxmanage.exe setextradata global &amp;quot;VBoxInternal/Devices/VMMDev/0/Config/GetHostTimeDisabled&amp;quot; &amp;quot;1&amp;quot;&lt;/code>&lt;/p>
&lt;p>然后重启虚拟机实测对guest是linux 的有效&lt;/p></description></item><item><title>设置git忽略服务器证书校验错误</title><link>https://hitian.info/post/git-ignore-certificate-check/</link><pubDate>Sun, 23 Jun 2013 00:00:00 +0000</pubDate><guid>https://hitian.info/post/git-ignore-certificate-check/</guid><description>&lt;p>将自己的git服务器切换到https后clone时发生错误&lt;/p>
&lt;pre tabindex="0">&lt;code>error: SSL certificate problem, verify that the CA cert is OK. Details:
error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed while accessing https://...
&lt;/code>&lt;/pre>&lt;p>因为证书是自己颁发的无法通过CA的校验&lt;/p>
&lt;p>&lt;code>git config --global http.sslVerify false&lt;/code>&lt;/p>
&lt;p>这样就可以忽略校验了.&lt;/p>
&lt;p>话说gitlab版本从5.2升级到5.3还真顺利, 升级文档: &lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/update/5.2-to-5.3.md" title="https://github.com/gitlabhq/gitlabhq/blob/master/doc/update/5.2-to-5.3.md"
target="_blank" rel="noopener"
>https://github.com/gitlabhq/gitlabhq/blob/master/doc/update/5.2-to-5.3.md&lt;/a>&lt;/p></description></item><item><title>redis使用笔记</title><link>https://hitian.info/post/redis-notes/</link><pubDate>Fri, 12 Apr 2013 00:00:00 +0000</pubDate><guid>https://hitian.info/post/redis-notes/</guid><description>&lt;p>根据 &lt;a class="link" href="http://redis.io" target="_blank" rel="noopener"
>http://redis.io&lt;/a> 的说明， redis支持 string， list， set， sorted set 和 hash 这五种数据类型， php中可能经常需要直接把array 直接存起来。&lt;/p>
&lt;p>仔细看了下 &lt;a class="link" href="https://github.com/nicolasff/phpredis" target="_blank" rel="noopener"
>https://github.com/nicolasff/phpredis&lt;/a>  上的说明， 其实有个方法setOption 可以设置客户端的一些属性&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">setOption&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Redis&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">OPT_SERIALIZER&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Redis&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">SERIALIZER_PHP&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// use built-in serialize/unserialize
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这样就可以使用php内置的serialize/unserialize 方法对数据进行处理&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * redis test
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * @author jia.tian@me.com
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$redis&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Redis&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">connect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;127.0.0.1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;6379&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">setOption&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Redis&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">OPT_SERIALIZER&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Redis&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">SERIALIZER_PHP&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;tian&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;tian&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;passwd&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;123456&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">var_dump&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;tian&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;tian&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;test&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">var_dump&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;tian&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>运行结果：&lt;/p>
&lt;p>&lt;code>array(2) { [&amp;quot;name&amp;quot;]=&amp;gt; string(4) &amp;quot;tian&amp;quot; [&amp;quot;passwd&amp;quot;]=&amp;gt; string(6) &amp;quot;123456&amp;quot; } string(4) &amp;quot;test&amp;quot;&lt;/code>&lt;/p>
&lt;p>可以看到将array存入和取出时会自动进行了处理这是直接在github上下载的zip包在ubuntu上安装的，可以看到版本号是2.2.2&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/2013/04/Snip20130412_7.png" >&lt;img src="https://hitian.info/assets/images/2013/04/Snip20130412_7.png" alt="Snip20130412_7" />&lt;/a>&lt;/p>
&lt;p>因为公司电脑是win环境， 找了个win的redis扩展，但是在setOption这步有点麻烦， 只要一设置就白屏。 原因仍在测试中。。。&lt;/p>
&lt;p>ps：项目终于要开始大量使用redis了， 能到这一天真不容易啊。&lt;/p></description></item><item><title>nginx 使用笔记</title><link>https://hitian.info/post/nginx-notes/</link><pubDate>Thu, 04 Apr 2013 00:00:00 +0000</pubDate><guid>https://hitian.info/post/nginx-notes/</guid><description>&lt;p>添加phpmyadmin alias&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">location /phpmyadmin &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /usr/share/&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> index index.php index.html index.htm&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location ~ ^/phpmyadmin/&lt;span class="o">(&lt;/span>.+&lt;span class="se">\.&lt;/span>php&lt;span class="o">)&lt;/span>$ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> try_files &lt;span class="nv">$uri&lt;/span> &lt;span class="o">=&lt;/span>404&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /usr/share/&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fastcgi_pass 127.0.0.1:9000&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fastcgi_index index.php&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fastcgi_param SCRIPT_FILENAME &lt;span class="nv">$document_root$fastcgi_script_name&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/fastcgi_params&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location ~* ^/phpmyadmin/&lt;span class="o">(&lt;/span>.+&lt;span class="se">\.&lt;/span>&lt;span class="o">(&lt;/span>jpg&lt;span class="p">|&lt;/span>jpeg&lt;span class="p">|&lt;/span>gif&lt;span class="p">|&lt;/span>css&lt;span class="p">|&lt;/span>png&lt;span class="p">|&lt;/span>js&lt;span class="p">|&lt;/span>ico&lt;span class="p">|&lt;/span>html&lt;span class="p">|&lt;/span>xml&lt;span class="p">|&lt;/span>txt&lt;span class="o">))&lt;/span>$ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /usr/share/&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>静态文件缓存， 并且不记录日志&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">location ~ &lt;span class="se">\.&lt;/span>&lt;span class="o">(&lt;/span>jpg&lt;span class="p">|&lt;/span>jpeg&lt;span class="p">|&lt;/span>gif&lt;span class="p">|&lt;/span>css&lt;span class="p">|&lt;/span>png&lt;span class="p">|&lt;/span>js&lt;span class="p">|&lt;/span>ico&lt;span class="p">|&lt;/span>xml&lt;span class="o">)&lt;/span>$ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> access_log off&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> expires 30d&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>adb连接到rk30sdk</title><link>https://hitian.info/post/adb-connect-to-rk30sdk/</link><pubDate>Sun, 24 Feb 2013 00:00:00 +0000</pubDate><guid>https://hitian.info/post/adb-connect-to-rk30sdk/</guid><description>&lt;p>修改 &lt;code>~/.android/adb_usb.ini&lt;/code> 文件&lt;/p>
&lt;p>添加&lt;/p>
&lt;p>&lt;code>0x2207&lt;/code>&lt;/p>
&lt;p>注意文件中不能有空行, 否则可能报错:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">* daemon not running. starting it now on port &lt;span class="m">5037&lt;/span> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ADB server didn&lt;span class="err">&amp;#39;&lt;/span>t ACK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* failed to start daemon *
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>文件修改好后重启一下服务&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">tianMac:platform-tools tian$ ./adb kill-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tianMac:platform-tools tian$ ./adb start-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* daemon not running. starting it now on port &lt;span class="m">5037&lt;/span> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* daemon started successfully *
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后应该就可以看见设备了.&lt;/p></description></item><item><title>brew install httpd 发生错误</title><link>https://hitian.info/post/brew-install-httpd/</link><pubDate>Sun, 30 Dec 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/brew-install-httpd/</guid><description>&lt;p>今天安装subversion的过程中把httpd卸掉了， 结果重新安装的时候发生错误了&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">tian-mac:~ tian$ brew install &lt;span class="nv">httpd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&lt;/span>&amp;gt; Downloading http://www.apache.org/dist/httpd/httpd-2.2.22.tar.bz2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Already downloaded: /Library/Caches/Homebrew/httpd-2.2.22.tar.bz2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&lt;/span>&amp;gt; ./configure --prefix&lt;span class="o">=&lt;/span>/usr/local/Cellar/httpd/2.2.22 --mandir&lt;span class="o">=&lt;/span>/usr/local/Cellar/httpd/2.2.22/share/man --enable-layout&lt;span class="o">=&lt;/span>GNU --enable-mods-shared&lt;span class="o">=&lt;/span>all --with-ssl&lt;span class="o">=&lt;/span>/usr --wit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">checking whether to &lt;span class="nb">enable&lt;/span> mod_substitute... shared &lt;span class="o">(&lt;/span>all&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">checking whether to &lt;span class="nb">enable&lt;/span> mod_charset_lite... no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">checking whether to &lt;span class="nb">enable&lt;/span> mod_deflate... checking dependencies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">checking &lt;span class="k">for&lt;/span> zlib location... not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">checking whether to &lt;span class="nb">enable&lt;/span> mod_deflate... configure: error: mod_deflate has been requested but can not be built due to prerequisite failures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">READ THIS: https://github.com/mxcl/homebrew/wiki/troubleshooting
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">These open issues may also help:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://github.com/mxcl/homebrew/issues/14884
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>看了一下 zlib 已经安装了， 所以编辑一下安装的脚本加上zlib的路径&lt;/p>
&lt;p>&lt;code>brew edit httpd&lt;/code>&lt;/p>
&lt;p>加上一行  &lt;code>--with-z=/usr/local/opt/zlib/&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">def install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> system &lt;span class="s2">&amp;#34;./configure&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--disable-debug&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--disable-dependency-tracking&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--prefix=#{prefix}&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--mandir=#{man}&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-layout=GNU&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-mods-shared=all&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--with-ssl=/usr&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--with-z=/usr/local/opt/zlib/&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--with-mpm=prefork&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--disable-unique-id&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-ssl&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-dav&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-cache&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-proxy&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-logio&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-deflate&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--with-included-apr&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-cgi&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-cgid&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-suexec&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--enable-rewrite&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> system &lt;span class="s2">&amp;#34;make&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> system &lt;span class="s2">&amp;#34;make install&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>重新安装一下就好了。&lt;/p></description></item><item><title>推荐一个zendstudio调样式的新方式</title><link>https://hitian.info/post/zendstudio-install-theme/</link><pubDate>Sat, 01 Dec 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/zendstudio-install-theme/</guid><description>&lt;p>默认的白底黑字其实看久了也挺烦， 无奈审美太差， 自己调颜色只会越弄越差。&lt;/p>
&lt;p>无意中发现了这个东西， 换主题就很方便了&lt;/p>
&lt;p>选择 Install New Software…  新增一个&lt;/p>
&lt;p>&lt;code>http://eclipse-color-theme.github.com/update/&lt;/code>&lt;/p>
&lt;p>然后安装里面的 &lt;code>Eclipse Color Theme&lt;/code>&lt;/p>
&lt;p>重启之后就可以看到了&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/2012/12/Snip20121201_21.png" alt="Snip20121201_21 5" title="Snip20121201_21.png" />&lt;/p>
&lt;p>要换主题会非常方便。&lt;/p>
&lt;p>ps: 自从安装了sublime text 之后， 对它的配色一直念念不忘。。。&lt;/p></description></item><item><title>为DiffMerge创建finder右键菜单</title><link>https://hitian.info/post/diffmerge/</link><pubDate>Sat, 01 Dec 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/diffmerge/</guid><description>&lt;p>习惯了win下直接选中文件右键对比， 在mac下找了好久，要么贵的要死，要么没有，所以决定自己创建一个。&lt;/p>
&lt;ol>
&lt;li>打开系统自带的 Automator&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://hitian.info/assets/images/2012/12/Snip20121201_3.png" alt="Snip20121201 3" title="Snip20121201_3.png" />&lt;/p>
&lt;ol start="2">
&lt;li>创建一个服务&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://hitian.info/assets/images/2012/12/Snip20121201_5.png" alt="Snip20121201 5" title="Snip20121201_5.png" />&lt;/p>
&lt;ol start="3">
&lt;li>
&lt;p>右上  “服务”收到选定的  改为 文件货文件夹  ， 位于改为Finder.app&lt;/p>
&lt;/li>
&lt;li>
&lt;p>左边选 使用工具  双击下面的 运行Shell 脚本&lt;/p>
&lt;/li>
&lt;li>
&lt;p>右边 传送输入 改为 作为自变量，  下面输入  &lt;code>/Applications/DiffMerge.app/Contents/MacOS/DiffMerge &amp;quot;$1&amp;quot; &amp;quot;$2&amp;quot;&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>    参考自己的DiffMerge的位置&lt;/p>
&lt;p>好了， 现在取个名字并保存&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/2012/12/Snip20121201_7.png" alt="Snip20121201 7" title="Snip20121201_7.png" />&lt;/p>
&lt;p>选中要对比的文件， 右键 -》服务   就可以看到了。&lt;/p></description></item><item><title>mac下安装dnsmasq笔记</title><link>https://hitian.info/post/macos-install-dnsmasq/</link><pubDate>Sun, 25 Nov 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/macos-install-dnsmasq/</guid><description>&lt;p>安装&lt;/p>
&lt;p>&lt;code>brew update &amp;amp;&amp;amp; brew install dnsmasq&lt;/code>&lt;/p>
&lt;p> &lt;/p>
&lt;p>配置&lt;/p>
&lt;p>#从模板创建配置文件&lt;/p>
&lt;p>&lt;code>cp /usr/local/Cellar/dnsmasq/2.63/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf&lt;/code>&lt;/p>
&lt;p>#开机自启动&lt;/p>
&lt;p>&lt;code>sudo cp /usr/local/Cellar/dnsmasq/2.63/homebrew.mxcl.dnsmasq.plist /Library/LaunchDaemons/&lt;/code>&lt;/p>
&lt;p>&lt;code>sudo launchctl load -w /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist &lt;/code>&lt;/p>
&lt;p> &lt;/p>
&lt;p>编辑   &lt;code>/usr/local/etc/dnsmasq.conf&lt;/code>&lt;/p>
&lt;p>修改 &lt;code>resolv-file=/etc/resolv.dnsmasq.conf&lt;/code>&lt;/p>
&lt;p>如果只想本机使用 这里也修改一下&lt;/p>
&lt;p>&lt;code>listen-address=127.0.0.1&lt;/code>&lt;/p>
&lt;p> &lt;/p>
&lt;p>修改maxos的配置使用本地的dnsmasq&lt;/p>
&lt;p>编辑 &lt;code>/etc/resolv.conf&lt;/code>&lt;/p>
&lt;p>修改  &lt;code>nameserver 127.0.0.1&lt;/code>&lt;/p>
&lt;p> &lt;/p>
&lt;p>参考原始页面 &lt;a class="link" href="http://blog.philippklaus.de/2012/02/install-dnsmasq-locally-on-mac-os-x-via-homebrew/" target="_blank" rel="noopener"
>http://blog.philippklaus.de/2012/02/install-dnsmasq-locally-on-mac-os-x-via-homebrew/&lt;/a>&lt;/p>
&lt;p> &lt;/p>
&lt;p> &lt;/p></description></item><item><title>openwrt dns配置</title><link>https://hitian.info/post/openwrt-dns-configuration/</link><pubDate>Sun, 25 Nov 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/openwrt-dns-configuration/</guid><description>&lt;p>想使用v2ex的dns来加速app store， 又不想因为dns的原因导致某些网站的区域性cdn加速失效&lt;/p>
&lt;p>其实用dnsmasq很容易解决这个问题&lt;/p>
&lt;p>给路由器刷个openwrt， 然后设置就简单多了&lt;/p>
&lt;p>打开  网络   =》   DHCP/DNS   页面&lt;/p>
&lt;p>设置一下里面的DNS转发， 把v2ex的两个ip加进去, 将苹果的二级域名使用v2ex进行解析， 而其他域名还是通过本地isp的dns解析。&lt;/p>
&lt;p>&lt;code>/.apple.com/199.91.73.222&lt;/code>&lt;/p>
&lt;p>&lt;code>/.apple.com/178.79.131.110&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/2012/11/Snip20121125_4.png" alt="Snip20121125 4" title="Snip20121125_4.png" />&lt;/p>
&lt;p>保存， 大功告成&lt;/p>
&lt;p> &lt;/p></description></item><item><title>推荐个win下面好用的文件对比软件WinMerge</title><link>https://hitian.info/post/winmerge/</link><pubDate>Fri, 12 Oct 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/winmerge/</guid><description>&lt;blockquote>
&lt;/blockquote>
&lt;p>&lt;strong>WinMerge&lt;/strong>&lt;/p>
&lt;p>官网：&lt;a class="link" href="http://winmerge.org/" target="_blank" rel="noopener"
>http://winmerge.org/&lt;/a>&lt;/p>
&lt;p>一款 Windows 下的开源免费文件比较/合并工具，支持文件/文件夹比较，可以处理DOS、UNIX 和 MAC 中的文本文件，支持 Unicode 标准万国码，可以对文本文档的可视化编辑以及合并，也有语法高亮和支持压缩包功能（通过7-Zip支持）。&lt;/p>
&lt;p>之前文件对比一直用的TortoiseSVN自带的diff,  不过不是很直观, WinMerge 用起来更方便一点, 可以直接显示不同的位置, 可以直接替换掉TortoiseSVN里的.  
&lt;a class="link" href="https://hitian.info/assets/images/2012/10/image.png" >&lt;img src="https://hitian.info/assets/images/2012/10/image_thumb.png" alt="image" title="image" />&lt;/a>&lt;/p></description></item><item><title>mac上最简单的代理方式</title><link>https://hitian.info/post/macos-simple-proxy/</link><pubDate>Mon, 01 Oct 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/macos-simple-proxy/</guid><description>&lt;p>在mac上使用ssh代理其实很方便&lt;/p>
&lt;p>前提是有一个ssh账号&lt;/p>
&lt;p>命令&lt;/p>
&lt;p>&lt;code>$ ssh -D 1089 tian@domain.com&lt;/code>&lt;/p>
&lt;p>会打开端口1089 监听&lt;/p>
&lt;p>查看端口可以发现&lt;/p>
&lt;pre tabindex="0">&lt;code>Active Internet connections (including servers)
Proto Recv-Q Send-Q Local Address Foreign Address (state)
tcp6 0 0 ::1.1089 *.* LISTEN
tcp4 0 0 127.0.0.1.1089 *.* LISTEN
&lt;/code>&lt;/pre>&lt;p>这样连接就建立好了， 然后配置一下&lt;/p>
&lt;p>进入网络偏好设置， 选自己正在用的网络连接 -》点高级-》选择代理标签&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/2012/10/Snip20121001_3.png" alt="Snip20121001 3" title="Snip20121001_3.png" />&lt;/p>
&lt;p>使用socks代理， 填上刚才的端口号&lt;/p>
&lt;p>确实非常方便。&lt;/p></description></item><item><title>blog评论反垃圾</title><link>https://hitian.info/post/blog-comments/</link><pubDate>Mon, 10 Sep 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/blog-comments/</guid><description>&lt;p>近几天博客的垃圾评论越来越多， 一天甚至好几十个。 迫不得已装个插件来防垃圾。&lt;/p>
&lt;p>由于空间禁用了php 的fsockopen 函数导致Akismet 无法连接到服务器。&lt;/p>
&lt;p>测试一下发现pfsockopen 没有被禁用， 进入akismet的目录批量替换所有fsockopen为pfsockopen。&lt;/p>
&lt;p>&lt;img src="https://hitian.info/assets/images/2012/09/QQ20120910-1.png" alt="QQ20120910 1" title="QQ20120910-1.png" />&lt;/p>
&lt;p>然后就检测正常了&lt;/p>
&lt;p>具体的功能好不好使得观察一段时间再看了。&lt;/p></description></item><item><title>注入风险提醒</title><link>https://hitian.info/post/sql-injection-risk/</link><pubDate>Sun, 29 Apr 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/sql-injection-risk/</guid><description>&lt;p>前几天发现的数据库注入总结一下&lt;/p>
&lt;p>发生问题的过滤:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span> &lt;span class="nx">in_array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$_GET&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;t&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="nv">$_GET&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;t&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这个过滤实际不严格, 当传进来的变量以 1,2,3中的任意数字开头时过滤将失败&lt;/p>
&lt;p>当用户 传 &lt;code>t=1' or '1'='1&lt;/code> 时, $type获取到的变量将维持原样, 直接传到数据库进行查询时会有注入危险&lt;/p>
&lt;p>总结和建议:所有由用户传入int 值 必须使用 &lt;code>intval()&lt;/code> 进行过滤&lt;/p>
&lt;p>字符串必须使用&lt;code>mysql_real_escape_string()&lt;/code> 进行过滤&lt;/p>
&lt;p>在读取 &lt;code>$_GET $_REQUEST $_POST $_COOKIE&lt;/code> 时 必须进行过滤, 一般认为用户传入的数据都是不安全的.&lt;/p></description></item><item><title>sql笔记</title><link>https://hitian.info/post/sql-note/</link><pubDate>Thu, 12 Apr 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/sql-note/</guid><description>&lt;p>一般数据库会根据使用的情况来设计, 为了保证性能一般链接的表不应该超过2个,&lt;/p>
&lt;p>但是在数据统计汇总运算的时候就麻烦了, 往往需要查好多张表才能得到需要的数据.&lt;/p>
&lt;p>如果查询很复杂的时候一次join好多张表会导致查询速度巨慢.&lt;/p>
&lt;p>当然用php等动态语言把数据取出来进行运算也不错,就是需要写代码.&lt;/p>
&lt;p> &lt;/p>
&lt;p>能在数据库内完成的运算 当然想要直接在库内完成&lt;/p>
&lt;p>使用临时表存储计算过程中的中间数据时隔不错的选择&lt;/p>
&lt;p>使用临时表进行数据统计， 避免出现超过3个以上的join操作&lt;/p>
&lt;p>&amp;ndash;以防万一先删除表&lt;/p>
&lt;p>&lt;code>drop table if exists tmp_table;&lt;/code>&lt;/p>
&lt;p>&amp;ndash;创建临时表的时候加上temporary 关键字就行了&lt;/p>
&lt;p>&lt;code>create temporary table tmp_table(uid bigint not null primary key, cityid int(10) unsigned, prov varchar(50), city varchar(50), group_id tinyint );&lt;/code>&lt;/p>
&lt;p> &lt;/p>
&lt;p>&amp;ndash;把多个表中需要的数据组合在一起插入临时表中, 暂时没有的数据插入空字符串&lt;/p>
&lt;p>&lt;code>insert into tmp_table select a.uid as uid, a.cityid as cityid,'','',0 from my_city a inner join my_op b on a.uid=b.uid where a.reg_date='2012-04-10' and b.ctime&amp;gt;0;&lt;/code>&lt;/p>
&lt;p>&amp;ndash;联合多表更新&lt;/p>
&lt;p>&lt;code>update tmp_table a, my_city b  set a.prov=b.prov, a.city=b.area where a.cityid=b.id;&lt;/code>&lt;/p>
&lt;p>&amp;ndash;还是联合多表更新&lt;/p>
&lt;p>&lt;code>update tmp_table a, my_city_auth b  set a.group_id=b.group_id where a.prov=b.prov;&lt;/code>&lt;/p>
&lt;p> &lt;/p>
&lt;p>&amp;ndash;剩下的就只是把算好的数据读出来了.&lt;/p>
&lt;p>而且临时表是session级别的, 只有当前用户可见, 而且断开链接后就自动清理了.&lt;/p></description></item><item><title>用latin1来存储汉字真抓狂</title><link>https://hitian.info/post/latin1/</link><pubDate>Thu, 12 Apr 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/latin1/</guid><description>&lt;p>mysql 是从4.0 升级上来的， 直接使用了latin1_swedish_ci 存储汉字，没想到带来了好多麻烦。&lt;/p>
&lt;p>首先是查询的问题&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">my_city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">’温州’&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">温州&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">梧州&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>当然, 如果在city上建了唯一索引, 就会倒大霉&amp;hellip;&lt;/p>
&lt;p> 
然后是排序的问题&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">my_city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">asc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">上海&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">温州&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">梧州&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">西安&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">重庆&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">安徽&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">北京&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这个顺序看起来更让人郁闷&amp;hellip;&lt;/p>
&lt;p>临时解决方案:&lt;/p>
&lt;p>&lt;code>ALTER TABLE  `my_city` CHANGE  `city`  `city` VARCHAR( 25 ) CHARACTER SET latin1 COLLATE latin1_bin NULL DEFAULT NULL&lt;/code>&lt;/p>
&lt;p>修改字段的collate 为 latin1_bin&lt;/p>
&lt;p>然后再来看&lt;/p>
&lt;p>查询正常&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">my_city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">’温州’&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">温州&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>排序部分正常&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">my_city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">asc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">安徽&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">北京&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">上海&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">温州&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">梧州&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">西安&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">重庆&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>要彻底解决还是要整个转换为gbk ,  当然utf-8 会更好一点.&lt;/p></description></item><item><title>关于异步的一点点其他东西</title><link>https://hitian.info/post/a-little-things-about-asynchronous/</link><pubDate>Thu, 09 Feb 2012 00:00:00 +0000</pubDate><guid>https://hitian.info/post/a-little-things-about-asynchronous/</guid><description>&lt;p>当一个网页包含大量的内容, 而只有其中的一小部分需要是动态内容(显示用户名, 积分等)时, 通常整个页面采用html静态页面, 并使用js来加载和改变动态的部分.&lt;/p>
&lt;p>但是像这样, 如果js加载速度很慢的话, 会导致之下的页面停止渲染&amp;hellip;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>demo6-1&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>content...&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text/javascript&amp;#34;&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;get_something_api.php&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>content...&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>于是我们将js写在页面下面, 等页面渲染的差不多了再加载它&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>demo6-1&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>content...&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>content...&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;demo6.html&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>demo6.html&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;demo6-2.html&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>demo6-2.html&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;demo6-3.html&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>demo6-3.html&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">img&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;27218b6e.jpg&amp;#34;&lt;/span> &lt;span class="na">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;1920&amp;#34;&lt;/span> &lt;span class="na">height&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;1200&amp;#34;&lt;/span> &lt;span class="na">border&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;0&amp;#34;&lt;/span> &lt;span class="na">alt&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text/javascript&amp;#34;&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;get_something_api.php&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>看起来是一个比较好的解决方案, 但是新的问题出现了.&lt;/p>
&lt;p>当由于网络或者程序执行效率的问题js的速度很慢的时候, 等待js加载过程中, 页面是可以正常操作的, 但是一旦操作有同一服务器上不同资源的请求时, 这个请求就完全卡住了, 例如点击页面上的链接.  同一服务器下资源并不能很好的多线程同时请求.&lt;/p>
&lt;p>本地用sleep模拟一个需要长时间才能完成的响应.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//do something and need some times
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Content-Type:application/x-javascript&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">echo&lt;/span> &lt;span class="s2">&amp;#34;alert(&amp;#39;results&amp;#39;);&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">?&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在对get_something_api.php 的请求过程中, 点击页面内同域名下的链接, 而跳转在js加载完成后才会执行. 一般输出js可能不会执行太久, 但是当使用长连接进行一些页面信息的实时推送时, 这个问题会很大.&lt;/p>
&lt;p>解决方案就是将get_something_api.php 放到不同的域名下去, 即使两个域名指的是同一个虚拟主机, 也可以让资源并行的加载.&lt;/p></description></item><item><title>我自己的年度总结(2011)</title><link>https://hitian.info/post/annual-summary-2011/</link><pubDate>Fri, 30 Dec 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/annual-summary-2011/</guid><description>&lt;p>2010年11月15日来上海的,   已经一年多了, 在这一年忙碌的工作中成长了不少，得到了很多, 也失去了很多。
这一年中，工作上倒是参与了不少项目的开发，学习到了很多, 然后就是这种各样的无奈.&lt;/p>
&lt;p>1.首页个性设置的前端开发： 这是我第一次使用js开发了一个较复杂的完整功能模块， 也是进公司之后完成的第二个比较大的项目，开发和测试修改历时一个多月，由于不熟悉开发流程， 需求一再更改，开发周期也被迫延长， 算是一个教训吧。 不过js功力大幅增长，特别是浏览器兼容性和浏览器本地存储积累了不少实用经验。&lt;/p>
&lt;p>2.移动导航第二版的前台开发： 由于是一个触屏手机版的网站，可以使用一些前沿的技术， 让我有幸接触到了html5，还有强大的jquery-mobile框架。毕竟是新接触的东西， 由于前期的框架学习和可行性分析不够导致了开发中遇到了很多棘手的问题，让我充分了解了新技术应用可能给项目带来的风险，不过还好项目顺利完工并上线。&lt;/p>
&lt;p>3.网址导航高级版开发： 完整参与了前期的需求和开发和维护，吸取前几次的教训，在项目前期做了大量的技术测试， 包括需要用到的js拖动框架， 本地存储， 以及缓存技术， 但是对开发周期的盲目乐观导致到最后不得不加班加点才能按时完成项目，还有未整理详细的开发文档导致后面的维护遇到了很多问题。这个项目涉及从前台js一直到后台数据库设计的一整套的东西，积累了很多网站性能方面的知识，也让我明白了牵头做一个项目有多么不容易。&lt;/p>
&lt;p>4.积分系统维护：后半年正式开始专职维护积分系统，对我来说这是一个新的挑战，之前从来没有接触过这么大量的数据需要运算、存储，需要关心的不只是功能能不能实现，数据量大了之后， 性能的重要性越来越突出，可能只是很小的改动都可以让运算时间大幅减小，当然也必须非常小心，因为任何的小失误都可能导致严重的问题。&lt;/p>
&lt;p>流水帐写完了, 然后就是一些感受和吐槽:&lt;/p>
&lt;p>1.毕竟是第一份正式的工作, 我不知道100多人的公司算大还是小,  不过快速发展导致管理跟不上确实是一件严重的事情.&lt;/p>
&lt;p>2.高层的目标是宏伟的, 中层只想尽快有业绩, 作为底层员工就只是无奈.&lt;/p>
&lt;p>3.我们用一成不变的技术来应对产品策划日益更新的需求, 这样真会死人的.&lt;/p>
&lt;p>4.初期赶进度导致的考虑和设计不足将在一段时间后大规模扩大.&lt;/p>
&lt;p>5.如果所有产品策划未经任何审核的想法都提交给开发人员必须实现, 没有规划,没有长远的考虑, 甚至隔几天就要改数据结构, 改业务逻辑, 那么系统崩溃是迟早的事, 这绝对不是危言耸听.&lt;/p>
&lt;p>6.小的逻辑错误自己是很难发现的, 这就是为什么我们需要代码审查机制和专业的测试人员.&lt;/p>
&lt;p>7.没有规范的代码、架构、 注释是很可怕的，等到开始维护的时候就知道了。&lt;/p>
&lt;p>8.到一定规模时，内部自己进行一些研发是必要的，把别人的最好的东西堆起来不一定是适合自己的最优解 就写这么多了。。。&lt;/p>
&lt;p>晚安 2011-12-30&lt;/p></description></item><item><title>chrome 最新版下载地址(win)</title><link>https://hitian.info/post/chrome-installer-downloads-for-win/</link><pubDate>Wed, 28 Dec 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/chrome-installer-downloads-for-win/</guid><description>&lt;p>在线安装: &lt;/p>
&lt;p>&lt;a class="link" href="http://www.google.com/chrome/eula.html?hl=zh-CN" target="_blank" rel="noopener"
>稳定版&lt;/a>  &lt;/p>
&lt;p>&lt;a class="link" href="http://www.google.com/chrome/eula.html?hl=zh-CN&amp;amp;extra=betachannel" target="_blank" rel="noopener"
>测试版&lt;/a>  &lt;/p>
&lt;p>&lt;a class="link" href="http://www.google.com/chrome/eula.html?hl=zh-CN&amp;amp;extra=devchannel" target="_blank" rel="noopener"
>开发版&lt;/a> &lt;/p>
&lt;p>&lt;a class="link" href="http://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?path=Win/&amp;amp;sort=desc" target="_blank" rel="noopener"
>chromium&lt;/a>&lt;/p>
&lt;p> &lt;/p>
&lt;p>离线安装包: &lt;/p>
&lt;p>&lt;a class="link" href="http://www.google.com/chrome/eula.html?hl=zh-CN&amp;amp;standalone=1" target="_blank" rel="noopener"
>稳定版&lt;/a> &lt;/p>
&lt;p>&lt;a class="link" href="http://www.google.com/chrome/eula.html?hl=zh-CN&amp;amp;standalone=1&amp;amp;extra=betachannel" target="_blank" rel="noopener"
>测试版&lt;/a> &lt;/p>
&lt;p>&lt;a class="link" href="http://www.google.com/chrome/eula.html?hl=zh-CN&amp;amp;standalone=1&amp;amp;extra=devchannel" target="_blank" rel="noopener"
>开发版&lt;/a>&lt;/p></description></item><item><title>php 文件下载 header 设置</title><link>https://hitian.info/post/php-file-download-set-header/</link><pubDate>Tue, 20 Dec 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/php-file-download-set-header/</guid><description>&lt;p>读取文件, 强制浏览器进行下载&lt;/p>
&lt;p>&lt;code>Content-Encoding: none&lt;/code>&lt;/p>
&lt;p>没有的话 迅雷7会自动加上扩展名.gzip&lt;/p>
&lt;p>Content-type&lt;/p>
&lt;p>我要下载的是.exe文件, 所以设置为&lt;code>application/octet-stream&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">ob_end_clean&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;HTTP/1.1 200 OK&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Cache-control: max-age=31536000&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Content-Encoding: none&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Content-type:application/octet-stream&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Content-Disposition: attachment; filename=&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$file_name&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Content-Length: &amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nx">filesize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$file_path&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 打开文件(二进制只读模式)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nv">$fp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">fopen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$file_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;rb&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 输出文件
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fpassthru&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$fp&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 关闭文件
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fclose&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$fp&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>关于(13) phpmyadmin Permission denied</title><link>https://hitian.info/post/permission-denied-access-to-phpmyadmin/</link><pubDate>Tue, 13 Dec 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/permission-denied-access-to-phpmyadmin/</guid><description>&lt;p>centos5.4 配置完apache+php+mysql 环境后出现了一个很棘手的问题&lt;/p>
&lt;p>使用 Alias /phpmyadmin &amp;ldquo;/var/www/html/phpmyadmin/&amp;rdquo;&lt;/p>
&lt;p>之后访问 http://localhost/phpmyadmin/index.php 一直出403&lt;/p>
&lt;p>/var/www/html/phpmyadmin/  目录的owner 改为apache&lt;/p>
&lt;p>并给了整个目录755的权限&lt;/p>
&lt;p>在访问的时候仍然出现了403&lt;/p>
&lt;p>解决方案:&lt;/p>
&lt;p>&lt;code>#chcon -R -h -t httpd_sys_content_t  /var/www/html/phpmyadmin/&lt;/code>&lt;/p>
&lt;p>本来一直使用ubuntu server 的, 没有用过centos, 为了明天的考核不得不试了下centos , 结果就出现这样纠结的问题, 翻了好久的英文网页才找到解决办法, 感谢google&amp;hellip;&lt;/p></description></item><item><title>win7安装完成后将硬盘从ATA模式切换到AHCI</title><link>https://hitian.info/post/win7-hd-ata-to-ahci/</link><pubDate>Sat, 03 Dec 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/win7-hd-ata-to-ahci/</guid><description>&lt;p>ahci模式包含了ncq等高级模式, 可以提高硬盘的性能, 而且win7内置了驱动, 不必担心像xp会蓝屏.&lt;/p>
&lt;p>但是如果是在ata模式下安装完成的win7, 再修改bios 切换到ahci模式还是会导致重新启动时蓝屏.&lt;/p>
&lt;p>解决:&lt;/p>
&lt;p>在ata模式下进入系统&lt;/p>
&lt;p>打开注册表编辑器&lt;/p>
&lt;p>修改 &lt;code>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Msahci&lt;/code> 中 Start 的值为0&lt;/p>
&lt;p>重启电脑 进bios 切换到ahci模式&lt;/p>
&lt;p>启动系统&lt;/p>
&lt;p>进入桌面后会显示有驱动正在安装.&lt;/p>
&lt;p>再手动下载安装一下intel的快速存储技术驱动就好了&amp;hellip;&lt;/p></description></item><item><title>mysql表锁定中不支持清空操作?</title><link>https://hitian.info/post/mysql-table-lock/</link><pubDate>Thu, 01 Dec 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/mysql-table-lock/</guid><description>&lt;p>偶然发现这个问题&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lock&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">write&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OK&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">affected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Empty&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="no">null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OK&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">affected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">——–&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">enable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">——–&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">——–&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">truncate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">ERROR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1192&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">HY000&lt;/span>&lt;span class="p">):&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Can&lt;/span>&lt;span class="s1">&amp;#39;t execute the given command because you have active lock
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">ed tables or an active transaction
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>TRUNCATE TABLE was not allowed under LOCK TABLES.&lt;/code>&lt;/p>
&lt;p>表锁中不可以使用清空操作, 这个让我很郁闷.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OK&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">affected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">alter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kp">auto_increment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OK&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">affected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">05&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Records&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Duplicates&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Warnings&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Empty&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="no">null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">99&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OK&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">affected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_my&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">——–&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">enable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">——–&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">99&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">—&lt;/span>&lt;span class="o">-+&lt;/span>&lt;span class="err">——&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="err">——–&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>分布操作: 先删除所有数据, 然后重新设置自增长的起始点却可以.&lt;/p></description></item><item><title>thinkpad ubuntu 11.10 暂时禁用触控板</title><link>https://hitian.info/post/thinkpad-ubuntu-disable-touchpad/</link><pubDate>Sun, 27 Nov 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/thinkpad-ubuntu-disable-touchpad/</guid><description>&lt;p>打字的时候经常碰到触控板很郁闷, 在使用usb鼠标的时候可以暂时禁用触控板和小红点&lt;/p>
&lt;p>&lt;code>sudo modprobe -r psmouse&lt;/code>&lt;/p>
&lt;p>重新启用&lt;/p>
&lt;p>&lt;code>sudo modprobe -i psmouse&lt;/code>&lt;/p></description></item><item><title>解决ie6 恶心的动态gif图片问题</title><link>https://hitian.info/post/ie6-gif-bug/</link><pubDate>Fri, 25 Nov 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/ie6-gif-bug/</guid><description>&lt;p>将改变img标签的src的事件触发写在a标记的onclick里面 在ie6下会导致切换后新的图片无法加载.&lt;/p>
&lt;p>今天又发现了另一个恶心的问题&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">img&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/images/pic1.gif&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">img&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/images/pic2.gif&amp;#34;&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;display:none&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;javascript:;&amp;#34;&lt;/span> &lt;span class="na">onclick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;chenge_pic();&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>切换图片&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>像这样, 如果pic2.gif 是一个动态的图片, 当点击a标签切换图片到pic2.gid 时, 实际看到的pic2.gif 是不会动的.&lt;/p>
&lt;p>直接将第一个标签的src 改成pic2.gif 图片也是不会动的.&lt;/p>
&lt;p>和之前的解决方案一样, 将a标记换成 &lt;code>&amp;lt;input type=&amp;quot;button&amp;quot;  /&amp;gt;&lt;/code> 就好了.恶心的ie6, 天天画圈圈诅咒它快点消失&amp;hellip;.&lt;/p></description></item><item><title>使用类似于奖池方式的抽奖模拟</title><link>https://hitian.info/post/lottery-simulation/</link><pubDate>Wed, 23 Nov 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/lottery-simulation/</guid><description>&lt;p>一般来说要做一个抽奖程序会立即想到用随机数. 但是通常情况下随机数也不是那么的随机, 数量比较大的时候才能体现出比较平均, 数量较小的时候中奖概率的可控性将会很差. 一不小心多被抽中几个麻烦就大了.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">T_prize&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">var&lt;/span> &lt;span class="nv">$item&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">var&lt;/span> &lt;span class="nv">$table&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * 抽奖主程序 外部调用入口
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * @param unknown_type $db 数据库链接
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * @param unknown_type $id 抽奖类型
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">function&lt;/span> &lt;span class="nf">prize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$db&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">global&lt;/span> &lt;span class="nv">$prize_set&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">isset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$prize_set&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nv">$id&lt;/span>&lt;span class="p">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">item&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$prize_set&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nv">$id&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;my_prize_store_table_&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//抽奖并发较大时可以进行分表, 多生成几个奖池
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//$table = &amp;#39;my_prize_store_table_&amp;#39; . $id . &amp;#39;_&amp;#39; . rand(0, 4);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$table&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//防止多个用户抽到同一个条目, 进行锁表
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;lock table &amp;#34;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$table&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="s2">&amp;#34; write&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$pid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">get_one&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$db&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//奖池中没有奖品时重新初始化奖池
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$pid&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;-1&amp;#39;&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">create_pool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$db&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$pid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">get_one&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$db&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//释放锁 返回抽奖结果
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;unlock table&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nv">$pid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * 抽奖一次
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * @param unknown_type $db
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * @param unknown_type $id
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">function&lt;/span> &lt;span class="nf">get_one&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$db&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">table&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$sql&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;SELECT * FROM &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">table&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> WHERE enable = &amp;#39;1&amp;#39; LIMIT 1&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$sql&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$success&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$re&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$row&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;id&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$pid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;pid&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$update_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$table&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$update_data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;id=&amp;#39;&lt;/span>&lt;span class="si">$id&lt;/span>&lt;span class="s2">&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">getAffectedRows&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$result&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$success&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$re&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$row&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">my_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;抽奖池条目状态修改发生错误 id:&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;-1&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$success&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nv">$pid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * 奖品池初始化
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * @param unknown_type $db
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * @param unknown_type $id
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">function&lt;/span> &lt;span class="nf">create_pool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$db&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">table&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">my_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;init prize pool id:&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$item&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">item&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$total_num&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$item&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;total&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$item&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;list&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$tprize_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">foreach&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">$list&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nv">$key&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="nv">$one&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$tnum&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">intval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$total_num&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nv">$one&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$tnum&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">my_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;create prize pool create alert: total_num:&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$total_num&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="s1">&amp;#39; item_name:&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$item&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="s1">&amp;#39; probability:&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$item&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">$i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nv">$i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nv">$tnum&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nv">$i&lt;/span> &lt;span class="o">++&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">do&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$total_num&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">isset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$tprize_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nv">$id&lt;/span>&lt;span class="p">]));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$tprize_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nv">$id&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$key&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">my_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;start&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;TRUNCATE &amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$table&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$insert_str_arr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$i&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nv">$i&lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="nv">$total_num&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nv">$i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$this_pid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$inset_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;pid&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">isset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$tprize_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nv">$i&lt;/span>&lt;span class="p">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$this_pid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$tprize_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nv">$i&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//每100条记录插入一次可以大幅减小数据库插入时间时间
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nv">$insert_str_arr&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;(&lt;/span>&lt;span class="si">$this_pid&lt;/span>&lt;span class="s2">)&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$i&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$insert_str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">implode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$insert_str_arr&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$insert_str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;insert into &amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$table&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="s1">&amp;#39;(pid) values&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$insert_str&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$insert_str&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$insert_str_arr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">my_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;end&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//自定义日志
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">function&lt;/span> &lt;span class="nf">my_log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$msg&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//write logs here
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用奖池的概念可以将中奖概率严格限制一下,  生成一定数量的格子, 按照概率算出有奖品的格子的数量, 然后再随机填充到格子里去, 执行抽奖的时候一次去打开格子. 要么中奖,要么不中, 当所有格子都被开启过之后,  再次执行初始化重新填充所有的格子.
设置一下需要使用的奖品数据和概率&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$prize_set&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//抽奖1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nv">$prize_set&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;total&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;list&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">1&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.01&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">2&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品2&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.05&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">3&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品3&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//抽奖2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nv">$prize_set&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;total&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;list&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">1&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.001&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">2&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品2&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.005&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">3&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品3&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.01&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">4&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品4&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.02&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">5&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品5&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.05&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">6&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;奖品6&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;probability&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我有两组抽奖, 所以定义了两组.  注意, 每组的总数 乘以 这组中最小的一个概率一定要大于1,  不然这个奖品就永远也没可能抽中了.&lt;/p>
&lt;p>这种方式也有缺点:&lt;/p>
&lt;p>1.概率的调整只能在下次奖池初始化时才能生效,&lt;/p>
&lt;p>2.使用数据库表锁来保证同一个格子只能被一个人抽中, 会导致性能降低, (我们使用的是myisam, 只能使用表级锁)无法支持大量的并发, 有个很笨的但最简单的解决方案就是对同一个抽奖使用多个奖池, 将请求分散到各个表去.&lt;/p>
&lt;p>后记:表在lock 状态中实际上是不支持truncate 操作的,  先delete from table 删除所有数据, 再 alter table xxx set auto_increment=1  就可以解决这个问题&amp;hellip;&lt;/p></description></item><item><title>重装系统后恢复开发环境</title><link>https://hitian.info/post/restore-development-environment/</link><pubDate>Tue, 22 Nov 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/restore-development-environment/</guid><description>&lt;p>每次做系统都很愁,  因为有一大堆软件需要重新安装, 尽管尽量都用绿色的还是有一大推需要安装的, 尝试着列个表, 简化一下流程&amp;hellip;&lt;/p>
&lt;h3 id="个人文件夹迁移">个人文件夹迁移&lt;/h3>
&lt;p>将个人文件夹中的 我的视频 我的音乐 我的图片 移动到原来非系统盘的位置去 (一直很纳闷为什么这些需要大量占用磁盘空间的东西不一开始就放在非系统盘)
 &lt;/p>
&lt;h3 id="恢复apache和php环境-之前的都装在d盘了">恢复apache和php环境 之前的都装在d盘了 &lt;/h3>
&lt;p>以管理员运行cmd 进入D:\lamp\apache\bin&lt;/p>
&lt;p>&lt;code>httpd.exe  -k install&lt;/code>   将apache安装为系统服务&lt;/p>
&lt;p>&lt;code>httpd.exe  -k start&lt;/code>      启动apache&lt;/p>
&lt;p>mysql 一直使用的远程的, 跳过&lt;/p>
&lt;p>将备份的host 文件覆盖 顺便调整一下修改的权限&lt;/p>
&lt;p>运行环境搞定&lt;/p>
&lt;p> &lt;/p>
&lt;h3 id="安装firefox-然后安装插件">安装firefox 然后安装插件&lt;/h3>
&lt;p>firebug;&lt;/p>
&lt;p>firecookie;&lt;/p>
&lt;p>web developer;&lt;/p>
&lt;p>dns flusher;&lt;/p>
&lt;p>advanced cookie manager;&lt;/p>
&lt;p>再安装一下chrome  使用google帐号将之前的插件都同步回来&lt;/p>
&lt;p>ok 调试环境也搞定&lt;/p>
&lt;p> &lt;/p>
&lt;h3 id="安装-jre--dreamweaver--mysql-workbench-eclipse-pdt-editplus">安装 jre ;  Dreamweaver ; mysql workbench; eclipse pdt; editplus&lt;/h3>
&lt;p>ok 开发环境搞定&lt;/p></description></item><item><title>ubuntu-server 版本升级</title><link>https://hitian.info/post/ubuntu-server-upgrade/</link><pubDate>Wed, 09 Nov 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/ubuntu-server-upgrade/</guid><description>&lt;p>一直以来虚拟机里测试用的ubuntu server 都是在出新版本后直接重新安装的, 但是现在东西实在太多了, 懒得再重装了, 网上查了一下升级的过程作下记录:&lt;/p>
&lt;p>升级之前重要的配置文件最好先备份一下, 对于测试服务器, 我选择直接跳过&lt;/p>
&lt;p>修改一下/etc/apt/sources.list 找个快点的源, 不然会很郁闷的. 网易的就不错 mirrors.163.com&lt;/p>
&lt;p>开始升级&lt;/p>
&lt;p>&lt;code>$sudo apt-get install update-manager-core&lt;/code>&lt;/p>
&lt;p>显示已经安装了最新版本&lt;/p>
&lt;p>接着&lt;/p>
&lt;p>&lt;code>$sudo do-release-upgrade&lt;/code>&lt;/p>
&lt;p>因为我是ssh上去的, 系统会提示如果发生意外可以使用1022端口登录上去&lt;/p>
&lt;p>一路 y&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/2011/11/image.png" >&lt;img src="https://hitian.info/assets/images/2011/11/image_thumb.png" alt="image" title="image" />&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/2011/11/image1.png" >&lt;img src="https://hitian.info/assets/images/2011/11/image_thumb1.png" alt="image" title="image" />&lt;/a>&lt;/p>
&lt;p>可以看到其实已经在get新版本的包了&lt;/p>
&lt;p>接下来漫长的半个小时等待..zzzZZ&lt;/p>
&lt;p>网速严重不给力啊&lt;/p>
&lt;p>安装新的, 有一部分老的会被删除&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/2011/11/image2.png" >&lt;img src="https://hitian.info/assets/images/2011/11/image_thumb2.png" alt="image" title="image" />&lt;/a>&lt;/p>
&lt;p>接着自动重启&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/2011/11/image3.png" >&lt;img src="https://hitian.info/assets/images/2011/11/image_thumb3.png" alt="image" title="image" />&lt;/a>&lt;/p>
&lt;p>看来升级成功了&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/2011/11/image4.png" >&lt;img src="https://hitian.info/assets/images/2011/11/image_thumb4.png" alt="image" title="image" />&lt;/a>&lt;/p>
&lt;p>看来mysql没起来, 其他都是正常的&lt;/p>
&lt;p>&lt;a class="link" href="https://hitian.info/assets/images/2011/11/image5.png" >&lt;img src="https://hitian.info/assets/images/2011/11/image_thumb5.png" alt="image" title="image" />&lt;/a>&lt;/p>
&lt;p>(完)&amp;hellip;&lt;/p></description></item><item><title>win7 x64 运行x86的zend studio 9.0</title><link>https://hitian.info/post/win7-x64-zend-studio-x86/</link><pubDate>Sat, 05 Nov 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/win7-x64-zend-studio-x86/</guid><description>&lt;p>x64的win8 安装了x64 的jdk  再运行zendstudio时就会出错&lt;/p>
&lt;p>解决:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>再安装一下x86 的jre&lt;/p>
&lt;/li>
&lt;li>
&lt;p>打开 C:\Program Files (x86)\Zend\Zend Studio 9.0.0\ZendStudio.ini&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>添加 -vm&lt;/p>
&lt;p>C:\Program Files (x86)\Java\jre6\bin\javaw.exe&lt;/p>
&lt;pre tabindex="0">&lt;code>-name
Zend Studio
-vm
C:\Program Files (x86)\Java\jre6\bin\javaw.exe
-vmargs
&lt;/code>&lt;/pre></description></item><item><title>gmail 在 ie9中乱版</title><link>https://hitian.info/post/gmail-ie9/</link><pubDate>Sat, 22 Oct 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/gmail-ie9/</guid><description>&lt;p>在ie9 中打开gmail页面全乱 并提示ie使用了兼容性视图.并且给了修复方式:&lt;/p>
&lt;p>右键点击右上角的齿轮图标。&lt;/p>
&lt;p>选择命令栏。&lt;/p>
&lt;p>打开浏览器顶部的工具菜单，然后选择兼容性视图设置。&lt;/p>
&lt;p>在“已添加到兼容性视图中的网站”下，选择“google.com”。&lt;/p>
&lt;p>点击删除。但是在我的已添加列表中并没有google.com&lt;/p>
&lt;p>解决方法很简单, 按&amp;rsquo;F12&amp;rsquo; 打开开发人员工具, 切换一下浏览器模式然后关掉就好了&lt;/p></description></item><item><title>php执行服务器脚本</title><link>https://hitian.info/post/php-exec/</link><pubDate>Thu, 20 Oct 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/php-exec/</guid><description>&lt;p>php执行服务器上的脚本进行一些操作不是什么难事.&lt;/p>
&lt;p>exec system passthru 这几个函数都可以调用外部的命令. 只要有权限就完全没有问题.&lt;/p>
&lt;p>例如&lt;/p>
&lt;p>&lt;code>exec('/home/tian/bin/trytodosomething -h');&lt;/code>&lt;/p>
&lt;p>命令执行后php会挂起直到命令运行完毕.
有时候脚本运行的时间也许很长, 我们需要让php继续执行及时反馈给用户我们已经开始操作了.&lt;/p>
&lt;pre tabindex="0">&lt;code>$cmd = &amp;#39;/home/tian/bin/trytodosomething -h &amp;gt; /tmp/null &amp;amp;&amp;#39;;
$result = system($cmd);
&lt;/code>&lt;/pre>&lt;p>这样修改之后, php就会继续执行, 不会等待命令执行完这样也存在一个问题, 用户不断的刷新网页可以能造成一些麻烦, 使用文件锁就可以解决这个问题.&lt;/p></description></item><item><title>intel my wifi 无法获取到ip的解决</title><link>https://hitian.info/post/intel-my-wifi/</link><pubDate>Wed, 14 Sep 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/intel-my-wifi/</guid><description>&lt;p>平时都使用脚本来共享wifi给手机&lt;/p>
&lt;p>start_wifi.bat&amp;gt;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bat" data-lang="bat">&lt;span class="line">&lt;span class="cl">netsh wlan set hostednetwork mode=allow ssid=TIANap key=21345678
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">netsh wlan start hostednetwork
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">pause&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>今天更新驱动时发现了intel的my wifi便试了下, 可以实时显示都有哪些设备使用了.但是有个问题就是其他设备一直不能正常获取到ip地址.&lt;/p>
&lt;p>打开my wifi创建的无线网络连接属性, 尝试着将除了internet 协议版本4 之外的其他项全取消了就好了,不知道什么原因导致的.&lt;/p></description></item><item><title>js常用操作</title><link>https://hitian.info/post/js-tools/</link><pubDate>Wed, 24 Aug 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/js-tools/</guid><description>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * js常用操作类
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">myTools&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">myTools&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// getElementById
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// getElementsByTagName
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getElementsByTagName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">writeHTML&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">content&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">target&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">g&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">target&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">target&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">innerHTML&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">content&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//计算字符串长度， 中文算两个字
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">slen&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">charCodeAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">255&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 还原html
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">HtmlToStr&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">vStr&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">vStr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sr">/&amp;amp;amp;/g&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">vStr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sr">/&amp;amp;quot;/g&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">vStr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sr">/&amp;amp;#039;/g&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">vStr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sr">/&amp;amp;lt;/g&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;lt;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">vStr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sr">/&amp;amp;gt;/g&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">vStr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 转译html
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">StrToHtml&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sr">/&amp;amp;amp;/g&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sr">/&amp;amp;quot;/g&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sr">/&amp;amp;#039;/g&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sr">/&amp;amp;lt;/g&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sr">/&amp;amp;gt;/g&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//按长度截取中文字符串
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">subs&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">len&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">l&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">charCodeAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">128&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nx">l&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="nx">l&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">charAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="nx">len&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//获取httprequest对象
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">GetHttpRequest&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XMLHttpRequest&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// Gecko
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">XMLHttpRequest&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ActiveXObject&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// IE
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">ActiveXObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;MsXml2.XmlHttp&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">load_js_url&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//加载js
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">loadJs&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">_url&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">callback&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">arguments&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">load_js_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">_url&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">_script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;SCRIPT&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_script&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;text/javascript&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_script&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;src&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_url&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">$t&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;head&amp;#34;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">appendChild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">_script&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">all&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_script&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">onreadystatechange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="sr">/onload|loaded|complete/&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">_script&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">readyState&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">callback&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">callback&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_script&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">onload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">callback&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//去空格
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">trim&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sr">/(^\s*)/g&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>php注意正则匹配的长度限制</title><link>https://hitian.info/post/php-regex-length-limit/</link><pubDate>Mon, 22 Aug 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/php-regex-length-limit/</guid><description>&lt;p>今天要使用正则来批量替换一个抓取页面中的图片地址&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$nrjl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">preg_replace_callback&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#&amp;lt;img.*src=&amp;#34;([^&amp;#34;]+)&amp;#34;#isU&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;tianreplace&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$nrjl&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> &lt;span class="nf">tianreplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">substr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$matches&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="s2">&amp;#34;http://&amp;#34;&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;&amp;lt;img src=&amp;#34;&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$matches&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.&lt;/span>&lt;span class="s1">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">global&lt;/span> &lt;span class="nv">$this_domain&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;&amp;lt;img src=&amp;#34;http://&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="nv">$this_domain&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="s1">&amp;#39;/&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$matches&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.&lt;/span>&lt;span class="s1">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">?&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ini" data-lang="ini">&lt;span class="line">&lt;span class="cl">&lt;span class="na">ini_set(&amp;#39;pcre.backtrack_limit&amp;#39;, 10000000);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>就正常了.&lt;/p></description></item><item><title>js本地存储和cookie操作</title><link>https://hitian.info/post/js-localstorage/</link><pubDate>Sun, 21 Aug 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/js-localstorage/</guid><description>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * tian
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//storage tools;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">st&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sset&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sget&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sdel&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">del&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cset&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[],&lt;/span> &lt;span class="nx">_para&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">d&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">arguments&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">d&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nx">_len&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">d&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">d&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">arguments&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">d&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_para&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exps&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">typeof&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s2">&amp;#34;undefined&amp;#34;&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nb">Math&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ceil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">/&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">3600&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">24&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_para&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_para&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">val&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_para&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_para&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">domain&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_para&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">secure&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cookieStore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">_para&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cget&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cookieStore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cdel&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cookieStore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">del&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">storage&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_g&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">){&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_c&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">){&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_domain&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">//设置cookie域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">_store&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_init&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">init&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">localStorage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">localStore&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">navigator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">userAgent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">indexOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;MSIE&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ieStore&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cookieStore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">set&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">checkInit&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">set&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">val&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="nx">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">get&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">checkInit&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">del&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">checkInit&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">del&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isInit&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">checkInit&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">checkInit&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isInit&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">localStore&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_init&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">init&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">get&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">localStorage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getItem&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">set&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">localStorage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setItem&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">del&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">localStorage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">removeItem&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isInit&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ieStore&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">exps&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mi">180&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_init&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">init&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isInit&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_g&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;_ieStore&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;INPUT&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hidden&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;_ieStore&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">addBehavior&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;#default#userData&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_g&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;logo&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">appendChild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//注意这里的logo 是页面里一个标签的id,用来创建userdata的数据载体.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_g&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;_ieStore&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_g&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;_ieStore&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">get&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;__store__&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">set&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_val&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_exps&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">typeof&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s2">&amp;#34;undefined&amp;#34;&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exps&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exps&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setDate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getDate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">_exps&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">expires&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">toUTCString&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;__store__&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_val&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">del&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">set&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="nx">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isInit&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cookieStore&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_init&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_exps&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mi">180&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_secure&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">init&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isInit&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_domain&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">storage&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_domain&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">get&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cookie&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;; &amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;=&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nx">_len&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">indexOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s2">&amp;#34;-1&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">decodeURIComponent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">unescape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">set&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_val&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_exps&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">typeof&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s2">&amp;#34;undefined&amp;#34;&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exps&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_exps&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_domain&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">domain&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_domain&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">||&lt;/span> &lt;span class="s2">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_secure&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">secure&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_secure&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setDate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getDate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">_exps&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">d&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;=&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">escape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">_val&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">_exps&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s2">&amp;#34;;expires=&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">toUTCString&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">_path&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s2">&amp;#34;;path=&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">_path&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">_domain&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s2">&amp;#34;;domain=&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">_domain&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">_secure&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s2">&amp;#34;;secure=&amp;#34;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cookie&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">d&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">del&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">prototype&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">toLowerCase&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">apply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">typeof&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;string&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="nx">_name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">val&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exps&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">secure&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isInit&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_init&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>简单的mysql表级锁</title><link>https://hitian.info/post/simple-mysql-table-level-locks/</link><pubDate>Tue, 12 Jul 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/simple-mysql-table-level-locks/</guid><description>&lt;p>由于业务需要, 一个表不允许两个及以上用户同时操作.由于是mysql4.1 事务等高级特性就不用想了, 存储引擎统一使用的MyISAM.其实转换成InnoDB 就可以使用行级锁了, 但是由于是线上正在使用的数据库, 数据量比较大,转换怕出现意外. 要实现的功能又是在后台使用. 所以就直接使用表级锁完全可以了.在mysql中对表加锁和解锁其实挺简单的&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">LOCK&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">table_name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">UNLOCK&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>demo&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$db&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Mysql&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">open&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;lock table &amp;#34;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">$table&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$sql&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;SELECT * FROM &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">table&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> WHERE gid=&amp;#39;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">gid&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#39; AND sid IS NULL LIMIT 1&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$sql&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$success&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$re&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$row&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;id&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$update_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;udate&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">date&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Y-m-d H:i:s&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;tuid&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$uid&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;operator&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$_COOKIE&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;admin_name&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;sid&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$sid&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">table&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$update_data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;id=&amp;#39;&lt;/span>&lt;span class="si">$id&lt;/span>&lt;span class="s2">&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">getAffectedRows&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$result&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$success&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$re&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$row&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$msg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;发生错误: 物品库存修改失败!&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$msg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;库存不足&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;unlock table&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$db&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//return array($success, $msg, $re);
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Hello world!</title><link>https://hitian.info/post/hello-world/</link><pubDate>Thu, 07 Jul 2011 00:00:00 +0000</pubDate><guid>https://hitian.info/post/hello-world/</guid><description>&lt;p>从今天起就在这里安家了。以前也在其它地方开过博客，但是都没过多久就半途而废了，希望这次可以坚持下去。&lt;/p>
&lt;p>tian2011.07.08于地铁四号线&lt;/p></description></item></channel></rss>