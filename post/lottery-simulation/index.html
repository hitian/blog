<!doctype html><html lang=zh-cn>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ä¸€èˆ¬æ¥è¯´è¦åšä¸€ä¸ªæŠ½å¥–ç¨‹åºä¼šç«‹å³æƒ³åˆ°ç”¨éšæœºæ•°. ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹éšæœºæ•°ä¹Ÿä¸æ˜¯é‚£ä¹ˆçš„éšæœº, æ•°é‡æ¯”è¾ƒå¤§çš„æ—¶å€™æ‰èƒ½ä½“ç°å‡ºæ¯”è¾ƒå¹³å‡, æ•°é‡è¾ƒå°çš„æ—¶å€™ä¸­å¥–æ¦‚ç‡çš„å¯æ§æ€§å°†ä¼šå¾ˆå·®. ä¸€ä¸å°å¿ƒå¤šè¢«æŠ½ä¸­å‡ ä¸ªéº»çƒ¦å°±å¤§äº†.
&amp;lt;?php class T_prize{ var $item; var $table; /** * æŠ½å¥–ä¸»ç¨‹åº å¤–éƒ¨è°ƒç”¨å…¥å£ * @param unknown_type $db æ•°æ®åº“é“¾æ¥ * @param unknown_type $id æŠ½å¥–ç±»å‹ */ function prize($db, $id){ global $prize_set; //  if(!isset($prize_set[$id])){ return false; } $this-&amp;gt;item = $prize_set[$id]; $table = &amp;#39;my_prize_store_table_&amp;#39; . $id; //æŠ½å¥–å¹¶å‘è¾ƒå¤§æ—¶å¯ä»¥è¿›è¡Œåˆ†è¡¨, å¤šç”Ÿæˆå‡ ä¸ªå¥–æ±   //$table = &amp;#39;my_prize_store_table_&amp;#39; . $id . &amp;#39;_&amp;#39; . rand(0, 4);  $this-&amp;gt;table = $table; //é˜²æ­¢å¤šä¸ªç”¨æˆ·æŠ½åˆ°åŒä¸€ä¸ªæ¡ç›®, è¿›è¡Œé”è¡¨  $db-&amp;gt;query(&amp;#34;lock table &amp;#34; . $table ."><title>ä½¿ç”¨ç±»ä¼¼äºå¥–æ± æ–¹å¼çš„æŠ½å¥–æ¨¡æ‹Ÿ</title>
<link rel=canonical href=https://hitian.info/post/lottery-simulation/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="ä½¿ç”¨ç±»ä¼¼äºå¥–æ± æ–¹å¼çš„æŠ½å¥–æ¨¡æ‹Ÿ">
<meta property="og:description" content="ä¸€èˆ¬æ¥è¯´è¦åšä¸€ä¸ªæŠ½å¥–ç¨‹åºä¼šç«‹å³æƒ³åˆ°ç”¨éšæœºæ•°. ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹éšæœºæ•°ä¹Ÿä¸æ˜¯é‚£ä¹ˆçš„éšæœº, æ•°é‡æ¯”è¾ƒå¤§çš„æ—¶å€™æ‰èƒ½ä½“ç°å‡ºæ¯”è¾ƒå¹³å‡, æ•°é‡è¾ƒå°çš„æ—¶å€™ä¸­å¥–æ¦‚ç‡çš„å¯æ§æ€§å°†ä¼šå¾ˆå·®. ä¸€ä¸å°å¿ƒå¤šè¢«æŠ½ä¸­å‡ ä¸ªéº»çƒ¦å°±å¤§äº†.
&amp;lt;?php class T_prize{ var $item; var $table; /** * æŠ½å¥–ä¸»ç¨‹åº å¤–éƒ¨è°ƒç”¨å…¥å£ * @param unknown_type $db æ•°æ®åº“é“¾æ¥ * @param unknown_type $id æŠ½å¥–ç±»å‹ */ function prize($db, $id){ global $prize_set; //  if(!isset($prize_set[$id])){ return false; } $this-&amp;gt;item = $prize_set[$id]; $table = &amp;#39;my_prize_store_table_&amp;#39; . $id; //æŠ½å¥–å¹¶å‘è¾ƒå¤§æ—¶å¯ä»¥è¿›è¡Œåˆ†è¡¨, å¤šç”Ÿæˆå‡ ä¸ªå¥–æ±   //$table = &amp;#39;my_prize_store_table_&amp;#39; . $id . &amp;#39;_&amp;#39; . rand(0, 4);  $this-&amp;gt;table = $table; //é˜²æ­¢å¤šä¸ªç”¨æˆ·æŠ½åˆ°åŒä¸€ä¸ªæ¡ç›®, è¿›è¡Œé”è¡¨  $db-&amp;gt;query(&amp;#34;lock table &amp;#34; . $table .">
<meta property="og:url" content="https://hitian.info/post/lottery-simulation/">
<meta property="og:site_name" content="ä¸æŠ˜è…¾ä¸èˆ’æœ">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="php"><meta property="article:tag" content="lottery"><meta property="article:published_time" content="2011-11-23T00:00:00+00:00"><meta property="article:modified_time" content="2011-11-23T00:00:00+00:00">
<meta name=twitter:title content="ä½¿ç”¨ç±»ä¼¼äºå¥–æ± æ–¹å¼çš„æŠ½å¥–æ¨¡æ‹Ÿ">
<meta name=twitter:description content="ä¸€èˆ¬æ¥è¯´è¦åšä¸€ä¸ªæŠ½å¥–ç¨‹åºä¼šç«‹å³æƒ³åˆ°ç”¨éšæœºæ•°. ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹éšæœºæ•°ä¹Ÿä¸æ˜¯é‚£ä¹ˆçš„éšæœº, æ•°é‡æ¯”è¾ƒå¤§çš„æ—¶å€™æ‰èƒ½ä½“ç°å‡ºæ¯”è¾ƒå¹³å‡, æ•°é‡è¾ƒå°çš„æ—¶å€™ä¸­å¥–æ¦‚ç‡çš„å¯æ§æ€§å°†ä¼šå¾ˆå·®. ä¸€ä¸å°å¿ƒå¤šè¢«æŠ½ä¸­å‡ ä¸ªéº»çƒ¦å°±å¤§äº†.
&amp;lt;?php class T_prize{ var $item; var $table; /** * æŠ½å¥–ä¸»ç¨‹åº å¤–éƒ¨è°ƒç”¨å…¥å£ * @param unknown_type $db æ•°æ®åº“é“¾æ¥ * @param unknown_type $id æŠ½å¥–ç±»å‹ */ function prize($db, $id){ global $prize_set; //  if(!isset($prize_set[$id])){ return false; } $this-&amp;gt;item = $prize_set[$id]; $table = &amp;#39;my_prize_store_table_&amp;#39; . $id; //æŠ½å¥–å¹¶å‘è¾ƒå¤§æ—¶å¯ä»¥è¿›è¡Œåˆ†è¡¨, å¤šç”Ÿæˆå‡ ä¸ªå¥–æ±   //$table = &amp;#39;my_prize_store_table_&amp;#39; . $id . &amp;#39;_&amp;#39; . rand(0, 4);  $this-&amp;gt;table = $table; //é˜²æ­¢å¤šä¸ªç”¨æˆ·æŠ½åˆ°åŒä¸€ä¸ªæ¡ç›®, è¿›è¡Œé”è¡¨  $db-&amp;gt;query(&amp;#34;lock table &amp;#34; . $table .">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-24477176-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar">
<aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header class=site-info>
<figure class=site-avatar>
<img src=/assets/avatar.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>ğŸŒ</span>
</figure>
<h1 class=site-name><a href=https://hitian.info>ä¸æŠ˜è…¾ä¸èˆ’æœ</a></h1>
<h2 class=site-description>æŠ˜è…¾ç¬”è®°</h2>
</header>
<ol class=menu id=main-menu>
<li>
<a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span>
</a>
</li>
<li>
<a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span>
</a>
</li>
<li>
<a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span>
</a>
</li>
<li>
<a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span>
</a>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span>
</li>
</ol>
</aside>
<main class="main full-width">
<div id=article-toolbar>
<a href=https://hitian.info class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/php/>
php
</a>
</header>
<h2 class=article-title>
<a href=/post/lottery-simulation/>ä½¿ç”¨ç±»ä¼¼äºå¥–æ± æ–¹å¼çš„æŠ½å¥–æ¨¡æ‹Ÿ</a>
</h2>
<footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--published>Nov 23, 2011</time>
</footer></div>
</header>
<section class=article-content>
<p>ä¸€èˆ¬æ¥è¯´è¦åšä¸€ä¸ªæŠ½å¥–ç¨‹åºä¼šç«‹å³æƒ³åˆ°ç”¨éšæœºæ•°. ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹éšæœºæ•°ä¹Ÿä¸æ˜¯é‚£ä¹ˆçš„éšæœº, æ•°é‡æ¯”è¾ƒå¤§çš„æ—¶å€™æ‰èƒ½ä½“ç°å‡ºæ¯”è¾ƒå¹³å‡, æ•°é‡è¾ƒå°çš„æ—¶å€™ä¸­å¥–æ¦‚ç‡çš„å¯æ§æ€§å°†ä¼šå¾ˆå·®. ä¸€ä¸å°å¿ƒå¤šè¢«æŠ½ä¸­å‡ ä¸ªéº»çƒ¦å°±å¤§äº†.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php>

<span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>class</span> <span class=nc>T_prize</span><span class=p>{</span>
    <span class=k>var</span> <span class=nv>$item</span><span class=p>;</span>
    <span class=k>var</span> <span class=nv>$table</span><span class=p>;</span>
 
<span class=sd>/**
</span><span class=sd> * æŠ½å¥–ä¸»ç¨‹åº å¤–éƒ¨è°ƒç”¨å…¥å£
</span><span class=sd> * @param unknown_type $db æ•°æ®åº“é“¾æ¥
</span><span class=sd> * @param unknown_type $id æŠ½å¥–ç±»å‹
</span><span class=sd> */</span>
     <span class=k>function</span> <span class=nf>prize</span><span class=p>(</span><span class=nv>$db</span><span class=p>,</span> <span class=nv>$id</span><span class=p>){</span>
         <span class=k>global</span> <span class=nv>$prize_set</span><span class=p>;</span>
        <span class=c1>//
</span><span class=c1></span>         <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$prize_set</span><span class=p>[</span><span class=nv>$id</span><span class=p>])){</span>
             <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
         <span class=p>}</span>
         <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>item</span> <span class=o>=</span> <span class=nv>$prize_set</span><span class=p>[</span><span class=nv>$id</span><span class=p>];</span>
         <span class=nv>$table</span> <span class=o>=</span> <span class=s1>&#39;my_prize_store_table_&#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>;</span>
         <span class=c1>//æŠ½å¥–å¹¶å‘è¾ƒå¤§æ—¶å¯ä»¥è¿›è¡Œåˆ†è¡¨, å¤šç”Ÿæˆå‡ ä¸ªå¥–æ± 
</span><span class=c1></span>         <span class=c1>//$table = &#39;my_prize_store_table_&#39; . $id . &#39;_&#39; . rand(0, 4);
</span><span class=c1></span>         <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>table</span> <span class=o>=</span> <span class=nv>$table</span><span class=p>;</span>
         <span class=c1>//é˜²æ­¢å¤šä¸ªç”¨æˆ·æŠ½åˆ°åŒä¸€ä¸ªæ¡ç›®, è¿›è¡Œé”è¡¨
</span><span class=c1></span>         <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=s2>&#34;lock table &#34;</span> <span class=o>.</span> <span class=nv>$table</span> <span class=o>.</span> <span class=s2>&#34; write&#34;</span><span class=p>);</span>
         <span class=nv>$pid</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>get_one</span><span class=p>(</span><span class=nv>$db</span><span class=p>,</span> <span class=nv>$id</span><span class=p>);</span>
         <span class=c1>//å¥–æ± ä¸­æ²¡æœ‰å¥–å“æ—¶é‡æ–°åˆå§‹åŒ–å¥–æ± 
</span><span class=c1></span>         <span class=k>if</span><span class=p>(</span><span class=nv>$pid</span> <span class=o>==</span> <span class=s1>&#39;-1&#39;</span><span class=p>){</span>
             <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>create_pool</span><span class=p>(</span><span class=nv>$db</span><span class=p>,</span> <span class=nv>$id</span><span class=p>);</span>
             <span class=nv>$pid</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>get_one</span><span class=p>(</span><span class=nv>$db</span><span class=p>,</span> <span class=nv>$id</span><span class=p>);</span>
         <span class=p>}</span>
         <span class=c1>//é‡Šæ”¾é” è¿”å›æŠ½å¥–ç»“æœ
</span><span class=c1></span>         <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=s2>&#34;unlock table&#34;</span><span class=p>);</span>
         <span class=k>return</span> <span class=nv>$pid</span><span class=p>;</span>
      <span class=p>}</span>
 
<span class=sd>/**
</span><span class=sd>  * æŠ½å¥–ä¸€æ¬¡
</span><span class=sd>  * @param unknown_type $db
</span><span class=sd>  * @param unknown_type $id
</span><span class=sd>  */</span>
     <span class=k>function</span> <span class=nf>get_one</span><span class=p>(</span><span class=nv>$db</span><span class=p>,</span> <span class=nv>$id</span><span class=p>){</span>
         <span class=nv>$table</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>table</span><span class=p>;</span>
         <span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;SELECT * FROM </span><span class=si>${</span><span class=nv>table</span><span class=si>}</span><span class=s2> WHERE enable = &#39;1&#39; LIMIT 1&#34;</span><span class=p>;</span>
         <span class=nv>$row</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>(</span><span class=nv>$db</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$sql</span><span class=p>));</span>
         <span class=nv>$success</span> <span class=o>=</span> <span class=k>false</span><span class=p>;</span>
         <span class=nv>$re</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
         <span class=k>if</span><span class=p>(</span><span class=nv>$row</span><span class=p>){</span>
             <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>];</span>
             <span class=nv>$pid</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;pid&#39;</span><span class=p>];</span>
             <span class=nv>$update_data</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
                 <span class=s1>&#39;enable&#39;</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>,</span>
             <span class=p>);</span>
             <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>update</span><span class=p>(</span><span class=nv>$table</span><span class=p>,</span> <span class=nv>$update_data</span><span class=p>,</span> <span class=s2>&#34;id=&#39;</span><span class=si>$id</span><span class=s2>&#39;&#34;</span><span class=p>);</span>
             <span class=nv>$result</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>getAffectedRows</span><span class=p>();</span>
             <span class=k>if</span><span class=p>(</span><span class=nv>$result</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>){</span>
                 <span class=nv>$success</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>
                 <span class=nv>$re</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>;</span>
             <span class=p>}</span><span class=k>else</span><span class=p>{</span>
                 <span class=nx>my_log</span><span class=p>(</span><span class=s1>&#39;æŠ½å¥–æ± æ¡ç›®çŠ¶æ€ä¿®æ”¹å‘ç”Ÿé”™è¯¯ id:&#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>);</span>
             <span class=p>}</span>
         <span class=p>}</span><span class=k>else</span><span class=p>{</span>
             <span class=k>return</span> <span class=s1>&#39;-1&#39;</span><span class=p>;</span>
         <span class=p>}</span>
         <span class=k>if</span><span class=p>(</span><span class=nv>$success</span><span class=p>){</span>
             <span class=k>return</span> <span class=nv>$pid</span><span class=p>;</span>
         <span class=p>}</span><span class=k>else</span><span class=p>{</span>
             <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
         <span class=p>}</span>
     <span class=p>}</span>
 
<span class=sd>/**
</span><span class=sd>  * å¥–å“æ± åˆå§‹åŒ–
</span><span class=sd>  * @param unknown_type $db
</span><span class=sd>  * @param unknown_type $id
</span><span class=sd>  */</span>
     <span class=k>function</span> <span class=nf>create_pool</span><span class=p>(</span><span class=nv>$db</span><span class=p>,</span> <span class=nv>$id</span><span class=p>){</span>
         <span class=nv>$table</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>table</span><span class=p>;</span>
         <span class=nx>my_log</span><span class=p>(</span><span class=s1>&#39;init prize pool id:&#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>);</span>
         <span class=nv>$item</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>item</span><span class=p>;</span>
         <span class=nv>$total_num</span> <span class=o>=</span> <span class=nv>$item</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>];</span>
         <span class=nv>$list</span> <span class=o>=</span> <span class=nv>$item</span><span class=p>[</span><span class=s1>&#39;list&#39;</span><span class=p>];</span>
         <span class=nv>$tprize_list</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
         <span class=k>foreach</span> <span class=p>(</span><span class=nv>$list</span> <span class=k>as</span> <span class=nv>$key</span><span class=o>=&gt;</span><span class=nv>$one</span><span class=p>){</span>
             <span class=nv>$tnum</span> <span class=o>=</span> <span class=nx>intval</span><span class=p>(</span><span class=nv>$total_num</span> <span class=o>*</span> <span class=nv>$one</span><span class=p>[</span><span class=s1>&#39;probability&#39;</span><span class=p>]);</span>
             <span class=k>if</span><span class=p>(</span><span class=nv>$tnum</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>){</span>
                 <span class=nx>my_log</span><span class=p>(</span><span class=s1>&#39;create prize pool create alert: total_num:&#39;</span> <span class=o>.</span> <span class=nv>$total_num</span> <span class=o>.</span> <span class=s1>&#39; item_name:&#39;</span> <span class=o>.</span> <span class=nv>$item</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=o>.</span> <span class=s1>&#39; probability:&#39;</span> <span class=o>.</span> <span class=nv>$item</span><span class=p>[</span><span class=s1>&#39;probability&#39;</span><span class=p>]);</span>
                 <span class=k>continue</span><span class=p>;</span>
             <span class=p>}</span>
             <span class=k>for</span> <span class=p>(</span><span class=nv>$i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>&lt;</span> <span class=nv>$tnum</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>++</span><span class=p>){</span>
                 <span class=k>do</span><span class=p>{</span>
                     <span class=nv>$id</span> <span class=o>=</span> <span class=nx>rand</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nv>$total_num</span><span class=p>);</span>
                 <span class=p>}</span><span class=k>while</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$tprize_list</span><span class=p>[</span><span class=nv>$id</span><span class=p>]));</span>
                 <span class=nv>$tprize_list</span><span class=p>[</span><span class=nv>$id</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$key</span><span class=p>;</span>
             <span class=p>}</span>
         <span class=p>}</span>
         <span class=nx>my_log</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>);</span>
         <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=s1>&#39;TRUNCATE &#39;</span> <span class=o>.</span> <span class=nv>$table</span><span class=p>);</span>
         <span class=nv>$insert_str_arr</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
         <span class=k>for</span><span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span> <span class=nv>$i</span><span class=o>&lt;=</span><span class=nv>$total_num</span><span class=p>;</span> <span class=nv>$i</span><span class=o>++</span><span class=p>){</span>
             <span class=nv>$this_pid</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
             <span class=nv>$inset_data</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;pid&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>);</span>
              <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$tprize_list</span><span class=p>[</span><span class=nv>$i</span><span class=p>])){</span>
                  <span class=nv>$this_pid</span> <span class=o>=</span> <span class=nv>$tprize_list</span><span class=p>[</span><span class=nv>$i</span><span class=p>];</span>
              <span class=p>}</span>
              <span class=c1>//æ¯100æ¡è®°å½•æ’å…¥ä¸€æ¬¡å¯ä»¥å¤§å¹…å‡å°æ•°æ®åº“æ’å…¥æ—¶é—´æ—¶é—´
</span><span class=c1></span>              <span class=nv>$insert_str_arr</span><span class=p>[]</span> <span class=o>=</span> <span class=s2>&#34;(</span><span class=si>$this_pid</span><span class=s2>)&#34;</span><span class=p>;</span>
              <span class=k>if</span><span class=p>(</span><span class=nv>$i</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
                  <span class=nv>$insert_str</span> <span class=o>=</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=nv>$insert_str_arr</span><span class=p>);</span>
                  <span class=nv>$insert_str</span> <span class=o>=</span> <span class=s1>&#39;insert into &#39;</span> <span class=o>.</span> <span class=nv>$table</span> <span class=o>.</span> <span class=s1>&#39;(pid) values&#39;</span> <span class=o>.</span> <span class=nv>$insert_str</span><span class=p>;</span>
                  <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$insert_str</span><span class=p>);</span>
                  <span class=nv>$insert_str_arr</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
             <span class=p>}</span>
         <span class=p>}</span>
         <span class=nx>my_log</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>);</span>
     <span class=p>}</span>
 
  <span class=p>}</span>
 
  <span class=c1>//è‡ªå®šä¹‰æ—¥å¿—
</span><span class=c1></span>  <span class=k>function</span> <span class=nf>my_log</span><span class=p>(</span><span class=nv>$msg</span><span class=p>){</span>
    <span class=c1>//write logs here
</span><span class=c1></span>  <span class=p>}</span>

</code></pre></div><p>ä½¿ç”¨å¥–æ± çš„æ¦‚å¿µå¯ä»¥å°†ä¸­å¥–æ¦‚ç‡ä¸¥æ ¼é™åˆ¶ä¸€ä¸‹,Â  ç”Ÿæˆä¸€å®šæ•°é‡çš„æ ¼å­, æŒ‰ç…§æ¦‚ç‡ç®—å‡ºæœ‰å¥–å“çš„æ ¼å­çš„æ•°é‡, ç„¶åå†éšæœºå¡«å……åˆ°æ ¼å­é‡Œå», æ‰§è¡ŒæŠ½å¥–çš„æ—¶å€™ä¸€æ¬¡å»æ‰“å¼€æ ¼å­. è¦ä¹ˆä¸­å¥–,è¦ä¹ˆä¸ä¸­, å½“æ‰€æœ‰æ ¼å­éƒ½è¢«å¼€å¯è¿‡ä¹‹å,Â  å†æ¬¡æ‰§è¡Œåˆå§‹åŒ–é‡æ–°å¡«å……æ‰€æœ‰çš„æ ¼å­.
è®¾ç½®ä¸€ä¸‹éœ€è¦ä½¿ç”¨çš„å¥–å“æ•°æ®å’Œæ¦‚ç‡</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php>
<span class=o>&lt;?</span><span class=nx>php</span>
<span class=nv>$prize_set</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
<span class=c1>//æŠ½å¥–1
</span><span class=c1></span><span class=nv>$prize_set</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
   <span class=s1>&#39;total&#39;</span> <span class=o>=&gt;</span> <span class=mi>1000</span><span class=p>,</span>
   <span class=s1>&#39;list&#39;</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span>
        <span class=mi>1</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“1&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.01&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>3</span><span class=p>),</span>
        <span class=mi>2</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“2&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.05&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>7</span><span class=p>),</span>
        <span class=mi>3</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“3&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.1&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>9</span><span class=p>),</span>
    <span class=p>),</span>
 <span class=p>);</span>
 
 <span class=c1>//æŠ½å¥–2
</span><span class=c1></span> <span class=nv>$prize_set</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
     <span class=s1>&#39;total&#39;</span> <span class=o>=&gt;</span> <span class=mi>1000</span><span class=p>,</span>
     <span class=s1>&#39;list&#39;</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span>
        <span class=mi>1</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“1&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.001&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>3</span><span class=p>),</span>
        <span class=mi>2</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“2&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.005&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>7</span><span class=p>),</span>
        <span class=mi>3</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“3&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.01&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>9</span><span class=p>),</span>
        <span class=mi>4</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“4&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.02&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>),</span>
        <span class=mi>5</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“5&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.05&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>2</span><span class=p>),</span>
        <span class=mi>6</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;å¥–å“6&#39;</span><span class=p>,</span> <span class=s1>&#39;probability&#39;</span><span class=o>=&gt;</span> <span class=s1>&#39;0.1&#39;</span><span class=p>,</span> <span class=s1>&#39;product_id&#39;</span> <span class=o>=&gt;</span> <span class=mi>4</span><span class=p>),</span>
    <span class=p>),</span>
<span class=p>);</span>

</code></pre></div><p>æˆ‘æœ‰ä¸¤ç»„æŠ½å¥–, æ‰€ä»¥å®šä¹‰äº†ä¸¤ç»„.Â  æ³¨æ„, æ¯ç»„çš„æ€»æ•° ä¹˜ä»¥ è¿™ç»„ä¸­æœ€å°çš„ä¸€ä¸ªæ¦‚ç‡ä¸€å®šè¦å¤§äº1,Â  ä¸ç„¶è¿™ä¸ªå¥–å“å°±æ°¸è¿œä¹Ÿæ²¡å¯èƒ½æŠ½ä¸­äº†.</p>
<p>è¿™ç§æ–¹å¼ä¹Ÿæœ‰ç¼ºç‚¹:</p>
<p>1.æ¦‚ç‡çš„è°ƒæ•´åªèƒ½åœ¨ä¸‹æ¬¡å¥–æ± åˆå§‹åŒ–æ—¶æ‰èƒ½ç”Ÿæ•ˆ,</p>
<p>2.ä½¿ç”¨æ•°æ®åº“è¡¨é”æ¥ä¿è¯åŒä¸€ä¸ªæ ¼å­åªèƒ½è¢«ä¸€ä¸ªäººæŠ½ä¸­, ä¼šå¯¼è‡´æ€§èƒ½é™ä½, (æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯myisam, åªèƒ½ä½¿ç”¨è¡¨çº§é”)æ— æ³•æ”¯æŒå¤§é‡çš„å¹¶å‘, æœ‰ä¸ªå¾ˆç¬¨çš„ä½†æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å¯¹åŒä¸€ä¸ªæŠ½å¥–ä½¿ç”¨å¤šä¸ªå¥–æ± , å°†è¯·æ±‚åˆ†æ•£åˆ°å„ä¸ªè¡¨å».</p>
<p>åè®°:è¡¨åœ¨lock çŠ¶æ€ä¸­å®é™…ä¸Šæ˜¯ä¸æ”¯æŒtruncate æ“ä½œçš„, Â å…ˆdelete from table åˆ é™¤æ‰€æœ‰æ•°æ®, å† alter table xxx set auto_increment=1 Â å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜&mldr;</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/php/>php</a>
<a href=/tags/lottery/>lottery</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>ç›¸å…³æ–‡ç« </h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/post/sql-injection-risk/>
<div class=article-details>
<h2 class=article-title>æ³¨å…¥é£é™©æé†’</h2>
</div>
</a>
</article>
<article>
<a href=/post/php-file-download-set-header/>
<div class=article-details>
<h2 class=article-title>php æ–‡ä»¶ä¸‹è½½ header è®¾ç½®</h2>
</div>
</a>
</article>
<article>
<a href=/post/win7-x64-zend-studio-x86/>
<div class=article-details>
<h2 class=article-title>win7 x64 è¿è¡Œx86çš„zend studio 9.0</h2>
</div>
</a>
</article>
<article>
<a href=/post/php-exec/>
<div class=article-details>
<h2 class=article-title>phpæ‰§è¡ŒæœåŠ¡å™¨è„šæœ¬</h2>
</div>
</a>
</article>
<article>
<a href=/post/php-regex-length-limit/>
<div class=article-details>
<h2 class=article-title>phpæ³¨æ„æ­£åˆ™åŒ¹é…çš„é•¿åº¦é™åˆ¶</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//hitian.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2011 -
2021 ä¸æŠ˜è…¾ä¸èˆ’æœ
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>